<!doctype html><html lang=en-us><head><meta charset=utf-8><title>Docker for Admins - Workshop v2 | Edenmal - Sysadmin Garden of Eden</title>
<meta name=author content="Alexander Trost"><meta name=description content="Improved version of the first &#34;Docker for Admins&#34;-Workshop. So to say the version 2."><meta name=twitter:site content="@galexrt"><meta name=twitter:title content="Docker for Admins - Workshop v2 | Edenmal - Sysadmin Garden of Eden"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://edenmal.moe/post/covers/docker-logo-vertical.png"><meta name=twitter:description content="Improved version of the first &#34;Docker for Admins&#34;-Workshop. So to say the version 2."><meta property="og:type" content="article"><meta property="og:title" content="Docker for Admins - Workshop v2"><meta property="og:description" content="Improved version of the first &#34;Docker for Admins&#34;-Workshop. So to say the version 2."><meta property="og:url" content="https://edenmal.moe/post/2016/Docker-for-Admins-Workshop-v2/"><meta property="og:image" content="https://edenmal.moe/post/covers/docker-logo-vertical.png"><meta name=generator content="Hugo 0.120.4"><link rel=canonical href=https://edenmal.moe/post/2016/Docker-for-Admins-Workshop-v2/><meta name=renderer content="webkit"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=format-detection content="telephone=no,email=no,adress=no"><meta http-equiv=Cache-Control content="no-transform"><meta name=robots content="index,follow"><meta name=referrer content="origin-when-cross-origin"><meta name=theme-color content="#4d4ac7"><meta name=apple-mobile-web-app-capable content="yes"><meta name=apple-mobile-web-app-status-bar-style content="black"><meta name=apple-mobile-web-app-title content="Edenmal"><meta name=msapplication-tooltip content="Edenmal"><meta name=msapplication-navbutton-color content="#4d4ac7"><meta name=msapplication-TileColor content="#4d4ac7"><meta name=msapplication-TileImage content="/icons/icon-144x144.png"><link rel=icon href=https://edenmal.moe/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://edenmal.moe/icons/icon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://edenmal.moe/icons/icon-32x32.png><link rel=icon sizes=192x192 href=https://edenmal.moe/icons/icon-192x192.png><link rel=apple-touch-icon href=https://edenmal.moe/icons/icon-152x152.png><link rel=manifest href=https://edenmal.moe/manifest.json><link rel=preload href=https://edenmal.moe/styles/main-rendered.min.css as=style><link rel=preload href=https://edenmal.moe/images/avatar.png as=image><link rel=preload href=https://edenmal.moe/images/grey-prism.svg as=image><style>body{background-color:#f4f3f1;background-image:url(/images/grey-prism.svg);background-repeat:repeat;background-attachment:fixed}</style><link rel=stylesheet href=https://edenmal.moe/styles/main-rendered.min.css><link rel=stylesheet href=https://edenmal.moe/cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.3/photoswipe.min.min.css><link rel=stylesheet href=https://edenmal.moe/cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.3/default-skin/default-skin.min.min.css><script src=https://edenmal.moe/cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.3/photoswipe.min.min.819c76b4bba0f8b8c568f6e4860173f1d16e5046c01b008f4705ae823b5766e1.js integrity="sha256-gZx2tLug+LjFaPbkhgFz8dFuUEbAGwCPRwWugjtXZuE="></script><script src=https://edenmal.moe/cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.3/photoswipe-ui-default.min.min.2fcfc43be15566e9378af0e8247ba57fec8d4ee95c5dba15cf97e84d6c2115bc.js integrity="sha256-L8/EO+FVZuk3ivDoJHulf+yNTulcXboVz5foTWwhFbw="></script><script src=https://edenmal.moe/cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.min.min.77ec5e7d7f844e9b6c2413a352b48194493a65c75d94d5cd9679a225c2da773c.js integrity="sha256-d+xefX+ETptsJBOjUrSBlEk6ZcddlNXNlnmiJcLadzw="></script><script src=https://edenmal.moe/scripts/pswp-init.min.299a530b67d8be41667aa9ed78920e272e970b0ac8ab7540ba3a7c1382b52de2.js integrity="sha256-KZpTC2fYvkFmeqnteJIOJy6XCwrIq3VAujp8E4K1LeI="></script></head><body><div class=suspension><a role=button aria-label="Go to top" title="Go to top" class="to-top is-hide"><span class=icofont-caret-up aria-hidden=true></span></a>
<a role=button aria-label="Print page" title="Print page" class=print-page onclick=window.print()><span class=icofont-print aria-hidden=true></span></a></div><header class=site-header><a class=avatara href=https://edenmal.moe/><img class=avatar src=https://edenmal.moe/images/avatar.png alt=Avatar></a><h2 class=title><a href=https://edenmal.moe/>Edenmal</a></h2><p class=subtitle>Sysadmin Garden of Eden</p><button class=menu-toggle type=button aria-label="Main Menu" aria-expanded=false tab-index=0>
<span class=icofont-navigation-menu aria-hidden=true></span></button><nav class="site-menu collapsed"><h2 class=offscreen>Main Menu</h2><ul class=menu-list><li class="menu-item
is-active"><a href=https://edenmal.moe/>Home</a></li><li class=menu-item><a href=https://edenmal.moe/about/>About</a></li><li class=menu-item><a href=https://edenmal.moe/tags/>Tags</a></li><li class=menu-item><a href=https://edenmal.moe/events/>Events</a></li><li class=menu-item><a href=https://edenmal.moe/site-notice/>Impressum</a></li></ul></nav><nav class="social-menu collapsed"><h2 class=offscreen>Social Networks</h2><ul class=social-list><li class=social-item><a href=mailto:me@galexrt.moe title=Email aria-label=Email><span class=icofont-envelope aria-hidden=true></span></a></li><li class=social-item><a href=https://galexrt.moe/ rel=me title=Homepage aria-label=Homepage><span class=icofont-page aria-hidden=true></span></a></li><li class=social-item><a href=//github.com/galexrt rel=me title=GitHub aria-label=GitHub><span class=icofont-github aria-hidden=true></span></a></li><li class=social-item><a href=//twitter.com/galexrt rel=me title=Twitter aria-label=Twitter><span class=icofont-twitter aria-hidden=true></span></a></li><li class=social-item><a href=//www.linkedin.com/in/alexander-trost rel=me title=LinkedIn aria-label=LinkedIn><span class=icofont-linkedin aria-hidden=true></span></a></li><li class=social-item><a href=//www.xing.com/profile/Alexander_Trost18 rel=me title=XING aria-label=XING><span class=icofont-xing aria-hidden=true></span></a></li><li class=social-item><a rel=alternate type=application/rss+xml href=https://edenmal.moe/index.xml title=RSS aria-label=RSS><span class=icofont-rss aria-hidden=true></span></a></li></ul></nav></header><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><section class="main post-detail"><header class=post-header><h1 class=post-title>Docker for Admins - Workshop v2</h1><p class=post-meta>Author Alexander Trost · Read Time 50 minutes · Created Fri Apr 1 15:48:12 2016 · Updated Sat Mar 26 17:28:53 2022</p></header><article class=post-content><figure itemprop=associatedMedia itemscope itemtype=http://schema.org/ImageObject><a href=https://edenmal.moe/post/covers/docker-logo-vertical.png itemprop=contentUrl><img itemprop=thumbnail src=https://edenmal.moe/post/covers/docker-logo-vertical.png width=250px></a></figure><h2>Table of Contents</h2><nav id=TableOfContents><ul><li><a href=#whats-in-the-fcking-boxhttpswwwyoutubecomwatchvhoklpjavk_w><a href="https://www.youtube.com/watch?v=HOkLPjaVK_w">&ldquo;What&rsquo;s in the f*cking box?!&rdquo;</a></a><ul><li><a href=#why-is-the-vm-running-fedora>Why is the VM running Fedora?</a></li></ul></li></ul><ul><li><a href=#why-do-people-like-the-docker-principle>Why do people like the Docker-&ldquo;Principle&rdquo;?</a></li><li><a href=#micro-what-microservices>Micro-what? Microservices!</a></li><li><a href=#container>Container?!</a></li></ul><ul><li><a href=#side-notes>Side Notes</a></li><li><a href=#system-requirements>System &ldquo;Requirements&rdquo;</a></li><li><a href=#docker-engine-installation>Docker Engine Installation</a></li><li><a href=#docker-compose-installation>docker-compose Installation</a></li><li><a href=#clone-the-workshop-repo>Clone the workshop repo</a></li></ul><ul><li><a href=#hello-world>Hello World!</a></li><li><a href=#basic-commands-you-need-to-know>Basic commands you need to know</a></li><li><a href=#starting-the-mysql-database-server>Starting the MySQL database server</a><ul><li><a href=#lets-give-it-a-name-btw-can-we-keep-it>Let&rsquo;s give it a name (BTW Can we keep it?)</a></li><li><a href=#does-the-container-keep-on-running-or-do-i-need-something-like-screen-or-what>Does the container keep on running or do I need something like screen or what?!</a></li><li><a href=#how-would-one-configure-the-mysql-database-server-instance>How would one configure the MySQL database server instance?</a></li><li><a href=#how-do-i-save-the-database-outside-the-container>How do I save the database outside the container?</a></li><li><a href=#running-the-mysql-database-server-container>Running the MySQL database server container</a></li></ul></li><li><a href=#starting-the-wordpress-instance>Starting the WordPress instance</a><ul><li><a href=#how-can-the-wordpress-container-and-the-mysql-container-communicate-with-each-other>How can the WordPress container and the MySQL container communicate with each other?</a></li><li><a href=#how-can-i-reach-the-wordpress-instance-from-the-outside>How can I reach the WordPress instance from the outside?</a></li><li><a href=#running-the-wordpress-instance-container>Running the WordPress instance container</a></li></ul></li></ul><ul><li><a href=#volumes-aka-mounts>Volumes aka Mounts</a></li><li><a href=#data-containers--aka---volumes-from>Data containers aka <code>--volumes-from</code></a></li></ul><ul><li><a href=#nating-using-iptables>NATing using iptables</a></li><li><a href=#over-seven-bridges-you-must-go-docker0-bridge-and-veth-interfaces>Over seven bridges you must go (docker0 bridge and veth interfaces)</a></li><li><a href=#network-modes-default-host-or-other>Network &ldquo;modes&rdquo; (&ldquo;default&rdquo;, host or other)</a></li><li><a href=#publishing-ports>Publishing ports</a></li><li><a href=#looking-into-your-network>Looking into your network</a></li></ul><ul><li><a href=#cpu-limit>CPU Limit</a></li><li><a href=#memory-and-swap-limit>Memory and Swap Limit</a></li></ul><ul><li><a href=#image-names-explained>Image Names explained</a></li><li><a href=#what-have-layer-cakes-to-do-with-docker-images>What have Layer Cakes to do with Docker Images?</a></li><li><a href=#dockerfile-examples>Dockerfile examples</a><ul><li><a href=#simple-dockerfile-example>Simple Dockerfile Example</a></li><li><a href=#advanced-dockerfile-example>Advanced Dockerfile Example</a></li></ul></li><li><a href=#understanding-dockerfiles>Understanding Dockerfiles</a></li></ul><ul><li><a href=#commands-you-need-to-know-when-working-with-docker-images>Commands you need to know when working with Docker images</a><ul><li><a href=#deleting-a-docker-image>Deleting a Docker image</a></li><li><a href=#build-a-docker-image-from-dockerfile>Build a Docker image from Dockerfile</a></li></ul></li><li><a href=#lets-build-your-first-docker-image>Let&rsquo;s build your first Docker image</a></li><li><a href=#how-can-this-help-in-the-development-workflow>How can this help in the development workflow?</a></li></ul><ul><li><a href=#making-multi-container-applications-simpler-to-start>Making multi container applications simpler to start</a></li><li><a href=#starting-our-multi-container-applications-with-one-command>Starting our multi container applications with one command</a></li><li><a href=#basic-docker-compose-commands>Basic <code>docker-compose</code> commands</a><ul><li><a href=#stopping-all-containers-run-by-the-current-docker-compose-file>Stopping all containers run by the current <code>docker-compose</code> file</a></li><li><a href=#deleting-all-containers-run-by-the-current-docker-compose-file>Deleting all containers run by the current <code>docker-compose</code> file</a></li><li><a href=#restarting-all-container-started-by-the-current-docker-compose-file>Restarting all container started by the current <code>docker-compose</code> file</a></li></ul></li><li><a href=#lets-play-more-with-docker-compose>Let&rsquo;s play more with <code>docker-compose</code>!</a></li><li><a href=#summary-of-these-sections>Summary of these sections</a></li></ul><ul><li><a href=#a-wild-docker-swarm-appeared-kubernetes-used-rolling-update-it-was-very-effective>A wild Docker Swarm appeared. Kubernetes used rolling-update. It was very effective.</a></li><li><a href=#other-orchestration-tools>Other Orchestration Tools</a></li></ul><ul><li><a href=#namespace>Namespace</a></li><li><a href=#pod-po>Pod (<code>po</code>)</a></li><li><a href=#replication-controller-rc>Replication Controller (<code>rc</code>)</a></li><li><a href=#service-svc>Service (<code>svc</code>)</a></li><li><a href=#other-objects>Other &ldquo;Objects&rdquo;</a></li></ul><ul><li><a href=#kubernetes-features>Kubernetes Features</a><ul><li><a href=#the-iptables-rules-will-blow-your-mind>The <code>iptables</code> rules will blow your mind</a></li><li><a href=#you-have-some-network-volumes>You have some Network Volumes?</a></li><li><a href=#and-there-are-even-more-features>And there are even more features!</a></li></ul></li></ul><ul><li><a href=#the-basics-of-kubectl>The Basics of <code>kubectl</code></a><ul><li><a href=#list-objects>List objects</a></li><li><a href=#gather-information-about-one-or-more-objects>Gather information about one or more object(s)</a></li><li><a href=#create-one-or-more-objects>Create one or more object(s)</a></li><li><a href=#delete-one-or-more-objects>Delete one or more object(s)</a></li><li><a href=#execute-command-inside-a-pods-container>Execute command inside a Pod&rsquo;s container</a></li><li><a href=#view-the-logs-of-a-pods-container>View the logs of a Pod&rsquo;s container</a></li></ul></li><li><a href=#advanced-kubectl-usage>Advanced kubectl usage</a><ul><li><a href=#update-the-pods-of-a-replication-controller-during-runtime>Update the Pods of a Replication Controller during runtime</a></li><li><a href=#scaling-running-replication-controller>Scaling running Replication Controller</a></li></ul></li></ul><ul><li><a href=#install-ansible>Install Ansible</a></li><li><a href=#create-the-cluster-inventory-file-for-the-deployment>Create the cluster inventory file for the deployment</a></li><li><a href=#deploying-the-kubernetes-cluster>Deploying the Kubernetes cluster</a></li><li><a href=#summary-of-the-kubernetes-deployment>Summary of the Kubernetes deployment</a></li><li><a href=#test-the-kubernetes-cluster-health>Test the Kubernetes cluster health</a></li><li><a href=#take-a-look-at-the-pre-installed-kube-system-containers>Take a look at the pre-installed <code>kube-system</code> containers</a><ul><li><a href=#kubernetes-own-dashboard>Kubernetes own Dashboard</a></li><li><a href=#monitoring-the-nodes-and-containers-with-heapster-and-grafana>Monitoring the nodes and containers (with Heapster and Grafana)</a></li><li><a href=#all-container-logs-in-one-place-with-an-elk-stack>All Container logs in one place with an ELK stack</a></li></ul></li></ul><ul><li><a href=#busybox-pod-example>BusyBox Pod Example</a></li><li><a href=#wordpress-and-mysql-pod-example>WordPress and MySQL Pod Example</a></li></ul><ul><li><a href=#run-the-guestbook>Run the Guestbook</a></li><li><a href=#test-the-guestbook>Test the Guestbook</a></li><li><a href=#shutdown-one-node>Shutdown one node</a></li></ul><ul><li><a href=#wordpress--mysql---wip>WordPress + MySQL - WIP</a></li></ul><ul><li><a href=#nginx-dockerfile>nginx Dockerfile</a></li><li><a href=#wordpress-and-mysql-docker-composeyml>WordPress and MySQL <code>docker-compose.yml</code></a></li></ul></nav><hr><h1 id=goal-of-the-workshop>Goal of the Workshop</h1><p>The workshop is going to show how simple it is to use Docker and why it is worth a thought to implement it into your development workflow.
The second topic is how to compose containers with <code>docker-compose</code>.
The last part is about the container orchestration tool Kubernetes by Google. As part of this you are going to create a <a href=http://kubernetes.io/>Kubernetes</a> cluster and you take a look at the internal services of Kubernetes and deploy applications on top of it.</p><h1 id=heads-up---blogger-words>Heads up - &ldquo;Blogger&rdquo; Words</h1><ul><li><strong>Grey Boxes with green line on the left</strong>: Mostly contain an useful tip, expected command output or something funny.</li><li><strong>TASK</strong>: Is a refer to a task in the workshop repository.</li><li><strong>WDWD</strong>: Stands for &ldquo;What does what do&rdquo; aka &ldquo;Me explaining what the things listed below do&rdquo; (short forms FTW!). I only explain new things in these sections.</li></ul><h1 id=group-partition-schema>Group Partition Schema</h1><p>Two groups ore more should be good. Per group at least two or more people.
Every group works on their own <a href=http://kubernetes.io/>Kubernetes</a> cluster.
If there are people that aren&rsquo;t as &ldquo;advanced&rdquo;, they can play around with <a href=https://docs.docker.com/swarm/overview/>Docker Swarm</a> (No tutorial provided in this post!).</p><h1 id=special-details>Special details</h1><p>A prepared VirtualBox Image will be given around on an USB stick, during the preparation of the workshop.
The VM Username is <code>workshop</code> and so is the password.</p><h2 id=whats-in-the-fcking-boxhttpswwwyoutubecomwatchvhoklpjavk_w><a href="https://www.youtube.com/watch?v=HOkLPjaVK_w">&ldquo;What&rsquo;s in the f*cking box?!&rdquo;</a></h2><p>Fedora 23 with Docker and Cockpit enabled.
Cockpit is enabled, so I can simply help and also monitor the VMs, if a problem occurs.
Firewalld removed, Iptables cleared and persistence disabled.</p><h3 id=why-is-the-vm-running-fedora>Why is the VM running Fedora?</h3><p>That&rsquo;s simple, instead of, e.g., Debian, Ubuntu or CentOS? Fedora is more up to date. Not like Debian :P
Yes, up to date doesn&rsquo;t makes it more stable, but I never had a problem yet and having the latest version of packages is often just awesome, because of improvements or new features.</p><hr><h1 id=readme>README</h1><center>![RTFM before asking](RTFM.png)</center><p>If you don&rsquo;t know any further, add <strong><code>--help</code></strong> to the command, to get a help page that should guide you to your goal or use <strong><code>man INSERT_COMMAND_HERE</code></strong> to show the man(ual) page for the given command. If you can&rsquo;t solve your problem feel free to ask me.</p><blockquote><p>There are no dumb questions, but please don&rsquo;t ask them. Okay?
&ndash; <em>Alexander Trost</em></p></blockquote><hr><h1 id=intro-container-and-microservices>Intro: Container and Microservices</h1><h2 id=why-do-people-like-the-docker-principle>Why do people like the Docker-&ldquo;Principle&rdquo;?</h2><p>The Docker-&ldquo;Principle&rdquo; is simpleness. Making it as simple as possible to for example starting a WordPress instance with database server with only two commands (or one command using <code>docker-compose</code>).
Simpleness that almost everybody, with a little knowledge about using a shell or cmd, could do it. That&rsquo;s what makes Docker great and bad again, because there are a lot of people that have little to no knowledge about &ldquo;basic&rdquo; troubleshooting. I had open issues, because of people <strong>A)</strong> not RTFM, <strong>B)</strong> No knowledge about how to troubleshoot problems on their own first.</p><p>Overall Docker is an awesome tool, that is more and more growing with each release and with all the awesome open source applications for Docker like <a href=http://kubernetes.io/>Kubernetes</a>, <a href=https://clusterhq.com/flocker/introduction/>Flocker</a>, <a href=https://www.weave.works/>Weave</a> and many more.</p><h2 id=micro-what-microservices>Micro-what? Microservices!</h2><p>Microservices are small gears, like a MySQL database, NoSQL database, Redis, etc., for a big application like Redmine, GitLab, etc.
They allow you to test local in a small scale and then scale with your load (<em>if done right</em>).</p><h2 id=container>Container?!</h2><p>Currently Docker containers can (and will) only allow you to run any distribution that runs on Linux. NO WINDOWS or other bullshit!
Every container runs in it&rsquo;s own namespace. For this we need to understand how namespaces work.
A namespace is a separated &ldquo;branch&rdquo;, where processes, mounts, etc. can exist without disturbing other processes, mounts, etc. in other namespaces.</p><p>An advantage of namespaces is, that you can limit the cpu, memory, network, etc. for them. For example, a process that goes rogue, can be limited to specific resource limits.</p><p>This diagram should make it clear, how namespaces can create &ldquo;unlimited&rdquo; separated and isolated container environments.</p><center>![Linux cgroups namespaces hierachy - by Shmuel Csaba Otto Traian](linux-cgroups-namespaces-systemd-hierachy.png)
<i>This photo ([original](https://commons.wikimedia.org/wiki/File:Linux_kernel_unified_hierarchy_cgroups_and_systemd.svg)) is made by Shmuel Csaba Otto Traian, licensed under the [CC Attribution-Share Alike 3.0 Unported](https://creativecommons.org/licenses/by-sa/3.0/deed.en) license.</i></center><p>Docker and most other containers utilities not only use namespaces to separate containers from each other. There are several other techniques, that further improve security.</p><p>A container uses the existing Linux kernel, there are less resources used, because a container just uses the existing kernel processes and doesn&rsquo;t need to spawn them like when using a virtual machine.</p><p>Why is it a good idea to use separate namespaces for networked applications? Because if someone breaches for example your webserver, he is just in the container and not on the host server. If you&rsquo;ll then detect the breach, you just stop the container and would restart it with an updated image version that contains the latest webserver software.</p><blockquote><p><strong>TL;DR</strong> A container is NOT a VM. A container is a &ldquo;separate&rdquo; Linux system, that runs in an isolated namespaced environment of the running kernel on the running kernel.</p></blockquote><hr><h1 id=prepare-for-the-docker-madness>Prepare for the Docker Madness</h1><blockquote><p><strong>TASK</strong> <a href=https://github.com/galexrt/workshop-docker/tree/master/setup101><code>setup101</code></a></p></blockquote><h2 id=side-notes>Side Notes</h2><ul><li>You can install Docker directly on your system or in a VirtualBox. If you use a VirtualBox, please consider using Fedora 23 or anyother linux distro with at least kernel 4.x.</li><li>If you are a Windows or Mac OSX user, ask yourself &ldquo;What have I done wrong, to use such shitty plattform?&rdquo;, switch to linux m8, thanks! You can use <a href=http://boot2docker.io/>Boot2Docker</a> (I don&rsquo;t help or give any support if you use it though!).</li><li>The download and login details to the VM are located <a href=#special-details>here</a>.</li></ul><h2 id=system-requirements>System &ldquo;Requirements&rdquo;</h2><p><strong>Nope, they&rsquo;re not!</strong></p><ul><li>A working Linux distro</li><li>Linux Kernel 4.x or higher (&ldquo;included&rdquo; in the Virtualbox)</li></ul><p>You can run Docker under any kernel 3.16+, but I recommend you to use the latest kernel for the implemented improvements in some of the file system and network systems Docker uses.</p><h2 id=docker-engine-installation>Docker Engine Installation</h2><blockquote><p><strong>If you use the workshop VM, you can skip this section.</strong></p></blockquote><p>To install the Docker Engine run the command:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span><span style=color:#44475a>curl -sSL https://get.docker.com/ | sh
</span></span></span></code></pre></div><p>For a more details about the installation of the Docker Engine, see the Linux installation <a href=https://docs.docker.com/engine/installation/linux/>docs</a> or the Windows installation <a href=https://docs.docker.com/engine/installation/windows/>docs</a>.</p><p>When talking about Docker, we almost always talk about the Docker Engine. Because the Docker Engine is, as the name implies, the engine for the containers.</p><p>After you have installed it without any errors popping up, you have to start the Docker Engine.
When your distribution is using systemd:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span><span style=color:#44475a>systemctl enable docker.service
</span></span></span><span style=display:flex><span><span style=color:#44475a>systemctl start docker.service
</span></span></span></code></pre></div><p>On distribution without systemd:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span><span style=color:#44475a>/etc/init.d/docker start
</span></span></span></code></pre></div><p>This starts Docker and when using systemd enables the autostart for Docker Engine.</p><h2 id=docker-compose-installation>docker-compose Installation</h2><blockquote><p><strong>If you use the workshop VM, you can skip this section.</strong></p></blockquote><center>![docker-compose Logo](docker-compose-logo.png)
_`docker-compose` Logo by Docker_</center><p>With curl we download the <code>docker-compose</code> binary, then we move <code>docker-compose</code> to your <code>/usr/local/bin</code> that is in your <code>PATH</code> and set the execute permission.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span><span style=color:#44475a>wget -O /usr/local/bin/docker-compose &#34;https://github.com/docker/compose/releases/download/1.8.0/docker-compose-`uname -s`-`uname -m`&#34;
</span></span></span><span style=display:flex><span><span style=color:#44475a>sudo chmod +x /usr/local/bin/docker-compose
</span></span></span></code></pre></div><p>For more detailed <code>docker-compose</code> installation docs, see <a href=https://docs.docker.com/compose/install/>here</a>.</p><p>After you have followed the commands above, you can test if you have installed <code>docker-compose</code> successfully by running <code>docker-compose --version</code>.</p><p>The recording below shows the expected output for the <code>docker-compose</code> installation and the installation test.</p><blockquote><p><strong>Expected Output</strong></p><script type=text/javascript src=https://asciinema.org/a/eujxdopxxvh02bo4mayhfaml0.js id=asciicast-eujxdopxxvh02bo4mayhfaml0 async data-speed=1.5></script></blockquote><h2 id=clone-the-workshop-repo>Clone the workshop repo</h2><blockquote><p><strong>If you use the workshop VM, you can skip these steps.</strong></p></blockquote><p>Clone the Workshop repo from GitHub <code>https://github.com/galexrt/workshop-docker.git</code>. It&rsquo;ll provide all files and tasks used in the Workshop.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span><span style=color:#44475a>git clone https://github.com/galexrt/workshop-docker.git
</span></span></span></code></pre></div><blockquote><p><strong>Expected Output</strong></p><script type=text/javascript src=https://asciinema.org/a/0dxalykr3w4z2gpde4e4utkgl.js id=asciicast-0dxalykr3w4z2gpde4e4utkgl async data-speed=1.5></script></blockquote><hr><h1 id=running-your-first-docker-containers>Running your first Docker containers</h1><p>This will guide you through the commands needed to start your WordPress instance with MySQL database server.</p><h2 id=hello-world>Hello World!</h2><p>When you have Docker installed correctly, you now have to add your user to the <code>docker</code> group (on most distributions the group is called <code>docker</code>).
To add your user to the <code>docker</code> group, you can run the following command:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span><span style=color:#44475a>gpasswd -a $USER docker
</span></span></span></code></pre></div><p>Please relog or restart your machine after you have added yourself to the group.</p><p>Now to test your Docker installation, we start like when learning a new programming language, with the simplest example. A &ldquo;Hello World&rdquo; container.
To run the &ldquo;Hello World&rdquo; container, you simply run the following command:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span><span style=color:#44475a>docker run hello-world
</span></span></span></code></pre></div><blockquote><p><strong>Example Output</strong></p><script type=text/javascript src=https://asciinema.org/a/b9v692n10olac46xnmvcqztfy.js id=asciicast-b9v692n10olac46xnmvcqztfy async data-speed=1.5></script></blockquote><p>When everything went correct, I can now welcome you to the big World of the containers!</p><h2 id=basic-commands-you-need-to-know>Basic commands you need to know</h2><ul><li><code>docker ps </code>- Displays all currently running containers. To display all containers, add the <code>-a</code> option or use the filter option <code>-f []</code> (can be specified multiple times).</li><li><code>docker stop CONTAINER</code> - Sends a <code>SIGTERM</code> signal to the containers main process. Where <code>CONTAINER</code> is a container ID or name.</li><li><code>docker rm CONTAINER</code> - Deletes a stopped/exited container. Where <code>CONTAINER</code> is a container ID or name.</li></ul><p>One of the most important commands we need is <code>docker run</code>. So we now take a look at it and run:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span><span style=color:#44475a>docker run --help
</span></span></span></code></pre></div><blockquote><p><strong>Expected Output</strong>
<img src=docker-run-help.png alt="docker run &ndash;help Output"></p></blockquote><p>As we can see <code>docker run</code> has a lot of options, to choose from.
In this workshop we are only covering some of basic options, you should know to begin with.</p><blockquote><p><img src=docker-run-syntax.png alt="Docker run syntax">
<strong>WDWD</strong></p><ul><li><code>[OPTIONS]</code> - Run flags/options.</li><li><code>IMAGE</code> - The name of a Docker image.</li><li><code>[COMMAND] [ARG ...]</code> - Depending on the images, used as arguments or as the command by the entrypoint.</li></ul></blockquote><p>I&rsquo;m going in depth about image names, command args and entrypoint later on (<a href=#Understanding-Dockerfiles>here</a>).</p><h2 id=starting-the-mysql-database-server>Starting the MySQL database server</h2><p>I&rsquo;m going to use the MySQL Docker image from <a href=https://github.com/sameersbn>sameersbn</a> in the workshop. Because this image is more convenient to setup, than the official available MySQL and MariaDB Docker image.
So we specify the <code>IMAGE</code> argument in our command now.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span><span style=color:#44475a>docker run \
</span></span></span><span style=display:flex><span><span style=color:#44475a>    sameersbn/mysql:latest
</span></span></span></code></pre></div><h3 id=lets-give-it-a-name-btw-can-we-keep-it>Let&rsquo;s give it a name (BTW Can we keep it?)</h3><p><em>How about Dogmeat? :D</em></p><p>Our MySQL database server container should have a name, so we don&rsquo;t need to use the randomized name or unique ID.
Every container gets an unique ID and randomized name. We can override the name with the <code>--name NAME</code> option.
Let&rsquo;s name it &ldquo;database&rdquo;.
Our command now looks like this:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span><span style=color:#44475a>docker run \
</span></span></span><span style=display:flex><span><span style=color:#44475a>    --name mysql \
</span></span></span><span style=display:flex><span><span style=color:#44475a>    sameersbn/mysql:latest
</span></span></span></code></pre></div><p>Giving a container a &ldquo;simple&rdquo; name, is important to simplify later processes, like connecting from the WordPress instance to the MySQL database server.</p><h3 id=does-the-container-keep-on-running-or-do-i-need-something-like-screen-or-what>Does the container keep on running or do I need something like screen or what?!</h3><p>The <code>--detach</code> and <code>--interactive</code> options.
If you now run the command to start the container, upon start you see some log output coming, but should notice that when closing the terminal, the database container immediately gets stopped/exits (To see if the container exited, use <code>docker ps -a</code>).
When you run a container, by default your current <code>stdin</code> and <code>stdout</code> will be attached to the container, making it interactive (If you want an interactive container, you should still add <code>--interactive</code> option). To disable the attachment of <code>stdin</code> and <code>stdout</code> add the <code>--detach</code> (or short <code>-d</code>) option to the command. Using the <code>--detach</code> (or <code>-d</code>) option, runs the container detached.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span><span style=color:#44475a>docker run \
</span></span></span><span style=display:flex><span><span style=color:#44475a>    -d \
</span></span></span><span style=display:flex><span><span style=color:#44475a>    --name mysql \
</span></span></span><span style=display:flex><span><span style=color:#44475a>    sameersbn/mysql:latest
</span></span></span></code></pre></div><p>Running a container detached is most common for containers with server or headless application, like Nginx, MySQL, etc.</p><p>Don&rsquo;t forget to delete the exited/stopped MySQL database container with the remove command, <code>docker rm database</code> (where database is the name or ID of the container) else if starting you&rsquo;ll get an error saying that a container already exists with the same name.
In case you already forgot, here&rsquo;s how to delete the container</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span><span style=color:#44475a>docker rm NAME
</span></span></span></code></pre></div><h3 id=how-would-one-configure-the-mysql-database-server-instance>How would one configure the MySQL database server instance?</h3><p>One big questions will be for you, &ldquo;How can I configure the MySQL database server?&rdquo; in the container.
You can..
<strong>A)</strong> use config files
or
<strong>B)</strong> use environment variables (portable and the best way).</p><p>The most portable way is to use environment variables.
Most containers that are configured through environment variables, have a script, the entrypoint, that sets config variables and a lot more, before the main application/program is started.</p><p>In the case of <code>sameersbn/mysql:latest</code> the following environment variables are used for basic configuration:</p><ul><li><code>DB_USER</code> - Database User to create. User will be given access to the database(s) from <code>DB_NAME</code>.</li><li><code>DB_PASS</code> - Password for the given database user.</li><li><code>DB_NAME</code> - Database to create and gain access to the username given in <code>DB_USER</code>.</li></ul><p>To specify an environment variable, the <code>--env</code> (or <code>-e</code>) option is used.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span><span style=color:#44475a>docker run \
</span></span></span><span style=display:flex><span><span style=color:#44475a>[...]
</span></span></span><span style=display:flex><span><span style=color:#44475a>    -e &#39;DB_USER=wordpress&#39; \
</span></span></span><span style=display:flex><span><span style=color:#44475a>    -e &#39;DB_PASS=wordpress&#39; \
</span></span></span><span style=display:flex><span><span style=color:#44475a>    -e &#39;DB_NAME=wordpress&#39; \
</span></span></span><span style=display:flex><span><span style=color:#44475a>[...]
</span></span></span></code></pre></div><p><em>*sarcasm on* 100% secure passwords used here *sarcasm off*</em></p><blockquote><p>Use secure passwords when running in production!
<code>openssl rand -base64 20</code>, can be used to generate a &ldquo;secure&rdquo; password.</p></blockquote><h3 id=how-do-i-save-the-database-outside-the-container>How do I save the database outside the container?</h3><p>You want to save your data outside of the container, for a simple reason: If you stop and delete the container, your data is gone. For this Docker has volumes.
A Volume is like a mount from the host system inside the container.
The volume option is <code>--volume</code> (or <code>-v</code>). The syntax of a volume option is for example:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span><span style=color:#44475a>docker run \
</span></span></span><span style=display:flex><span><span style=color:#44475a>[...]
</span></span></span><span style=display:flex><span><span style=color:#44475a>    -v HOST_PATH:CONTAINER_PATH:MODE
</span></span></span><span style=display:flex><span><span style=color:#44475a>[...]
</span></span></span></code></pre></div><blockquote><p><strong>WDWD</strong></p><ul><li><code>HOST_PATH</code> - Path to mount from the host system inside the container.</li><li><code>CONTAINER_PATH</code> - &ldquo;Mount&rdquo; destination path in the container.</li><li><code>:MODE</code> - Is optional. Can be <code>rw</code> (read-write) or <code>ro</code> (read-only). Defaults to <code>rw</code>.</li></ul><p><strong>NOTE</strong></p><ul><li>If the host path doesn&rsquo;t exist it&rsquo;ll get created.</li><li>The host path can be a file too.</li><li>Docker doesn&rsquo;t distinguish between file or folder. If the path doesn&rsquo;t exist, a directory always get&rsquo;s created.</li></ul></blockquote><h3 id=running-the-mysql-database-server-container>Running the MySQL database server container</h3><p>Now we have all components, we need for running the MySQL container.</p><p>When we have put everything we learned now together, we should get something that looks like this:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span><span style=color:#44475a>docker run \
</span></span></span><span style=display:flex><span><span style=color:#44475a>    -d \
</span></span></span><span style=display:flex><span><span style=color:#44475a>    --name mysql \
</span></span></span><span style=display:flex><span><span style=color:#44475a>    -e &#39;DB_USER=wordpress&#39; \
</span></span></span><span style=display:flex><span><span style=color:#44475a>    -e &#39;DB_PASS=wordpress&#39; \
</span></span></span><span style=display:flex><span><span style=color:#44475a>    -e &#39;DB_NAME=wordpress&#39; \
</span></span></span><span style=display:flex><span><span style=color:#44475a>    -v /opt/docker/wordpress/mysql:/var/lib/mysql \
</span></span></span><span style=display:flex><span><span style=color:#44475a>    sameersbn/mysql:latest
</span></span></span></code></pre></div><blockquote><p><strong>WDWD</strong></p><ul><li><code>-d</code> - To run the container detached.</li><li><code>--name wordpress</code> - Gives the container the name &ldquo;wordpress&rdquo;.</li><li><code>-e ...=...</code> - Specifies environment variables, that are used for configuration.</li><li><code>-v /opt/docker/wordpress/mysql:/var/lib/mysql</code> - Mount <code>/opt/docker/wordpress/mysql</code> directory at <code>/var/lib/mysql</code> into the container.</li><li><code>sameersbn/mysql:latest</code> - Specifies what image to use.</li></ul></blockquote><p>If you run the run command with the <code>--detach</code> (or <code>-d</code>), it&rsquo;ll just return the unique (long) ID of the container.
With <code>docker logs CONTAINER</code> (where <code>CONTAINER</code> is a container ID or name), you&rsquo;ll get the logs of the first process in the container.</p><h2 id=starting-the-wordpress-instance>Starting the WordPress instance</h2><p>So you now already know some &ldquo;basics&rdquo;, about starting containers. I&rsquo;m not going in depth with every little thing anymore.</p><h3 id=how-can-the-wordpress-container-and-the-mysql-container-communicate-with-each-other>How can the WordPress container and the MySQL container communicate with each other?</h3><p>In Docker by default all containers can talk to each other, if they know the IP address, that is called short <code>ICC</code> or <code>Inter Container Communication</code> (<code>docker daemon [...] --icc=[true/false]</code>).
To allow the WordPress container to contact the MySQL container, we would need to get the IP address of the MySQL container. You can use the <code>docker inspect CONTAINER_OR_IMAGE</code> (where <code>CONTAINER_OR_IMAGE</code> is the unique ID or name of a container), the command returns JSON formatted output with &ldquo;all&rdquo; informations about the given container(s) or image(s).</p><p>But to do this everytime the MySQL container get&rsquo;s restarted, is too much work. That&rsquo;s where Docker implements a mechanism called links.
As you might guess, with links, you can &ldquo;link&rdquo;/connect containers together. Keep in mind that with the above mentioned Docker daemon option <code>--icc=true</code> all containers can talk to each other, when knowing the IP address of another container.</p><p>The link option syntax is like this:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span><span style=color:#44475a>docker run \
</span></span></span><span style=display:flex><span><span style=color:#44475a>[OPTIONS]
</span></span></span><span style=display:flex><span><span style=color:#44475a>    --link=CONTAINER_NAME:LINK_NAME \
</span></span></span><span style=display:flex><span><span style=color:#44475a>[IMAGE]
</span></span></span></code></pre></div><blockquote><p><strong>WDWD</strong></p><ul><li><code>CONTAINER_NAME</code> - The container to link.</li><li><code>LINK_NAME</code> - The name of the &ldquo;/etc/hosts&rdquo; entry (aka &ldquo;fake&rdquo; DNS record).</li></ul></blockquote><p>If you link the MySQL container to the WordPress container, the WordPress container will get a special entry in it&rsquo;s <code>/etc/hosts</code> about the MySQL container and &ldquo;inherit&rdquo; all of the MySQL containers environment variables prefixed with the link name.
For example the link option is <code>--link=mysql:database</code>.</p><p>So if we take a look at the <code>/etc/hosts</code> and environment variables inside the WordPress container, with the container link to the MySQL container, it should get much clearer how the &ldquo;linking works&rdquo;.
To show you the created <code>/etc/hosts</code> entry and the environment variables created inside the container.
I&rsquo;m running the following command, to just demonstrate it:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span><span style=color:#44475a>docker run \
</span></span></span><span style=display:flex><span><span style=color:#44475a>    -d \
</span></span></span><span style=display:flex><span><span style=color:#44475a>    --name=wordpress \
</span></span></span><span style=display:flex><span><span style=color:#44475a>    --entrypoint=/bin/bash \
</span></span></span><span style=display:flex><span><span style=color:#44475a>    wordpress
</span></span></span><span style=display:flex><span><span style=color:#44475a>cat /etc/hosts
</span></span></span><span style=display:flex><span><span style=color:#44475a>env
</span></span></span><span style=display:flex><span><span style=color:#44475a>exit # To exit the container
</span></span></span><span style=display:flex><span><span style=color:#44475a>docker rm wordpress
</span></span></span></code></pre></div><blockquote><p><strong>WDWD</strong></p><ul><li><code>--entrypoint=/bin/bash</code> - This overwrites the command executed, when the container is started.</li></ul><p><strong>Expected Output</strong></p><script type=text/javascript src=https://asciinema.org/a/7ih8kji7y96c5bcev61d7zx1u.js id=asciicast-7ih8kji7y96c5bcev61d7zx1u async data-speed=1.5></script><p>(The output here may looks a bit different, due to small changes to the commands executed in the demo)</p></blockquote><p>The environment variables are created inside the new container only, not in the link source! The container that is used as the link destination is left untouched.
beginning with <code>DATABASE_</code>, allow to get the environment variables and published ports from the linked container very simple.</p><blockquote><p><strong>NOTE</strong></p><ul><li>There can be multiple links with the same name.</li><li>You can&rsquo;t attach two same named links to the destination container (the container you are creating).</li></ul></blockquote><h3 id=how-can-i-reach-the-wordpress-instance-from-the-outside>How can I reach the WordPress instance from the outside?</h3><p>To make a port available to the &ldquo;public&rdquo;, that&rsquo;s why it&rsquo;s called publishing ports, you use the <code>--publish</code> (or <code>-p</code>) option in this format:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span><span style=color:#44475a>docker run \
</span></span></span><span style=display:flex><span><span style=color:#44475a>[OPTIONS]
</span></span></span><span style=display:flex><span><span style=color:#44475a>    -p HOST_ADDRESS:HOST_PORT:CONTAINER_PORT/PROTOCOL
</span></span></span><span style=display:flex><span><span style=color:#44475a>[IMAGE] [ARGUMENTS]
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span><span style=color:#44475a>docker run \
</span></span></span><span style=display:flex><span><span style=color:#44475a>[OPTIONS] \
</span></span></span><span style=display:flex><span><span style=color:#44475a>    -p 80:80/tcp \
</span></span></span><span style=display:flex><span><span style=color:#44475a>[IMAGE] [ARGUMENTS]
</span></span></span></code></pre></div><blockquote><p><strong>WDWD</strong></p><ul><li><code>HOST_ADDRESS:</code> - Optional. By default <code>0.0.0.0</code>. Address to expose the port on the host system.</li><li><code>HOST_PORT</code> - Host port to expose the container port on.</li><li><code>CONTAINER_PORT</code> - Container port to expose.</li><li><code>/PROTOCOL</code> - Optional. By default <code>tcp</code>. The port protocol, currently can be <code>tcp</code> or <code>udp</code>.</li></ul></blockquote><p>And that&rsquo;s how you forward/publish ports from the container to the outside.</p><h3 id=running-the-wordpress-instance-container>Running the WordPress instance container</h3><p>To configure our WordPress container instance, the Docker image comes with extra environment variables.
The WordPress image name is <code>wordpress</code> (<a href=https://hub.docker.com/_/wordpress/>Docker Hub Page</a>)</p><p>The possible environment variables for the configuration are the following ones:</p><ul><li><code>-e WORDPRESS_DB_HOST=...</code> Defaults to the DNS name or IP address and port of the linked MySQL container, link name <code>mysql</code>.</li><li><code>-e WORDPRESS_DB_USER=...</code> Defaults to &ldquo;root&rdquo;.</li><li><code>-e WORDPRESS_DB_PASSWORD=...</code> Defaults to the value of the <code>MYSQL_ROOT_PASSWORD</code> environment variable from the linked MySQL container, link name <code>mysql</code>.</li><li><code>-e WORDPRESS_DB_NAME=...</code> - Defaults to &ldquo;wordpress&rdquo;.</li><li><code>-e WORDPRESS_TABLE_PREFIX=...</code> - Defaults to &ldquo;&rdquo;. Only set this when you need to override the default table prefix in <code>wp-config.php</code>.</li><li><code>-e WORDPRESS_AUTH_KEY=...</code>, <code>-e WORDPRESS_SECURE_AUTH_KEY=...</code>, <code>-e WORDPRESS_LOGGED_IN_KEY=...</code>, <code>-e WORDPRESS_NONCE_KEY=...</code>, <code>-e WORDPRESS_AUTH_SALT=...</code>, <code>-e WORDPRESS_SECURE_AUTH_SALT=...</code>, <code>-e WORDPRESS_LOGGED_IN_SALT</code> - Set these to a secure random value; in production use different random values per variable.</li></ul><p>In the case of the <code>WORDPRESS_DB_HOST</code>, the value would be the name of the link name in the <code>docker run</code> command below. In the case of the below command, the <code>WORDPRESS_DB_HOST</code> would be <code>database</code>.
The command to run the WordPress container is like this:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span><span style=color:#44475a>docker run \
</span></span></span><span style=display:flex><span><span style=color:#44475a>    -d \
</span></span></span><span style=display:flex><span><span style=color:#44475a>    --name wordpress \
</span></span></span><span style=display:flex><span><span style=color:#44475a>    -e &#39;WORDPRESS_DB_HOST=database&#39; \
</span></span></span><span style=display:flex><span><span style=color:#44475a>    -e &#39;WORDPRESS_DB_USER=wordpress&#39; \
</span></span></span><span style=display:flex><span><span style=color:#44475a>    -e &#39;WORDPRESS_DB_PASSWORD=wordpress&#39; \
</span></span></span><span style=display:flex><span><span style=color:#44475a>    -e &#39;WORDPRESS_AUTH_KEY=wordpress&#39; \
</span></span></span><span style=display:flex><span><span style=color:#44475a>    -e &#39;WORDPRESS_SECURE_AUTH_KEY=wordpress&#39; \
</span></span></span><span style=display:flex><span><span style=color:#44475a>    -e &#39;WORDPRESS_LOGGED_IN_KEY=wordpress&#39; \
</span></span></span><span style=display:flex><span><span style=color:#44475a>    -e &#39;WORDPRESS_NONCE_KEY=wordpress&#39; \
</span></span></span><span style=display:flex><span><span style=color:#44475a>    -e &#39;WORDPRESS_AUTH_SALT=wordpress&#39; \
</span></span></span><span style=display:flex><span><span style=color:#44475a>    -e &#39;WORDPRESS_SECURE_AUTH_SALT=wordpress&#39; \
</span></span></span><span style=display:flex><span><span style=color:#44475a>    -e &#39;WORDPRESS_LOGGED_IN_SALT=wordpress&#39; \
</span></span></span><span style=display:flex><span><span style=color:#44475a>    --link mysql:database \
</span></span></span><span style=display:flex><span><span style=color:#44475a>    -p 80:80 \
</span></span></span><span style=display:flex><span><span style=color:#44475a>    wordpress
</span></span></span></code></pre></div><blockquote><p><strong>WDWD</strong></p><ul><li><code>-d</code> - To run the container detached.</li><li><code>--name wordpress</code> - Gives the container the name &ldquo;wordpress&rdquo;.</li><li><code>-e ...=...</code> - Specifies environment variables, that are used for configuration.</li><li><code>--link mysql:database</code> - Creates a &ldquo;link&rdquo; named <code>mysql</code>, from the <code>database</code> container.</li><li><code>wordpress</code> - Specifies what image to use.</li></ul></blockquote><p>Now execute the command and you should be able to see the WordPress installation screen at http://127.0.0.1:80/.</p><blockquote><p><strong>NOTE</strong></p><p>All data inside the container, will be lost on removal of the container! In our case, we already use volumes, so don&rsquo;t worry.</p></blockquote><p>For cleanup you now stop and delete the container.
To stop the WordPress instance, run <code>docker stop CONTAINER</code> (where <code>CONTAINER</code> in this case is <code>wordpress</code>). After stopping the container, you can remove it with <code>docker rm CONTAINER</code>.
The container has to be stopped, before it can be removed.</p><hr><blockquote><p><strong>Now that we looked into some of most important beginner topics of Docker, we are going to take a look deeper into these topics.</strong></p></blockquote><hr><h1 id=how-do-you-execute-a-commandshell-inside-the-container>How do you execute a command/shell inside the container?</h1><p>To execute a command inside the container, after it has been started, for example in the MySQL container for maintenance access.</p><p>With our example, MySQL container let&rsquo;s display a list of the existing databases.
The command to display the databases from shell is:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span><span style=color:#44475a>mysql -u root -p -e &#34;SHOW DATABASES;&#34;
</span></span></span></code></pre></div><p>For this case, the command <code>docker exec</code> is used.
The syntax of <code>docker exec</code> is a bit equal to the of <code>docker run</code>. Running <code>docker exec --help</code> as always to show you the help/syntax menu.</p><blockquote><p><strong>Expected Output</strong>
<img src=docker-exec-help.png alt="docker exec &ndash;help Output"></p></blockquote><p>To run a command interactively for example opening an interactive MySQL shell session, the command would be:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span><span style=color:#44475a>docker exec \
</span></span></span><span style=display:flex><span><span style=color:#44475a>    -it \
</span></span></span><span style=display:flex><span><span style=color:#44475a>    CONTAINER \
</span></span></span><span style=display:flex><span><span style=color:#44475a>    mysql -u root -p
</span></span></span></code></pre></div><blockquote><p><strong>WDWD</strong></p><ul><li><code>-i</code> - Attach the stdin aka interactive.</li><li><code>-t</code> - Optional. Allocates a pseudo-TTY (pseudo TeleTYpewriter) to the shell/command run.</li><li><code>CONTAINER</code> - Container ID or name of the container the command should be executed in.</li><li><code>mysql -u root -p</code> - The command and arguments to execute.</li></ul></blockquote><p>You would use the <code>--detach</code> (or <code>-d</code>) option to run a non-interactive command in the background with no logs or return (Good for cron jobs <em>;)</em>).</p><blockquote><p><strong>NOTE</strong></p><ul><li>To be able to run a command in the container, the command/binary/file/whatever has to exist in the container!</li></ul></blockquote><hr><h1 id=data-data-everywhere>Data, Data everywhere</h1><center>![Data Data everywhere Meme - Made with Imgur Memegen](data-data-everywhere-meme.png)</center><h2 id=volumes-aka-mounts>Volumes aka Mounts</h2><p>Volumes add persistence to your data. When a container is stopped and removed, the data in the container is lost.
With a volume you would mount the part of the data out of the container. For example with our MySQL container, we would mount the container path <code>/var/lib/mysql/</code> (contains the MySQL databases) somewhere safe.
So if the MySQL server inside the container should ever crash and the container then be terminated, you can just fire up with the <code>docker start</code> command or delete the container and execute the <code>docker run</code> command again. The MySQL container then starts using the data where it exited.</p><p>I already showed the option, but here is it again (Long form <code>--volume=</code>):</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span><span style=color:#44475a>docker run \
</span></span></span><span style=display:flex><span><span style=color:#44475a>[OPTIONS]
</span></span></span><span style=display:flex><span><span style=color:#44475a>    -v HOST_PATH:CONTAINER_PATH:MODE
</span></span></span><span style=display:flex><span><span style=color:#44475a>[IMAGE] [ARGUMENTS]
</span></span></span></code></pre></div><blockquote><p><strong>WDWD</strong></p><ul><li><code>HOST_PATH</code> - Path to mount from the host system inside the container.</li><li><code>CONTAINER_PATH</code> - &ldquo;Mount&rdquo; destination path in the container.</li><li><code>:MODE</code> - Is optional. Can be <code>rw</code> (read-write) or <code>ro</code> (read-only). Defaults to <code>rw</code>.</li></ul><p><strong>TL;DR</strong> Data inside container to outside of container.</p><p><strong>NOTE</strong></p><ul><li>When the host path doesn&rsquo;t exist, it&rsquo;ll get created. BUT the permissions will be a bit &ldquo;freaky&rdquo;.</li><li>When the path get&rsquo;s created on the host, the directory will be (by default) owned by <code>root:root</code>, mod perms <code>drwxr-xr-x</code>.</li><li>You can now create volumes using the Docker command, but I&rsquo;m not going deeper into this. You can read more about this <a href=https://docs.docker.com/engine/reference/commandline/volume_create/>here</a>.</li></ul></blockquote><h2 id=data-containers--aka---volumes-from>Data containers aka <code>--volumes-from</code></h2><blockquote><p><strong>NOTE</strong></p><ul><li>I do NOT recommend this method as I often enough &ldquo;accidentally&rdquo; clear all exited/dead containers, so my disk space doesn&rsquo;t run out.</li><li>I also have cron jobs running on my servers, that clean exited containers. Meaning data containers would just get cleared out everytime.</li></ul></blockquote><p>You can store data inside another container, that&rsquo;s called data volume containers.
When creating an image, you can specify those volumes. You create a container that has a volume &ldquo;built-into&rdquo; (Specified while the image was built), meaning that assuming it is our MySQL server image the in-built volume would be located at <code>/var/lib/mysql</code>
The data volume container runs &ldquo;nothing&rdquo;, it is just there for purpose of getting used by another container. For this you change the entrypoint with the following run option <code>--entrypoint=COMMAND</code> (where command could be just <code>/bin/true</code>) so the container stops and doesn&rsquo;t run the program it should.</p><p>Now that we would have a data container, we can use the volumes from this container using the <code>--volumes-from=CONTAINER</code> (where <code>CONTAINER</code> is a container name or ID) option.</p><p>Let&rsquo;s assume we have a data container, created from the example here, with the volume <code>/data</code> and we have a second container, running the same image, that would save the data to <code>/data</code>.
In this case using the <code>--volumes-from</code> option would write the data inside the first container, the data container.</p><p>As I wrote I personally don&rsquo;t recommend and I&rsquo;m not even using this method, as I find it bad.</p><hr><h1 id=networking>Networking</h1><center>![Brace Yourself Network Stuff Incoming - Made using Imgur Memegen](network-stuff-brace-yourself-meme.png)</center><h2 id=nating-using-iptables>NATing using iptables</h2><blockquote><p>I&rsquo;m not going to explain NAT here.</p></blockquote><p>NAT also Network Address Translation, allows multiple devices to sit behind one IP address.</p><h2 id=over-seven-bridges-you-must-go-docker0-bridge-and-veth-interfaces>Over seven bridges you must go (docker0 bridge and veth interfaces)</h2><p>Docker creates a bridge that is used as a bridge to your network interfaces (<code>eth0</code>, <code>en0</code>, etc.). The bridge Docker creates is called <code>docker0</code> by default.
By default the <code>docker0</code> bridge will be assigned the <code>172.17.0.1/16</code> IP range as a network. This IP address range will be used, to assign every container a separate IP.
Sometimes the bridge address range needs to be adjusted, in most cases when you are running Docker in a corporate network or the network range is just already in use/allocated.
You would need to add the <code>--bip=192.168.1.0/24</code> (where <code>192.168.1.0/24</code> is an unused IP range) to on Debian based systems to the <code>/etc/default/docker</code> or on RHEL based systems to the <code>/etc/sysconfig/docker</code> or <code>/etc/sysconfig/docker-network</code>.</p><p>When a container is created, a <code>veth</code> interface will be created too (depending on the network mode). The <code>veth</code> interface will have an unique name. <code>veth</code> stands for virtual ethernet device. The <code>veth</code> device will &ldquo;connect&rdquo; to the bridge, to acquire network connectivity. The veth interface will not show the ip address when using tools like <code>ip addr show</code> or <code>ifconfig</code>.</p><blockquote><p><strong>Example Output</strong></p><script type=text/javascript src=https://asciinema.org/a/7czdn4ubsb2k3wtpeunillx32.js id=asciicast-7czdn4ubsb2k3wtpeunillx32 async data-speed=1.5></script><p>This recording shows, the docker0 interface and the veth interface of the database container. In the end we use <code>docker inspect CONTAINER</code> to get the IPAddress of the container.</p></blockquote><p>Docker has the feature to even create an overlay network, between multiple machines. But I&rsquo;m not going deeper into this.
For people interested in this feature, see the Docker docs <a href=https://docs.docker.com/engine/reference/commandline/network_create/>here (Docs Docker network create)</a>.</p><h2 id=network-modes-default-host-or-other>Network &ldquo;modes&rdquo; (&ldquo;default&rdquo;, host or other)</h2><p>I&rsquo;ve wrote, that I&rsquo;m not going deeper into Docker&rsquo;s own (overlay) network feature, but with this topic, I&rsquo;ll have to go into it just a bit.</p><p>When running a container the default network &ldquo;mode&rdquo; is named <code>default</code> (<code>--net=default</code>). The <code>default</code> network &ldquo;mode&rdquo; creates a separate network stack for every container.</p><p>There is also the network &ldquo;mode&rdquo; <code>host</code> available by default. The <code>host</code> network &ldquo;mode&rdquo; gives the host network stack aka &ldquo;full access to the network of the host system&rdquo; inside the container.</p><p>The network &ldquo;mode&rdquo; can be also the name of an (overlay) network created using the Docker &ldquo;client&rdquo; (engine).</p><blockquote><p><strong>Example Output</strong></p><script type=text/javascript src=https://asciinema.org/a/8g8uguep5jej952k259ngzqoe.js id=asciicast-8g8uguep5jej952k259ngzqoe async data-speed=1.5></script><p>In the recording, you can see that when using the default network mode you&rsquo;ll get a &ldquo;newly&rdquo; created network stack and when using the <code>host</code> network mode, the container gets the hosts network stack.</p></blockquote><h2 id=publishing-ports>Publishing ports</h2><p>When using the <code>default</code> network mode, Docker creates <code>iptables</code> rules so published/forwarded ports are reachable from the outside.
In the example, we see the <code>iptables</code> rules for a container with published port <code>80/http</code>.</p><blockquote><p><strong>Example Output</strong>
<img src=docker-iptables-output.png alt="Example iptables list output"></p></blockquote><p>As we can see Docker uses a separate <code>DOCKER</code> chain in the <code>FORWARD</code> chain, to map incoming traffic on port 80 to the container IP.
After the destination IP has been changed, Docker uses DNAT (Destination Network Address Translation), to &ldquo;map&rdquo; the traffic to the container&rsquo;s end address.</p><blockquote><p><strong>TASK</strong> <a href=https://github.com/galexrt/workshop-docker/tree/master/network101><code>network101</code></a></p></blockquote><p>You can use the script <code>show_me_dat_network.sh</code> from task <code>network101</code>, to view your network interfaces and current <code>iptables</code> rules.</p><h2 id=looking-into-your-network>Looking into your network</h2><blockquote><p><strong>TASK</strong> <a href=https://github.com/galexrt/workshop-docker/tree/master/network101><code>network101</code></a></p></blockquote><p>Do you want to visualize your container network situation? Yes? Then the perfect tool for this is Weave Scope.</p><p>In the <code>network101</code> task is a file called <code>start_weave_scope.sh</code>. The script downloads the Weave Scope wrapper script, that starts the containers needed for Weave Scope to function.
The commands that are used to download the Weave Scope wrapper script are:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span><span style=color:#44475a>sudo wget -O /usr/local/bin/scope https://git.io/scope
</span></span></span><span style=display:flex><span><span style=color:#44475a>sudo chmod a+x /usr/local/bin/scope
</span></span></span><span style=display:flex><span><span style=color:#44475a>sudo scope launch
</span></span></span></code></pre></div><p>After the image of the container has been pulled and started, you can then navigate to http://localhost:4040 to see the Weave Scope UI.</p><blockquote><p><strong>Expected Output</strong>
<img src=weavescope_ui.png alt="Weave Scope UI"></p></blockquote><p>Through the Weave Scope UI you gain an immersive insight into your network of the containers.</p><hr><h1 id=limiting-container-resources>Limiting container resources</h1><center>![It's OK I know my limit - Meme](its-ok-i-know-my-limit-meme.png)
_- said the rogue process_</center><p>As I already mentioned in the <a href=#Container>Container!?</a> part, namespaces are able to limit the resources available to processes, etc.</p><h2 id=cpu-limit>CPU Limit</h2><p>Limiting the precious computing resource of a container.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span>$ docker run --help
</span></span><span style=display:flex><span><span style=color:#44475a>[...]
</span></span></span><span style=display:flex><span><span style=color:#44475a>  --cpu-period                    Limit CPU CFS (Completely Fair Scheduler) period
</span></span></span><span style=display:flex><span><span style=color:#44475a>  --cpu-quota                     Limit CPU CFS (Completely Fair Scheduler) quota
</span></span></span><span style=display:flex><span><span style=color:#44475a>  --cpuset-cpus                   CPUs in which to allow execution (0-3, 0,1)
</span></span></span><span style=display:flex><span><span style=color:#44475a>[...]
</span></span></span></code></pre></div><p>You can limit the time period and the quota of the CFS (Completely Fair Scheduler).
Limiting a container to specific cores is also possible (<code>--cpuset-cpus</code>).</p><h2 id=memory-and-swap-limit>Memory and Swap Limit</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span>$ docker run --help
</span></span><span style=display:flex><span><span style=color:#44475a>[...]
</span></span></span><span style=display:flex><span><span style=color:#44475a>  --cpuset-mems                   MEMs in which to allow execution (0-3, 0,1)
</span></span></span><span style=display:flex><span><span style=color:#44475a>[...]
</span></span></span><span style=display:flex><span><span style=color:#44475a>  --kernel-memory                 Kernel memory limit
</span></span></span><span style=display:flex><span><span style=color:#44475a>[...]
</span></span></span><span style=display:flex><span><span style=color:#44475a>  --memory-reservation            Memory soft limit
</span></span></span><span style=display:flex><span><span style=color:#44475a>  --memory-swap                   Swap limit equal to memory plus swap: &#39;-1&#39; to enable unlimited swap
</span></span></span><span style=display:flex><span><span style=color:#44475a>  --memory-swappiness=-1          Tune container memory swappiness (0 to 100)
</span></span></span><span style=display:flex><span><span style=color:#44475a>[...]
</span></span></span><span style=display:flex><span><span style=color:#44475a>  --oom-kill-disable              Disable OOM Killer
</span></span></span><span style=display:flex><span><span style=color:#44475a>  --oom-score-adj                 Tune host&#39;s OOM preferences (-1000 to 1000)
</span></span></span><span style=display:flex><span><span style=color:#44475a>[...]
</span></span></span></code></pre></div><p>As you can see, there is a good amount of option to play around with the memory a container can use and how it can use the memory.</p><p>A good feature if you have limited memory available is to play with the memory swappiness.</p><p>The <code>OOM</code> (Linux Out of Memory Management) options are good, if you have memory intensive applications, but only limited memory available. So important application container don&rsquo;t get killed, when the system should run out of memory.</p><hr><h1 id=selfies-i-mean-images>Selfies? I mean Images</h1><p>An image is the core of a container. Without an image, there would be no container.
Creating images is simple to do, depending on what you try to &ldquo;containerize&rdquo;.
In this part we set a simple goal. Our goal is to create a container that runs nginx in it.</p><h2 id=image-names-explained>Image Names explained</h2><p>Images that &ldquo;come&rdquo; from the <a href=https://hub.docker.com/>Docker Image Hub</a>, don&rsquo;t need a repository specified.</p><p>The image we used for the MySQL container is:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span><span style=color:#44475a>sameersbn/mysql:latest
</span></span></span></code></pre></div><blockquote><p><strong>WDWD</strong></p><ul><li><code>sameersbn</code> - The username of the creator.</li><li><code>mysql</code> - The image name.</li><li><code>latest</code> - The &ldquo;version&rdquo; tag. The tag can be anything, but emojis.</li></ul></blockquote><p>An example for an image that is pulled from a different image server, than the official Docker Hub, is my image for <a href=https://zulip.org/>Zulip</a> by Dropbox that is hosted on <a href=https://quay.io>quay.io</a>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span><span style=color:#44475a>quay.io/galexrt/zulip:1.3.10
</span></span></span><span style=display:flex><span><span style=color:#44475a>SERVER/USERNAME/IMAGE_NAME:TAG
</span></span></span></code></pre></div><blockquote><p><strong>WDWD</strong></p><ul><li><code>quay.io</code>, <code>SERVER</code> - Defaults to <code>docker.io</code>. The image repository server to pull the image from.</li><li><code>galexrt</code>, <code>USERNAME</code> - Username of the image creator/uploader.</li><li><code>zulip</code>, <code>IMAGE_NAME</code> - Name of the image.</li><li><code>1.3.10</code>, <code>TAG</code> - Like git tags. When not specified, the default is <code>latest</code>.</li></ul></blockquote><p>In the case of official created images, like the WordPress image we used no server and username is required (by default).
Official images are &ldquo;marked&rdquo; through the &ldquo;missing&rdquo; username in the image name and the Docker Image Hub url having an underscore instead of an username (https://hub.docker.com/r/_/wordpress/).</p><h2 id=what-have-layer-cakes-to-do-with-docker-images>What have Layer Cakes to do with Docker Images?</h2><center>![Layer Cake from Wikimedia](layer-cake-from-wikimedia.png)
_Mhh, tasty, isn't it?_ But now back to the topic.</center><blockquote><p><strong>TASK</strong>: <a href=https://github.com/galexrt/workshop-docker/tree/master/dockerfile101><code>dockerfile101</code></a></p></blockquote><p>In the Docker universe, a Docker image is built from the bottom to the top like a cake, the bottom is a baseimage (or any other image as a base).
Every &ldquo;new&rdquo; layer on top of it, is an action that had been run when building the image.</p><p>Meaning if we create an image from the &ldquo;baseimage&rdquo; <code>fedora:23</code> like the example <code>Dockerfile</code>, a cross-section/profile would look like this:</p><center>![Docker Dockerfile Layers](docker-data-dockerfile-layers.png)</center><p>That is one of the reasons, why Docker images are so small. If you download 10 images that are based on <code>debian:jessie</code>, you would only have to download the created/modified layers, because the baseimage is the same for these 10 images.
To build/create an image, you create a Dockerfile and that&rsquo;s what we are going to talk about next.</p><h2 id=dockerfile-examples>Dockerfile examples</h2><p>As you may have already seen in the task directory <code>dockerfil101</code>, there was a file called <code>Dockerfile</code>.
A <code>Dockerfile</code> contains build instructions for an image. For <code>Dockerfile</code>s there is a &ldquo;special&rdquo; syntax, but the syntax is very simple.
I&rsquo;m going to show you a simple and a more advanced example of Dockerfiles.</p><h3 id=simple-dockerfile-example>Simple Dockerfile Example</h3><p>Taken from the <a href=https://github.com/carazzim0/docker-ebot>carazzim0/docker-ebot</a> GitHub project, file <code>Dockerfile</code>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span><span style=color:#44475a>FROM debian:jessie
</span></span></span><span style=display:flex><span><span style=color:#44475a></span>
</span></span><span style=display:flex><span><span style=color:#44475a>ENV EBOT_HOME=&#34;/ebot&#34; TIMEZONE=&#34;Europe/Berlin&#34;
</span></span></span><span style=display:flex><span><span style=color:#44475a></span>
</span></span><span style=display:flex><span><span style=color:#44475a>ADD entrypoint.sh /sbin/entrypoint.sh
</span></span></span><span style=display:flex><span><span style=color:#44475a></span>
</span></span><span style=display:flex><span><span style=color:#44475a>RUN apt-get update &amp;&amp; \
</span></span></span><span style=display:flex><span><span style=color:#44475a>    apt-get -y upgrade &amp;&amp; \
</span></span></span><span style=display:flex><span><span style=color:#44475a>    apt-get clean &amp;&amp; \
</span></span></span><span style=display:flex><span><span style=color:#44475a>    apt-get -y install nodejs npm curl git php5-cli php5-mysql screen git &amp;&amp; \
</span></span></span><span style=display:flex><span><span style=color:#44475a>    apt-get clean &amp;&amp; \
</span></span></span><span style=display:flex><span><span style=color:#44475a>    sed -i &#34;s~;date.timezone =~date.timezone = $TIMEZONE~g&#34; /etc/php5/cli/php.ini &amp;&amp; \
</span></span></span><span style=display:flex><span><span style=color:#44475a>    /bin/ln -s /usr/bin/nodejs /usr/bin/node &amp;&amp; \
</span></span></span><span style=display:flex><span><span style=color:#44475a>    curl -sS https://getcomposer.org/installer | php -- --install-dir=/usr/bin &amp;&amp; \
</span></span></span><span style=display:flex><span><span style=color:#44475a>    mkdir &#34;$EBOT_HOME&#34; &amp;&amp; \
</span></span></span><span style=display:flex><span><span style=color:#44475a>    git clone https://github.com/deStrO/eBot-CSGO.git &#34;$EBOT_HOME&#34; &amp;&amp; \
</span></span></span><span style=display:flex><span><span style=color:#44475a>    cd &#34;$EBOT_HOME&#34; &amp;&amp; \
</span></span></span><span style=display:flex><span><span style=color:#44475a>    git checkout &#34;master&#34; &amp;&amp; \
</span></span></span><span style=display:flex><span><span style=color:#44475a>    /usr/bin/php /usr/bin/composer.phar install &amp;&amp; \
</span></span></span><span style=display:flex><span><span style=color:#44475a>    npm install socket.io formidable archiver
</span></span></span><span style=display:flex><span><span style=color:#44475a></span>
</span></span><span style=display:flex><span><span style=color:#44475a>COPY Match.php $EBOT_HOME/src/eBot/Match/Match.php
</span></span></span><span style=display:flex><span><span style=color:#44475a></span>
</span></span><span style=display:flex><span><span style=color:#44475a>VOLUME [&#34;$EBOT_HOME/demos&#34;, &#34;$EBOT_HOME/logs&#34;]
</span></span></span><span style=display:flex><span><span style=color:#44475a></span>
</span></span><span style=display:flex><span><span style=color:#44475a>EXPOSE 12360 12361
</span></span></span><span style=display:flex><span><span style=color:#44475a></span>
</span></span><span style=display:flex><span><span style=color:#44475a>ENTRYPOINT [&#34;/sbin/entrypoint.sh&#34;]
</span></span></span></code></pre></div><h3 id=advanced-dockerfile-example>Advanced Dockerfile Example</h3><p>Taken from the <a href=https://github.com/galexrt/docker-zulip>galexrt/docker-zulip</a> GitHub project, file <code>Dockerfile</code>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span><span style=color:#44475a>FROM quay.io/sameersbn/ubuntu:latest
</span></span></span><span style=display:flex><span><span style=color:#44475a>MAINTAINER Alexander Trost &lt;galexrt@googlemail.com&gt;
</span></span></span><span style=display:flex><span><span style=color:#44475a></span>
</span></span><span style=display:flex><span><span style=color:#44475a>ENV ZULIP_VERSION=&#34;master&#34; DATA_DIR=&#34;/data&#34;
</span></span></span><span style=display:flex><span><span style=color:#44475a></span>
</span></span><span style=display:flex><span><span style=color:#44475a>ADD entrypoint.sh /sbin/entrypoint.sh
</span></span></span><span style=display:flex><span><span style=color:#44475a></span>
</span></span><span style=display:flex><span><span style=color:#44475a>RUN apt-get -q update &amp;&amp; \
</span></span></span><span style=display:flex><span><span style=color:#44475a>    apt-get -q dist-upgrade -y &amp;&amp; \
</span></span></span><span style=display:flex><span><span style=color:#44475a>    apt-get install -y git &amp;&amp; \
</span></span></span><span style=display:flex><span><span style=color:#44475a>    mkdir -p &#34;$DATA_DIR&#34; /root/zulip &amp;&amp; \
</span></span></span><span style=display:flex><span><span style=color:#44475a>    git clone https://github.com/zulip/zulip.git /root/zulip &amp;&amp; \
</span></span></span><span style=display:flex><span><span style=color:#44475a>    cd /root/zulip &amp;&amp; \
</span></span></span><span style=display:flex><span><span style=color:#44475a>    git checkout &#34;$ZULIP_VERSION&#34; &amp;&amp; \
</span></span></span><span style=display:flex><span><span style=color:#44475a>    rm -rf /root/zulip/.git
</span></span></span><span style=display:flex><span><span style=color:#44475a></span>
</span></span><span style=display:flex><span><span style=color:#44475a>ADD custom_zulip_files/ /root/custom_zulip
</span></span></span><span style=display:flex><span><span style=color:#44475a></span>
</span></span><span style=display:flex><span><span style=color:#44475a>RUN cp -rf /root/custom_zulip/* /root/zulip &amp;&amp; \
</span></span></span><span style=display:flex><span><span style=color:#44475a>    VOYAGER_CLASS=&#34;dockervoyager&#34; DEPLOYMENT_TYPE=&#34;dockervoyager&#34; ADDITIONAL_PACKAGES=&#34;python-dev python-six python-pbs&#34; \
</span></span></span><span style=display:flex><span><span style=color:#44475a>    /root/zulip/scripts/setup/install &amp;&amp; \
</span></span></span><span style=display:flex><span><span style=color:#44475a>    wget -q https://www.zulip.com/dist/releases/zulip-server-latest.tar.gz -O /tmp/zulip-server.tar.gz &amp;&amp; \
</span></span></span><span style=display:flex><span><span style=color:#44475a>    tar xfz /tmp/zulip-server.tar.gz -C &#34;/home/zulip/prod-static&#34; --strip-components=3 --wildcards */prod-static/serve &amp;&amp; \
</span></span></span><span style=display:flex><span><span style=color:#44475a>    rm -rf /tmp/zulip-server.tar.gz &amp;&amp; \
</span></span></span><span style=display:flex><span><span style=color:#44475a>    ln -nsf /home/zulip/deployments/current/prod-static/serve /home/zulip/prod-static &amp;&amp; \
</span></span></span><span style=display:flex><span><span style=color:#44475a>    apt-get -qq autoremove --purge -y &amp;&amp; \
</span></span></span><span style=display:flex><span><span style=color:#44475a>    apt-get -qq clean &amp;&amp; \
</span></span></span><span style=display:flex><span><span style=color:#44475a>    rm -rf /root/zulip/puppet/ /var/lib/apt/lists/* /tmp/* /var/tmp/*
</span></span></span><span style=display:flex><span><span style=color:#44475a></span>
</span></span><span style=display:flex><span><span style=color:#44475a>ADD setup_files/ /opt/files
</span></span></span><span style=display:flex><span><span style=color:#44475a>ADD includes/supervisor/conf.d/zulip_postsetup.conf /etc/supervisor/conf.d/zulip_postsetup.conf
</span></span></span><span style=display:flex><span><span style=color:#44475a>ADD includes/createZulipAdmin.sh /createZulipAdmin.sh
</span></span></span><span style=display:flex><span><span style=color:#44475a></span>
</span></span><span style=display:flex><span><span style=color:#44475a>VOLUME [&#34;$DATA_DIR&#34;]
</span></span></span><span style=display:flex><span><span style=color:#44475a>EXPOSE 80 443
</span></span></span><span style=display:flex><span><span style=color:#44475a></span>
</span></span><span style=display:flex><span><span style=color:#44475a>ENTRYPOINT [&#34;/sbin/entrypoint.sh&#34;]
</span></span></span><span style=display:flex><span><span style=color:#44475a>CMD [&#34;app:run&#34;]
</span></span></span></code></pre></div><p><em>Don&rsquo;t worry</em> we&rsquo;re going to make a very simple and basic image. ;)</p><h2 id=understanding-dockerfiles>Understanding Dockerfiles</h2><blockquote><p><strong>TASK</strong>: <a href=https://github.com/galexrt/workshop-docker/tree/master/dockerfile202><code>dockerfile202</code></a></p><p><strong>TIP</strong></p><p>If you have trouble writing a <code>Dockerfile</code>, check the <a href=https://docs.docker.com/engine/reference/builder/>Dockerfile Docs</a>.</p></blockquote><p>You will create an image with <code>nginx</code> installed (You can later expand it, with more functionality, like with PHP-FPM).</p><p>To guide you in creating a nginx image, I show you an example of a http webserver application written in golang, before you are going to create your own <code>nginx</code> image.</p><blockquote><p><strong>Golang Dockerfile Example</strong>: (Example taken from <a href=https://medium.com/@shijuvar/deploying-go-web-apps-with-docker-1b7561b36f53#.lkj19wklp>Shiju Varghese Medium Blog</a>)</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console></code></pre></div></blockquote><h1 id=golang-image-where-workspace-gopath-configured-at-go>golang image where workspace (GOPATH) configured at /go.</h1><p>FROM golang:latest</p><h1 id=copy-the-local-package-files-to-the-containers-workspace>Copy the local package files to the container’s workspace.</h1><p>ADD . /go/src/github.com/shijuvar/golang-docker</p><h1 id=build-the-golang-docker-command-inside-the-container>Build the golang-docker command inside the container.</h1><p>RUN go install github.com/shijuvar/golang-docker</p><h1 id=run-the-golang-docker-command-when-the-container-starts>Run the golang-docker command when the container starts.</h1><p>ENTRYPOINT ["/go/bin/golang-docker"]</p><h1 id=http-server-listens-on-port-8080>http server listens on port 8080.</h1><p>EXPOSE 8080</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mysql data-lang=mysql><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>&gt;</span> <span style=color:#ff79c6>**</span>WDWD<span style=color:#ff79c6>**</span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>&gt;</span> <span style=color:#ff79c6>*</span> <span style=color:#ff79c6>`</span><span style=color:#ff79c6>FROM</span> ...<span style=color:#ff79c6>`</span> <span style=color:#ff79c6>-</span> Sets the baseimage.
</span></span><span style=display:flex><span><span style=color:#ff79c6>&gt;</span> <span style=color:#ff79c6>*</span> <span style=color:#ff79c6>`</span>COPY ... ...<span style=color:#ff79c6>`</span> <span style=color:#ff79c6>-</span> Copy files <span style=color:#ff79c6>from</span> the build root.
</span></span><span style=display:flex><span><span style=color:#ff79c6>&gt;</span> <span style=color:#ff79c6>*</span> <span style=color:#ff79c6>`</span><span style=color:#ff79c6>ADD</span> ... ...<span style=color:#ff79c6>`</span> <span style=color:#ff79c6>-</span> Same <span style=color:#ff79c6>as</span> <span style=color:#ff79c6>`</span>COPY<span style=color:#ff79c6>`</span>, but target can be <span style=color:#f1fa8c>&#34;online&#34;</span> <span style=color:#ff79c6>and</span> <span style=color:#ff79c6>if</span> it <span style=color:#ff79c6>is</span> an archive, it will be extracted.
</span></span><span style=display:flex><span><span style=color:#ff79c6>&gt;</span> <span style=color:#ff79c6>*</span> <span style=color:#ff79c6>`</span>RUN ...<span style=color:#ff79c6>`</span> <span style=color:#ff79c6>-</span> Run <span style=color:#50fa7b>commands</span> (Shell used <span style=color:#ff79c6>`/</span>bin<span style=color:#ff79c6>/</span>sh<span style=color:#ff79c6>`</span>).
</span></span><span style=display:flex><span><span style=color:#ff79c6>&gt;</span> <span style=color:#ff79c6>*</span> <span style=color:#ff79c6>`</span>ENTRYPOINT [<span style=color:#f1fa8c>&#34;...&#34;</span>]<span style=color:#ff79c6>`</span> <span style=color:#ff79c6>-</span> The command <span style=color:#ff79c6>to</span> execute <span style=color:#ff79c6>when</span> the container <span style=color:#ff79c6>is</span> started.
</span></span><span style=display:flex><span><span style=color:#ff79c6>&gt;</span> <span style=color:#ff79c6>*</span> <span style=color:#ff79c6>`</span>CMD [<span style=color:#f1fa8c>&#34;...&#34;</span>]<span style=color:#ff79c6>`</span> <span style=color:#ff79c6>-</span> Arguments <span style=color:#ff79c6>for</span> the <span style=color:#ff79c6>`</span>ENTRYPOINT<span style=color:#ff79c6>`</span>.
</span></span><span style=display:flex><span><span style=color:#ff79c6>&gt;</span> <span style=color:#ff79c6>*</span> <span style=color:#ff79c6>`</span>EXPOSE <span style=color:#bd93f9>8080</span> ...<span style=color:#ff79c6>`</span> <span style=color:#ff79c6>-</span> Expose a port <span style=color:#ff79c6>when</span> <span style=color:#50fa7b>linked</span> (_If <span style=color:#ff79c6>not</span> specified port <span style=color:#ff79c6>not</span> reachable <span style=color:#ff79c6>when</span> linked<span style=color:#ff79c6>!</span>_). <span style=color:#ff79c6>To</span> specify protocol just <span style=color:#ff79c6>add</span> a <span style=color:#ff79c6>`/</span>tcp<span style=color:#ff79c6>`</span> <span style=color:#ff79c6>or</span> <span style=color:#ff79c6>`/</span>udp<span style=color:#ff79c6>`</span>.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>There<span style=color:#f1fa8c>&#39;s even the possibility, to execute specific commands when the image is used as a base image, the base instruction is called `ONBUILD ...`, but explaining this is beyond the scope of this workshop. Thanks for understanding!
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>To build an image we use the `docker build` command. Building this golang example image, we run the following command:
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>```console
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>docker build -t golang-docker -f Dockerfile .
</span></span></span></code></pre></div><blockquote><p><strong>WDWD</strong></p><ul><li><code>build</code> - Used to build Docker images.</li><li><code>-t IMAGE_NAME</code> - Specify the name (with an optional tag) of the image, you are creating (Optional. <strong>NOTE</strong> This options is important when manually building and pushing a Docker image to a repository). <code>IMAGE_NAME</code> is a string name for the image with an optional tag specified. The tag is added by adding double dots like this <code>:TAG_NAME</code>.</li><li><code>-f DOCKERFILE</code> - Set the location of the <code>Dockerfile</code> (Optional).</li><li><code>.</code> - The image build root of the image build (<strong>Important</strong> when <code>ADD</code> or <code>COPY</code> is used in the <code>Dockerfile</code>). All files will be at least added to the build environment for easy access, but not added to the image itself.</li></ul></blockquote><p>As you can see, it isn&rsquo;t hard to build your first Docker images.
If you want to see more advanced examples, you can find more examples in my GitHub repositories <a href="https://github.com/search?q=user%3AGalexrt+docker-">here</a>.</p><h2 id=commands-you-need-to-know-when-working-with-docker-images>Commands you need to know when working with Docker images</h2><h3 id=deleting-a-docker-image>Deleting a Docker image</h3><p>To delete a Docker image, you use the <code>docker rmi</code> subcommand. The syntax is the same as for the <code>docker rm</code> subcommand.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span><span style=color:#44475a>docker rmi IMAGE [IMAGE...]
</span></span></span></code></pre></div><blockquote><p><strong>WDWD</strong></p><ul><li><code>rmi</code> - The subcommand for deleting one or more image(s).</li><li><code>IMAGE [IMAGE...]</code> - One or more image names or IDs to delete.</li></ul></blockquote><h3 id=build-a-docker-image-from-dockerfile>Build a Docker image from Dockerfile</h3><p>Use this command to build images.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span><span style=color:#44475a>docker build -t IMAGE_NAME -f DOCKERFILE BUILD_PATH
</span></span></span></code></pre></div><blockquote><p><strong>WDWD</strong></p><ul><li><code>build</code> - The build subcommand.</li><li><code>-t IMAGE_NAME</code> - More details to <code>IMAGE_NAME</code> are going to be explained in a later section, <a href=#Image-Names-explained>here</a> or see above <strong>WDWD</strong> part.</li><li><code>DOCKERFILE</code> - Path to a Dockerfile. Defaults to the current work directory with <code>Dockerfile</code> attached as a file name.</li><li><code>BUILD_PATH</code> - The build root path. Files in the directory will be added to the Docker build environment, but not to the image itself. The files are only added when the specified Dockerfile has instructions to do so. You can&rsquo;t go deeper than the <code>BUILD_PATH</code>!</li></ul></blockquote><h2 id=lets-build-your-first-docker-image>Let&rsquo;s build your first Docker image</h2><p>Now that we know some <code>Dockerfile</code> basics, we can start building our own <code>nginx</code> image from the baseimage <code>debian:jessie</code>.</p><p>Let&rsquo;s make this like a test in the school, replace all <code>__BLANK__</code> with the correct answer (Solutions are <a href=#nginx-Dockerfile>here</a>):</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span><span style=color:#44475a>FROM __BLANK__
</span></span></span><span style=display:flex><span><span style=color:#44475a></span>
</span></span><span style=display:flex><span><span style=color:#44475a>RUN __BLANK__
</span></span></span><span style=display:flex><span><span style=color:#44475a></span>
</span></span><span style=display:flex><span><span style=color:#44475a>ENTRYPOINT [&#34;__BLANK__&#34;]
</span></span></span></code></pre></div><p>Got all blanks filled out? Good. Let&rsquo;s build the image:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span><span style=color:#44475a>docker build -t workshop-nginx .
</span></span></span></code></pre></div><blockquote><p><strong>Expected Output of <code>docker build -t workshop-nginx .</code></strong>
<img src=docker-build-nginx-image.png alt="Docker Build workshop-nginx image"></p></blockquote><p>The build should go successfully, when you filled in the blanks correctly. Let&rsquo;s run the image to see if it is working, the container name will be <code>workshop-nginx</code>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span><span style=color:#44475a>docker run \
</span></span></span><span style=display:flex><span><span style=color:#44475a>    --name workshop-nginx \
</span></span></span><span style=display:flex><span><span style=color:#44475a>    -d \
</span></span></span><span style=display:flex><span><span style=color:#44475a>    -p 80:80 \
</span></span></span><span style=display:flex><span><span style=color:#44475a>    workshop-nginx
</span></span></span></code></pre></div><p>If you did something wrong, remove the container using (where <code>CONTAINER_NAME</code> is a container ID or name):</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span><span style=color:#44475a>docker rm CONTAINER_NAME
</span></span></span></code></pre></div><p>To check if the container is running with your image, run <code>docker ps -a</code>.</p><blockquote><p><strong>WDWD</strong></p><ul><li><code>ps</code> - Like the <code>ps </code>command, but for the containers.</li><li><code>-a</code> - Show all containers, whether their current state, without it showing only running containers.</li></ul></blockquote><p>You should see that the container you started, has exited.
There&rsquo;s a simple reason, why the container exited/stopped. When running a command as the entrypoint, it has to stay running, not fork to background. When the process forks to background, Docker will think the process has stopped and the container status will be set to <code>exited</code> with the last return code.</p><p>That&rsquo;s why we need to tell <code>nginx</code>, not to run as a daemon, not fork to background, with the following additional arguments <code>"-g", "daemon off;"</code> (these arguments must be added to the <code>ENTRYPOINT</code> line of the <code>Dockerfile</code>).</p><p>So we could make a change to the <code>nginx.conf</code>, overwrite <code>nginx.conf</code> with a custom one or <strong>just change</strong> the <code>ENTRYPOINT</code> line to make it look like this:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span><span style=color:#44475a>ENTRYPOINT [&#34;nginx&#34;, &#34;-g&#34;, &#34;daemon off;&#34;]
</span></span></span></code></pre></div><p>Let&rsquo;s rebuild the image (same command) and run it again. Open <a href=http://127.0.0.1:8080>http://127.0.0.1:8080</a> in your browser and voilà it should show the nginx default page.</p><p>To go further with your created image, let&rsquo;s &ldquo;mount&rdquo; a volume inside the container with our own <code>index.html</code>.
Use the <code>index.html</code> from task <code>dockerfile202</code> or create one yourself.</p><p>Now we add a volume to the container. Add <code>-v "$(pwd)":"/usr/share/nginx/html"</code> to the <code>docker run</code> command, but don&rsquo;t forget add the argument before the image name.
Your command should look like this:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span><span style=color:#44475a>docker run \
</span></span></span><span style=display:flex><span><span style=color:#44475a>    --name workshop-nginx \
</span></span></span><span style=display:flex><span><span style=color:#44475a>    -d \
</span></span></span><span style=display:flex><span><span style=color:#44475a>    -p 8080:80 \
</span></span></span><span style=display:flex><span><span style=color:#44475a>    -v &#34;$(pwd)&#34;:&#34;/usr/share/nginx/html&#34; \
</span></span></span><span style=display:flex><span><span style=color:#44475a>    workshop-nginx
</span></span></span></code></pre></div><p>This starts a container named <code>workshop-nginx</code> running the image <code>workshop-nginx</code> with a volume mounted at <code>/usr/share/nginx/html</code>.
If we now open <a href=http://127.0.0.1:8080>http://127.0.0.1:8080</a> in the browser, we will see our <code>index.html</code>. Well done!</p><h2 id=how-can-this-help-in-the-development-workflow>How can this help in the development workflow?</h2><p>If you are for example creating a new CMS written in PHP you could, create a Docker image for it.
On every push to the git repository of the project, the image could be built and automatic checks could be run, to ensure every feature is working fine.</p><p>For example Travis-CI has switched big parts of their build infrastructure to Docker containers.
Quoting Travis-CI some headings from their <a href=https://blog.travis-ci.com/2014-12-17-faster-builds-with-container-based-infrastructure/>blog post</a>:</p><blockquote><p>Builds start in seconds
Faster builds
More available resources in a build container
Better network capacity, availability and throughput
Easier to scale</p></blockquote><p>As we can see, containers are better than VMs (depending on the application area).</p><p>The lower resource usage is good for the development workflow, making it faster and cheaper.</p><hr><h1 id=composing-containers-made-simple-with-docker-compose>Composing containers made simple with <code>docker-compose</code></h1><h2 id=making-multi-container-applications-simpler-to-start>Making multi container applications simpler to start</h2><p>To remove the process of typing all those commands to start the containers, <code>docker-compose</code> has been created.
<code>docker-compose</code> makes it <em>easy peasy lemon squeezy</em> to run one to many containers using one command.
The syntax of a <code>docker-compose.yml</code> is YAML (<em>YAML Ain&rsquo;t Markup Language</em>). A good syntax checker, I use, is available <a href=https://yaml-online-parser.appspot.com/>here</a>.</p><p>In our example with WordPress we will create a <code>docker-compose.yml</code> for our MySQL database server, WordPress instance and as an extra we&rsquo;ll add phpMyAdmin to it.</p><p>Create the <code>docker-compose.yml</code> file. I made this part like a test again, so you can see where you have knowledge holes, replace all <code>__BLANK__</code> with the correct answer (Solutions are <a href=#WordPress-and-MySQL-docker-compose-yml>here</a>):
(This <code>docker-compose.yml</code> has been taken from <a href=https://www.digitalocean.com/community/tutorials/how-to-install-wordpress-and-phpmyadmin-with-docker-compose-on-ubuntu-14-04>https://www.digitalocean.com/community/tutorials/how-to-install-wordpress-and-phpmyadmin-with-docker-compose-on-ubuntu-14-04</a>)</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span><span style=color:#44475a>database:
</span></span></span><span style=display:flex><span><span style=color:#44475a>  image: sameersbn/mysql:latest
</span></span></span><span style=display:flex><span><span style=color:#44475a>  environment:
</span></span></span><span style=display:flex><span><span style=color:#44475a>    DB_NAME: wordpress
</span></span></span><span style=display:flex><span><span style=color:#44475a>    DB_USER: wordpress
</span></span></span><span style=display:flex><span><span style=color:#44475a>    DB_PASS: wordpress
</span></span></span><span style=display:flex><span><span style=color:#44475a>    DB_REMOTE_ROOT_NAME: root
</span></span></span><span style=display:flex><span><span style=color:#44475a>    DB_REMOTE_ROOT_PASS: workshop
</span></span></span><span style=display:flex><span><span style=color:#44475a>  volumes:
</span></span></span><span style=display:flex><span><span style=color:#44475a>    - &#34;/opt/docker/database:/var/lib/mysql:rw&#34;
</span></span></span><span style=display:flex><span><span style=color:#44475a></span># wordpress image configuration see https://hub.docker.com/_/wordpress/
</span></span><span style=display:flex><span><span style=color:#44475a>wordpress:
</span></span></span><span style=display:flex><span><span style=color:#44475a>  image: wordpress
</span></span></span><span style=display:flex><span><span style=color:#44475a>  links:
</span></span></span><span style=display:flex><span><span style=color:#44475a>    - __BLANK__:mysql
</span></span></span><span style=display:flex><span><span style=color:#44475a>  ports:
</span></span></span><span style=display:flex><span><span style=color:#44475a>    - 8080:80
</span></span></span><span style=display:flex><span><span style=color:#44475a>  environment:
</span></span></span><span style=display:flex><span><span style=color:#44475a>    WORDPRESS_DB_HOST: __BLANK__:3306
</span></span></span><span style=display:flex><span><span style=color:#44475a>    WORDPRESS_DB_NAME: __BLANK__
</span></span></span><span style=display:flex><span><span style=color:#44475a>    WORDPRESS_DB_USER: __BLANK__
</span></span></span><span style=display:flex><span><span style=color:#44475a>    WORDPRESS_DB_PASSWORD: __BLANK__
</span></span></span><span style=display:flex><span><span style=color:#44475a>    WORDPRESS_AUTH_KEY: SECURE_AUTH_KEY
</span></span></span><span style=display:flex><span><span style=color:#44475a>    WORDPRESS_LOGGED_IN_KEY: SECURE_LOGGED_IN_KEY
</span></span></span><span style=display:flex><span><span style=color:#44475a>    WORDPRESS_AUTH_SALT: SECURE_AUTH_SALT
</span></span></span><span style=display:flex><span><span style=color:#44475a>    WORDPRESS_LOGGED_IN_SALT: SECURE_LOGGED_IN_SALT
</span></span></span><span style=display:flex><span><span style=color:#44475a></span># phpmyadmin image configuration see https://hub.docker.com/r/phpmyadmin/phpmyadmin/
</span></span><span style=display:flex><span><span style=color:#44475a>phpmyadmin:
</span></span></span><span style=display:flex><span><span style=color:#44475a>  image: phpmyadmin/phpmyadmin
</span></span></span><span style=display:flex><span><span style=color:#44475a>  links:
</span></span></span><span style=display:flex><span><span style=color:#44475a>    - mysql:database
</span></span></span><span style=display:flex><span><span style=color:#44475a>  ports:
</span></span></span><span style=display:flex><span><span style=color:#44475a>    - 8181:80
</span></span></span><span style=display:flex><span><span style=color:#44475a>  environment:
</span></span></span><span style=display:flex><span><span style=color:#44475a>    PMA_HOST: mysql
</span></span></span><span style=display:flex><span><span style=color:#44475a>    PMA_USER: root
</span></span></span><span style=display:flex><span><span style=color:#44475a>    PMA_PASSWORD: workshop
</span></span></span></code></pre></div><blockquote><p><strong>WDWD</strong></p><ul><li><code>database:</code> - Name of the container.</li><li><code>image:</code> - Defines the used image for the container.</li><li><code>links: []</code> - A list of container links.</li><li><code>ports: []</code> - A list of published ports.</li><li><code>environment: []</code> - &ldquo;Hash&rdquo; list of environment variables (Format: <code>NAME: VALUE</code>).</li></ul></blockquote><p>I have also added the environment variables <code>DB_REMOTE_ROOT_NAME</code> and <code>DB_REMOTE_ROOT_PASS</code>, so that Admin can access the MySQL server.</p><h2 id=starting-our-multi-container-applications-with-one-command>Starting our multi container applications with one command</h2><blockquote><p><strong>TASK</strong>: <a href=https://github.com/galexrt/workshop-docker/tree/master/compose101><code>compose101</code></a></p></blockquote><p>To &ldquo;run&rdquo;/start the content of our <code>docker-compose.yml</code>, we run:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span><span style=color:#44475a>docker-compose -f DOCKER_COMPOSE_YML up
</span></span></span></code></pre></div><blockquote><p><strong>WDWD</strong></p><ul><li><code>docker-compose</code> - The <code>docker-compose</code> command.</li><li><code>-f DOCKER_COMPOSE_YML</code> - Optional. Defaults to <code>docker-compose.yml</code>. <code>DOCKER_COMPOSE_YML</code> is a path to a valid <code>docker-compose</code> file.</li><li><code>up</code> - Starts the containers defined in the given docker-compose file.
<strong>Expected Output</strong></li></ul><script type=text/javascript src=https://asciinema.org/a/3bj9rktzp0oi3cda36pmh58eg.js id=asciicast-3bj9rktzp0oi3cda36pmh58eg async data-autoplay=false data-speed=1.5></script></blockquote><p>After running the command, you should see log output starting to fill your terminal. To stop the started containers press <code>CTRL+C</code>.
For running the containers detached in the background, you use the same option as for Docker, the <code>--detach</code> (or <code>-d</code>) option.</p><h2 id=basic-docker-compose-commands>Basic <code>docker-compose</code> commands</h2><p>There are some <code>docker-compose</code> commands you should know when working with the <code>docker-compose</code> command.</p><h3 id=stopping-all-containers-run-by-the-current-docker-compose-file>Stopping all containers run by the current <code>docker-compose</code> file</h3><p>Instead of the <code>up</code>, you just put <code>stop</code> there. Stops the containers from the current <code>docker-compose</code> file.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span><span style=color:#44475a>docker-compose stop -t TIMEOUT
</span></span></span></code></pre></div><blockquote><p><strong>WDWD</strong></p><ul><li><code>stop</code> - Stop subcommand.</li><li><code>-t TIMEOUT</code> - Optional. Timeout to wait for the containers, before the containers get killed.</li></ul></blockquote><h3 id=deleting-all-containers-run-by-the-current-docker-compose-file>Deleting all containers run by the current <code>docker-compose</code> file</h3><p>Replacing the <code>up</code> with <code>rm</code>, deletes all containers that are started by the current <code>docker-compose</code> file, but now are stopped or exited.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span><span style=color:#44475a>docker-compose -f DOCKER_COMPOSE_YML rm -f
</span></span></span></code></pre></div><blockquote><p><strong>WDWD</strong></p><ul><li><code>rm</code> - &ldquo;Subcommand&rdquo; for removing/deleting all container started by the current selected <code>docker-compose</code> file.</li><li><code>-f</code> - Optional. Forces the removal of the containers.</li></ul></blockquote><h3 id=restarting-all-container-started-by-the-current-docker-compose-file>Restarting all container started by the current <code>docker-compose</code> file</h3><p>Restarts all containers that are started or have exited by the current <code>docker-compose</code> file.
This just stops and starts the containers again and not stops, deletes and runs the containers again.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span><span style=color:#44475a>docker-compose -f DOCKER_COMPOSE_YML restart
</span></span></span></code></pre></div><blockquote><p><strong>WDWD</strong></p><ul><li><code>restart</code> - &ldquo;Subcommand&rdquo; for removing/deleting all container started by the current selected <code>docker-compose</code> file.</li></ul></blockquote><h2 id=lets-play-more-with-docker-compose>Let&rsquo;s play more with <code>docker-compose</code>!</h2><blockquote><p><strong>TASK</strong>: <a href=https://github.com/galexrt/workshop-docker/tree/master/compose202><code>compose202</code></a>
The task contains other <code>docker-compose.yml</code>s for you to play around with. Look at the <code>docker-compose.yml</code>s and start them.
Just play around with <code>docker-compose</code> a bit.</p><p><strong>TIP</strong></p><p>Keep the <code>-f DOCKERFILE</code> option in mind, when dealing with multiple <code>docker-compose.yml</code>&rsquo;s in one folder.</p></blockquote><h2 id=summary-of-these-sections>Summary of these sections</h2><p>We can now write basic <code>docker-compose.yml</code>s. We can now start a multi container application with one single command.</p><hr><h1 id=orchestration-tools>Orchestration Tools</h1><p><em>The right tool for the right workload. Keep that in mind or you&rsquo;ll have problems soon.</em></p><h2 id=a-wild-docker-swarm-appeared-kubernetes-used-rolling-update-it-was-very-effective>A wild Docker Swarm appeared. Kubernetes used rolling-update. It was very effective.</h2><p>The choice of the orchestration tool, depends on many factors:</p><ul><li>Workloads you&rsquo;ll handle (how many containers will be run?)</li><li>How many servers?</li></ul><p>My favorite choice is Kubernetes, easy to use, developed by Google (one of the largest and longest container users) and now with the latest updates, can scale up to 1000+ nodes.
I like Kubernetes more, because it offers a rolling-update feature. Allowing you to update your application Pod by Pod.</p><p>That&rsquo;s not the only reason, but one of the biggest why.</p><h2 id=other-orchestration-tools>Other Orchestration Tools</h2><ul><li><a href=http://mesos.apache.org/>Mesos by Apache</a></li><li><a href=http://rancher.com/>Rancher by Rancher Labs</a></li><li><a href=https://shipyard-project.com/>Shipyard by the Shipyard team</a></li><li><a href=https://www.nomadproject.io/>Nomad by Hashicorp</a></li><li>And many more</li></ul><hr><h1 id=kubessar---glossar-but-for-kubernetes>Kubessar - Glossar but for Kubernetes</h1><p><em>Like a glossar, but for Kubernetes stuff.</em></p><p>I highly recommend you to look through my Kubernetes presentation to get to know Kubernetes a bit better, before starting to work with it.
Please note, that the presentation is written in german.</p><iframe src="https://docs.google.com/presentation/d/1XHl6MlB0GE2rmoXbe5_603UFVkFF2S3ud6Uc0QI7fPo/embed?start=false&loop=true&delayms=5000" frameborder=0 width=100% height=569 allowfullscreen mozallowfullscreen=true webkitallowfullscreen=true></iframe><h2 id=namespace>Namespace</h2><p>Separation of resources. Allowing for quotas per namespace.
When not specifying a namespace, the <code>default</code> namespace will be used.</p><h2 id=pod-po>Pod (<code>po</code>)</h2><p>A set of one or more containers.</p><h2 id=replication-controller-rc>Replication Controller (<code>rc</code>)</h2><p>A ReplicationController ensures that there are always the specific number of replica of a given Pod.</p><h2 id=service-svc>Service (<code>svc</code>)</h2><p>Exposed ports of one or multiple pods. The access to the port(s) is &ldquo;loadbalanced&rdquo; using iptables.
A service also creates a A and SRV DNS record, when using the kubedns Pod.</p><h2 id=other-objects>Other &ldquo;Objects&rdquo;</h2><ul><li>kubeclt Files - &ldquo;Deployment&rdquo; files for &ldquo;objects&rdquo; of Kubernetes. Can be &ldquo;deployed&rdquo;/run/executed using the <code>kubectl</code> command.</li><li>ResourceQuotas - Resource quotas for a namespace.</li></ul><hr><h1 id=kubernetes>Kubernetes</h1><figure itemprop=associatedMedia itemscope itemtype=http://schema.org/ImageObject><a href=https://edenmal.moe/post/covers/kubernetes-logo-with-bg.png itemprop=contentUrl><img itemprop=thumbnail src=https://edenmal.moe/post/covers/kubernetes-logo-with-bg.png width=700px></a><figcaption><h4>Kubernetes Logo</h4></figcaption></figure><h2 id=kubernetes-features>Kubernetes Features</h2><h3 id=the-iptables-rules-will-blow-your-mind>The <code>iptables</code> rules will blow your mind</h3><p>If you have already worked with the basics of <code>iptables</code>, this will blow your mind, a lot more is possible with <code>iptables</code> than you thought.</p><script type=text/javascript src=https://asciinema.org/a/89fo5omeyjzmu8zp80rs5mauc.js id=asciicast-89fo5omeyjzmu8zp80rs5mauc async data-autoplay=false data-speed=1.5></script><h3 id=you-have-some-network-volumes>You have some Network Volumes?</h3><p>No problem, Kubernetes allows you to specify volumes that are network volumes and mount them by a simple name.
You could even use the volume claim system. Where a Pod just says, I need X GB storage and Kubernetes does the rest for you.</p><p>(As long as the specific mount binaries are installed on every server, this will work with no problems)</p><h3 id=and-there-are-even-more-features>And there are even more features!</h3><ul><li>Loadbalanceing for L4 and L7</li><li>L7 https termination</li><li>Autoscaling of Replication Controller</li><li>And more features already there and to come</li></ul><h1 id=kubectl---our-tool-to-deploy-them-all>kubectl - Our tool to deploy them all</h1><center>![Kubernetes Zelda - It's dangerous to go alone](kubernetes-its-dangerous-to-go-alone.png)
_Zelda Meme intensifies_</center><h2 id=the-basics-of-kubectl>The Basics of <code>kubectl</code></h2><p>The <code>kubectl</code> command is used to create new &ldquo;objects&rdquo;, view Pods, ReplicationController and all other available objects in Kubernetes.</p><h3 id=list-objects>List objects</h3><p>To view all Pods in all namespaces.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span><span style=color:#44475a>kubectl get --all-namespaces pods
</span></span></span></code></pre></div><blockquote><p><strong>WDWD</strong></p><ul><li><code>kubectl</code> - The kubectl command.</li><li><code>get</code> - Get &ldquo;objects&rdquo; from kubernetes API.</li><li><code>--all-namespaces</code> - Show objects from all namespaces.</li><li><code>pods</code> - Show only pods (Can be a comma seperated list of types, short forms are available).</li></ul></blockquote><h3 id=gather-information-about-one-or-more-objects>Gather information about one or more object(s)</h3><p>Get informations about one or more object(s).</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span><span style=color:#44475a>kubectl describe --namespace=NAMESPACE TYPE/NAME (TYPE/NAME ...)
</span></span></span></code></pre></div><blockquote><p><strong>WDWD</strong></p><ul><li><code>describe</code> - Call the describe routines.</li><li><code>--namespace=NAMESPACE</code> - Set namespace to search in (optional when set through kubeconfig file).</li><li><code>TYPE</code> - The type of objects to show. For example <code>pod</code>, <code>rc</code> (for replication controller).</li><li><code>NAME</code> - Name of the object to show. For our WordPress Pod, would be <code>wordpress</code>.</li></ul></blockquote><h3 id=create-one-or-more-objects>Create one or more object(s)</h3><p>To deploy/execute a &ldquo;kubectl&rdquo; file, we use the <code>create</code> subcommand.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span><span style=color:#44475a>kubectl create -f FILE_NAME
</span></span></span></code></pre></div><blockquote><p><strong>WDWD</strong></p><ul><li><code>create</code> - Creates an object.</li><li><code>-f FILE_NAME</code> - Can be one file, a directory or <code>-</code> for stdin. When a directory is specified, files are read in alphabetical order.</li></ul></blockquote><h3 id=delete-one-or-more-objects>Delete one or more object(s)</h3><p>To stop/delete one or more object(s), there&rsquo;s the <code>delete</code> subcommand.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span><span style=color:#44475a>kubectl delete -f FILE_NAME
</span></span></span></code></pre></div><blockquote><p><strong>WDWD</strong></p><ul><li><code>delete</code> - Deletes specified object(s).</li><li><code>-f FILE_NAME</code> - Can be one file, a directory or <code>-</code> for stdin. When a directory is specified, files are read in alphabetical order.</li></ul></blockquote><p><strong>Or</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span><span style=color:#44475a>kubectl delete TYPE/NAME (TYPE/NAME ...)
</span></span></span></code></pre></div><blockquote><p><strong>WDWD</strong></p><ul><li><code>delete</code> - Deletes specified object(s).</li><li><code>TYPE</code> - The type of objects to show. For example <code>pod</code>, <code>rc</code> (for replication controller).</li><li><code>NAME</code> - Name of the object to show. For our WordPress Pod, would be <code>wordpress</code>.</li></ul></blockquote><h3 id=execute-command-inside-a-pods-container>Execute command inside a Pod&rsquo;s container</h3><p>Using the <code>exec</code> subcommand, with almost the same syntax as <code>docker exec</code>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span><span style=color:#44475a>kubectl exec POD_NAME OPTIONS (-c CONTAINER_NAME) COMMAND
</span></span></span></code></pre></div><blockquote><p><strong>WDWD</strong></p><ul><li><code>exec</code> - Deletes specified object(s).</li><li><code>NAME</code> - Name of the object to show. For our WordPress Pod, would be <code>wordpress</code>.</li><li><code>OPTIONS</code> - For example <code>-i</code> for interactive, see the help menu for more information.</li><li><code>-c CONTAINER_NAME</code> - Optional. If the specified pod has more than one container, then it is required.</li><li><code>COMMAND</code> - The command to run inside the container.</li></ul></blockquote><h3 id=view-the-logs-of-a-pods-container>View the logs of a Pod&rsquo;s container</h3><p>The <code>logs</code> subcommand, has almost the same syntax as <code>docker logs</code>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span><span style=color:#44475a>kubectl logs OPTIONS POD_NAME (-c CONTAINER_NAME) COMMAND
</span></span></span></code></pre></div><blockquote><p><strong>WDWD</strong></p><ul><li><code>exec</code> - Deletes specified object(s).</li><li><code>OPTIONS</code> - For example <code>-f</code> for follow the output, see the help menu for more information.</li><li><code>NAME</code> - Name of the object to show. For our WordPress Pod, would be <code>wordpress</code>.</li><li><code>-c CONTAINER_NAME</code> - Optional. If the specified pod has more than one container, then it is required.</li></ul></blockquote><h2 id=advanced-kubectl-usage>Advanced kubectl usage</h2><h3 id=update-the-pods-of-a-replication-controller-during-runtime>Update the Pods of a Replication Controller during runtime</h3><p>The <code>rolling-update</code> subcommand allows to stop one pod after another and replace it with a new instace of the pod.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span><span style=color:#44475a>kubectl rolling-update REPLICATION -f FILE_NAME
</span></span></span></code></pre></div><blockquote><p><strong>WDWD</strong></p><ul><li><code>rolling-update</code> - Rolling update subcommand.</li><li><code>REPLICATION</code> - The ReplicationController to update with the given <code>FILE_NAME</code>.</li><li><code>-f FILE_NAME</code> - Name of the updated ReplicationController file. Can be one file, a directory or <code>-</code> for stdin. When a directory is specified, files are read in alphabetical order.</li></ul></blockquote><h3 id=scaling-running-replication-controller>Scaling running Replication Controller</h3><p>The <code>scale</code> subcommand gives you control over the size of running ReplicationController.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span><span style=color:#44475a>kubectl scale
</span></span></span></code></pre></div><blockquote><p><strong>WDWD</strong></p><ul><li><code>scale</code> - Scale subcommand.</li><li><code>--replicas=X</code> - Set the given ReplicationController to X replicas.</li><li><code>-f FILE_NAME</code> or <code>replicationcontrollers FOO</code> - Name of the ReplicationController to scale. Can be just the name or one file, a directory or <code>-</code> for stdin. When a directory is specified, files are read in alphabetical order.</li></ul></blockquote><hr><h1 id=deploy-your-own-kubernetes-cluster>Deploy your own Kubernetes cluster</h1><p><em>Follow these simple steps and get a Kubernetes cluster up and running fast.</em></p><h2 id=install-ansible>Install Ansible</h2><p><em>If you use the provided Virtual Box, this step is not needed!</em></p><blockquote><p>The package <code>python-netaddr</code> also needs to be installed on the client. Don&rsquo;t forget to install it!!</p></blockquote><p>Please refer to the official <a href=http://docs.ansible.com/ansible/intro_installation.html#installing-the-control-machine>Ansible Installation Docs</a> on how to install Ansible on your machine.</p><ul><li>For ArchLinux: <a href=http://docs.ansible.com/ansible/intro_installation.html#latest-releases-via-pacman-arch-linux>Ansible Docs</a></li><li>For Debian: <a href=http://docs.ansible.com/ansible/intro_installation.html#latest-releases-via-apt-ubuntu>Ansible Docs</a></li><li>For CentOS: <a href=http://docs.ansible.com/ansible/intro_installation.html#latest-release-via-yum>Ansible Docs</a></li></ul><h2 id=create-the-cluster-inventory-file-for-the-deployment>Create the cluster inventory file for the deployment</h2><blockquote><p><strong>TASK</strong>: <a href=https://github.com/galexrt/workshop-docker/tree/master/kubernetes202><code>kubernetes202</code></a></p></blockquote><p>Enter the task directory and look for a directory called <code>ansible/</code>.</p><p>Create a file called <code>inventory</code>, in this folder. This file will contain the list/inventory of the servers.
You create one line per server in the format below (username and password are valid for the provided vm, change to suit your environment):</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span><span style=color:#44475a>[masters]
</span></span></span><span style=display:flex><span><span style=color:#44475a></span># In most cases the first <span style=color:#f1fa8c>&#34;server&#34;</span>
</span></span><span style=display:flex><span><span style=color:#44475a>SERVER_IP_ADDRESS:SSH_PORT ansible_user=docker ansible_ssh_pass=docker ansible_become_pass=docker
</span></span></span><span style=display:flex><span><span style=color:#44475a></span>
</span></span><span style=display:flex><span><span style=color:#44475a>[etcd]
</span></span></span><span style=display:flex><span><span style=color:#44475a></span>#Add all the node servers here
</span></span><span style=display:flex><span><span style=color:#44475a>SERVER_IP_ADDRESS:SSH_PORT ansible_user=docker ansible_ssh_pass=docker ansible_become_pass=docker
</span></span></span><span style=display:flex><span><span style=color:#44475a>[...]
</span></span></span><span style=display:flex><span><span style=color:#44475a>SERVER_IP_ADDRESS:SSH_PORT ansible_user=docker ansible_ssh_pass=docker ansible_become_pass=docker
</span></span></span><span style=display:flex><span><span style=color:#44475a></span>
</span></span><span style=display:flex><span><span style=color:#44475a>[nodes]
</span></span></span><span style=display:flex><span><span style=color:#44475a></span># This can include the master server and the etcd servers too
</span></span><span style=display:flex><span><span style=color:#44475a>SERVER_IP_ADDRESS:SSH_PORT ansible_user=workshop ansible_ssh_pass=workshop ansible_become_pass=workshop
</span></span></span><span style=display:flex><span><span style=color:#44475a>[...]
</span></span></span><span style=display:flex><span><span style=color:#44475a>SERVER_IP_ADDRESS:SSH_PORT ansible_user=workshop ansible_ssh_pass=workshop ansible_become_pass=workshop
</span></span></span></code></pre></div><blockquote><p><strong>WDWD</strong></p><ul><li><code>[GROUP_NAME]</code> - Specifies a server/inventory group.</li><li><code>SERVER_IP_ADDRESS:SSH_PORT</code> - <code>SSH_PORT</code> is optional. A hostname or ip address the server is reachable.</li><li><code>ansible_user</code> - Specifies the SSH username to login with.</li><li><code>ansible_ssh_pass</code> - SSH user password.</li><li><code>ansible_become_pass</code> - The sudo (default) password.</li></ul></blockquote><p>If you have created your inventory properly, run <code>./setup.sh --syntax-check</code> to check for any syntax errors.</p><p>No syntax errors? Let&rsquo;s deploy the cluster!</p><h2 id=deploying-the-kubernetes-cluster>Deploying the Kubernetes cluster</h2><blockquote><p><strong>TASK</strong>: <a href=https://github.com/galexrt/workshop-docker/tree/master/kubernetes202><code>kubernetes202</code></a>
<strong>The servers must have the <code>python</code> and <code>python-netaddr</code> package installed!</strong></p></blockquote><p>Before you continue, enter the task <code>kubernetes202</code> directory. Execute the bash <code>prepare.sh</code> script. The script will download and setup all files required for the deployment of the cluster.
If the script exits with an error, please get in touch with me (It should normally not exit with an error).</p><p>Go into the <code>kubernetes/contrib/ansible</code> directory and execute the <code>./setup.sh</code> with the following argument <code>-vvvv</code> (<code>-vvvv</code> is for verbose output), this will setup Kubernetes on the machines in the inventory.</p><p>When you have done everything correct, it should go through without any errors.</p><p>After the deployment, please wait up to 10 minutes before continuing.
This waiting time is for giving the Kubernetes cluster some time to download all required images and start all <code>kube-system</code> containers.
If you want to be 100% safe, wait up to 15 minutes. Thanks!</p><p>After you have waited some time, please power cycle server after server.</p><h2 id=summary-of-the-kubernetes-deployment>Summary of the Kubernetes deployment</h2><p>We now have a working Kubernetes cluster (<strong>DON&rsquo;T use this setup in production though!</strong> <em>There is more work required to make it secure for production use.</em>).</p><p>We are now ready to deploy objects/containers on to our Kubernetes cluster. :)</p><h2 id=test-the-kubernetes-cluster-health>Test the Kubernetes cluster health</h2><blockquote><p><strong>TASK</strong>: <a href=https://github.com/galexrt/workshop-docker/tree/master/kubernetes101><code>kubernetes101</code></a></p></blockquote><p>In the task <code>kubernetes101</code> directory is a file called <code>busybox.yaml</code>. We will now deploy this file onto our cluster.
The file looks like this:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span><span style=color:#44475a>apiVersion: v1
</span></span></span><span style=display:flex><span><span style=color:#44475a>kind: Pod
</span></span></span><span style=display:flex><span><span style=color:#44475a>metadata:
</span></span></span><span style=display:flex><span><span style=color:#44475a>  name: busybox
</span></span></span><span style=display:flex><span><span style=color:#44475a>  namespace: default
</span></span></span><span style=display:flex><span><span style=color:#44475a>spec:
</span></span></span><span style=display:flex><span><span style=color:#44475a>  containers:
</span></span></span><span style=display:flex><span><span style=color:#44475a>  - image: busybox
</span></span></span><span style=display:flex><span><span style=color:#44475a>    command:
</span></span></span><span style=display:flex><span><span style=color:#44475a>      - sleep
</span></span></span><span style=display:flex><span><span style=color:#44475a>      - &#34;3600&#34;
</span></span></span><span style=display:flex><span><span style=color:#44475a>    imagePullPolicy: IfNotPresent
</span></span></span><span style=display:flex><span><span style=color:#44475a>    name: busybox
</span></span></span><span style=display:flex><span><span style=color:#44475a>  restartPolicy: Always
</span></span></span></code></pre></div><p>The syntax of a &ldquo;kubectl&rdquo; file, is similar to the syntax of <code>docker-compose</code> files. It should get clear when you look at some other examples.</p><p>Connect to the Kubernetes master server. Create the busybox container by running the <code>busybox.yaml</code> file, wait some seconds and then run the following command:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span><span style=color:#44475a>kubectl exec busybox -- nslookup kubernetes
</span></span></span></code></pre></div><p>The output should look like this:</p><blockquote><p><strong>Example Output</strong></p><script type=text/javascript src=https://asciinema.org/a/4v7nj482d4vxxo4kwignm272a.js id=asciicast-4v7nj482d4vxxo4kwignm272a async></script></blockquote><p>If the output shows an error, something went wrong, please contact me.</p><p>No errors? Good move on to the next section.</p><h2 id=take-a-look-at-the-pre-installed-kube-system-containers>Take a look at the pre-installed <code>kube-system</code> containers</h2><p>Open a ssh tunnel, to the Kubernetes master:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span><span style=color:#44475a>ssh -L 8080:127.0.0.1:8080 -fN SERVER_IP_ADDRESS_HERE
</span></span></span></code></pre></div><p>Open your browser and navigate to http://127.0.0.1:8080/.
Welcome to the Kubernetes API!</p><blockquote><p><strong>NOTE</strong> You can close the ssh tunnel, by simply killing the ssh tunnel process.
You can find it using <code>ps ax</code></p></blockquote><h3 id=kubernetes-own-dashboard>Kubernetes own Dashboard</h3><p>Navigate to http://127.0.0.1:8080/ui and look around in the dashboard.</p><blockquote><p><strong>Example Output</strong>
<img src=kubernetes-dashboard-ui.png alt="Kubernetes Dashboard UI Example">
In the above picture, I have already some ReplicationController running on the cluster.</p><p><img src=kubernetes-dashboard-ui-rc-overview-dns.png alt="Kubernetes Dashboard kube-dns RC overview">
The above picture shows the overview page of the <code>kube-dns-v11</code> replication controller in the <code>kube-system</code> namespace.</p></blockquote><p>Just navigate around in the dashboard and see for yourself what you can do.</p><h3 id=monitoring-the-nodes-and-containers-with-heapster-and-grafana>Monitoring the nodes and containers (with Heapster and Grafana)</h3><p>Navigate to http://127.0.0.1:8080/api/v1/proxy/namespaces/kube-system/services/monitoring-grafana/.</p><blockquote><p><img src=kubernetes-grafana-cluster-overview.png alt="Kubernetes Grafana Cluster Node01 Overview">
Overview over the first workshop node usage.</p><hr><p><img src=kubernetes-grafana-pods-kube-dns.png alt="Kubernetes Grafana Pods kube-dns Overview">
Overview over Pod <code>monitoring-influxdb-grafana</code> in namespace <code>kube-system</code>.</p></blockquote><p>Basic monitoring of the cluster nodes, out of the box.
You can see data for your cluster nodes, down to every single Pod.</p><p>Grafana may not work from the begining, but you can easily fix this by changing the data source to type <code>direct</code> and the url to:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span><span style=color:#44475a>http://127.0.0.1:8080/api/v1/proxy/namespaces/kube-system/services/monitoring-influxdb:api/
</span></span></span></code></pre></div><h3 id=all-container-logs-in-one-place-with-an-elk-stack>All Container logs in one place with an ELK stack</h3><p>Navigate to http://127.0.0.1:8080/api/v1/proxy/namespaces/kube-system/services/kibana-logging/.</p><p>After you have created the default index in the formular, you should see the Kibana interface.</p><blockquote><p><img src=kubernetes-kibana-logs.png alt="Kubernetes Kibana Logs">
The &ldquo;homepage&rdquo; of the Kibana running on top of your Kubernetes cluster.
<strong>NOTE</strong> It could happen, that the Kibana is a bit slow, that is just because you are not running on real server hardware or fast VM hosts.</p></blockquote><p>You can try searching for specific logs or create visualizations.</p><hr><h1 id=deployments-with-kubernetes>Deployments with Kubernetes</h1><p>The <code>kubectl</code> utility allows us to create objects, in this section I&rsquo;m going to cover how you can create &ldquo;deployment&rdquo; files for Kubernetes objects.</p><h2 id=busybox-pod-example>BusyBox Pod Example</h2><blockquote><p><strong>TASK</strong>: <a href=https://github.com/galexrt/workshop-docker/tree/master/kubernetes303><code>kubernetes303</code></a></p></blockquote><p>You have already seen this example, but here again with explanations:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span><span style=color:#44475a>apiVersion: v1
</span></span></span><span style=display:flex><span><span style=color:#44475a>kind: Pod
</span></span></span><span style=display:flex><span><span style=color:#44475a>metadata:
</span></span></span><span style=display:flex><span><span style=color:#44475a>  name: busybox
</span></span></span><span style=display:flex><span><span style=color:#44475a>  namespace: default
</span></span></span><span style=display:flex><span><span style=color:#44475a>spec:
</span></span></span><span style=display:flex><span><span style=color:#44475a>  containers:
</span></span></span><span style=display:flex><span><span style=color:#44475a>  - image: busybox
</span></span></span><span style=display:flex><span><span style=color:#44475a>    command:
</span></span></span><span style=display:flex><span><span style=color:#44475a>      - sleep
</span></span></span><span style=display:flex><span><span style=color:#44475a>      - &#34;3600&#34;
</span></span></span><span style=display:flex><span><span style=color:#44475a>    imagePullPolicy: IfNotPresent
</span></span></span><span style=display:flex><span><span style=color:#44475a>    name: busybox
</span></span></span><span style=display:flex><span><span style=color:#44475a>  restartPolicy: Always
</span></span></span></code></pre></div><blockquote><p><strong>WDWD</strong></p><ul><li><code>apiVersion: v1</code> - Sets the API version to use.</li><li><code>kind: Pod</code> - Sets the type/kind of the &ldquo;obejct&rdquo;.</li><li><code>metadata: []</code> - A list of metadata information, like what name or namespace to use.</li><li><code>spec: []</code> - A list of &ldquo;specifications&rdquo;. In this case containing a list of containers.</li><li>Container part see below.</li><li><code>restartPolicy: Always</code> - Restart policy. In this case the pod always restarts, until deleted.</li></ul></blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span><span style=color:#44475a>- image: busybox
</span></span></span><span style=display:flex><span><span style=color:#44475a>  command:
</span></span></span><span style=display:flex><span><span style=color:#44475a>    - sleep
</span></span></span><span style=display:flex><span><span style=color:#44475a>    - &#34;3600&#34;
</span></span></span><span style=display:flex><span><span style=color:#44475a>  imagePullPolicy: IfNotPresent
</span></span></span><span style=display:flex><span><span style=color:#44475a>  name: busybox
</span></span></span></code></pre></div><blockquote><p><strong>WDWD</strong></p><ul><li><code>- image: busybox</code> - Use the busybox image. The <code>-</code> (minus) begins the list entry.</li><li><code>command: []</code> - The command to run in the container (not the entrypoint).</li><li><code>imagePullPolicy: IfNotPresent</code> - The image pull policy.</li><li><code>name: busybox</code> - The name of the container of the pod.</li></ul></blockquote><p>Most things are seem similar but different to <code>docker-compose.yml</code>s, but if you know the basic syntax differences you should be good to go.</p><h2 id=wordpress-and-mysql-pod-example>WordPress and MySQL Pod Example</h2><p>See the file <code>wordpress-mysql/wordpress-mysql-all-in-one.yaml</code>.
This code block only contains the pods, not the services.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span><span style=color:#44475a>apiVersion: v1
</span></span></span><span style=display:flex><span><span style=color:#44475a></span># Service object
</span></span><span style=display:flex><span><span style=color:#44475a>kind: Service
</span></span></span><span style=display:flex><span><span style=color:#44475a>metadata:
</span></span></span><span style=display:flex><span><span style=color:#44475a>  labels:
</span></span></span><span style=display:flex><span><span style=color:#44475a>    name: mysql
</span></span></span><span style=display:flex><span><span style=color:#44475a>  name: mysql
</span></span></span><span style=display:flex><span><span style=color:#44475a>spec:
</span></span></span><span style=display:flex><span><span style=color:#44475a>  ports:
</span></span></span><span style=display:flex><span><span style=color:#44475a>    # the port that this service should serve on
</span></span></span><span style=display:flex><span><span style=color:#44475a>    - port: 3306
</span></span></span><span style=display:flex><span><span style=color:#44475a>  # label keys and values that must match in order to receive traffic for this service
</span></span></span><span style=display:flex><span><span style=color:#44475a>  selector:
</span></span></span><span style=display:flex><span><span style=color:#44475a>    # select pods with the name &#34;mysql&#34;
</span></span></span><span style=display:flex><span><span style=color:#44475a>    name: mysql
</span></span></span><span style=display:flex><span><span style=color:#44475a>---
</span></span></span><span style=display:flex><span><span style=color:#44475a></span># Kubernetes API version
</span></span><span style=display:flex><span><span style=color:#44475a>apiVersion: v1
</span></span></span><span style=display:flex><span><span style=color:#44475a></span># Type of <span style=color:#f1fa8c>&#34;request&#34;</span> in this <span style=color:#ff79c6>case</span> a Pod
</span></span><span style=display:flex><span><span style=color:#44475a>kind: Pod
</span></span></span><span style=display:flex><span><span style=color:#44475a></span># Metadata of the <span style=color:#f1fa8c>&#34;object&#34;</span>
</span></span><span style=display:flex><span><span style=color:#44475a>metadata:
</span></span></span><span style=display:flex><span><span style=color:#44475a>  # Name of the &#34;object&#34;
</span></span></span><span style=display:flex><span><span style=color:#44475a>  name: mysql
</span></span></span><span style=display:flex><span><span style=color:#44475a>  # Labels of the &#34;object&#34;
</span></span></span><span style=display:flex><span><span style=color:#44475a>  labels:
</span></span></span><span style=display:flex><span><span style=color:#44475a>    # A lable named &#34;name&#34; with value &#34;mysql&#34;
</span></span></span><span style=display:flex><span><span style=color:#44475a>    name: mysql
</span></span></span><span style=display:flex><span><span style=color:#44475a></span># spec ~<span style=color:#ff79c6>=</span> Specificationsof the <span style=color:#f1fa8c>&#34;object&#34;</span>
</span></span><span style=display:flex><span><span style=color:#44475a>spec:
</span></span></span><span style=display:flex><span><span style=color:#44475a>  # List of Container definitions
</span></span></span><span style=display:flex><span><span style=color:#44475a>  containers:
</span></span></span><span style=display:flex><span><span style=color:#44475a>    # The &#34;name&#34;/&#34;suffix&#34; of the container name
</span></span></span><span style=display:flex><span><span style=color:#44475a>    - name: mysql
</span></span></span><span style=display:flex><span><span style=color:#44475a>      # What Docker image to use
</span></span></span><span style=display:flex><span><span style=color:#44475a>      image: sameersbn/mysql:latest
</span></span></span><span style=display:flex><span><span style=color:#44475a>      env:
</span></span></span><span style=display:flex><span><span style=color:#44475a>        - name: DB_NAME
</span></span></span><span style=display:flex><span><span style=color:#44475a>          value: wordpress
</span></span></span><span style=display:flex><span><span style=color:#44475a>        - name: DB_USER
</span></span></span><span style=display:flex><span><span style=color:#44475a>          value: wordpress
</span></span></span><span style=display:flex><span><span style=color:#44475a>        - name: DB_PASS
</span></span></span><span style=display:flex><span><span style=color:#44475a>          value: wordpress
</span></span></span><span style=display:flex><span><span style=color:#44475a>      # List of container ports reachable from within the cluster
</span></span></span><span style=display:flex><span><span style=color:#44475a>      ports:
</span></span></span><span style=display:flex><span><span style=color:#44475a>        - containerPort: 3306
</span></span></span><span style=display:flex><span><span style=color:#44475a>          name: mysql
</span></span></span><span style=display:flex><span><span style=color:#44475a>---
</span></span></span><span style=display:flex><span><span style=color:#44475a>apiVersion: v1
</span></span></span><span style=display:flex><span><span style=color:#44475a></span># Service object
</span></span><span style=display:flex><span><span style=color:#44475a>kind: Service
</span></span></span><span style=display:flex><span><span style=color:#44475a>metadata:
</span></span></span><span style=display:flex><span><span style=color:#44475a>  # labels for the service
</span></span></span><span style=display:flex><span><span style=color:#44475a>  labels:
</span></span></span><span style=display:flex><span><span style=color:#44475a>    name: wordpress
</span></span></span><span style=display:flex><span><span style=color:#44475a>  # name of the service
</span></span></span><span style=display:flex><span><span style=color:#44475a>  name: wordpress
</span></span></span><span style=display:flex><span><span style=color:#44475a>spec:
</span></span></span><span style=display:flex><span><span style=color:#44475a>  ports:
</span></span></span><span style=display:flex><span><span style=color:#44475a>    # the port that this service should serve on
</span></span></span><span style=display:flex><span><span style=color:#44475a>    - port: 80
</span></span></span><span style=display:flex><span><span style=color:#44475a>  # label keys and values that must match in order to receive traffic for this service
</span></span></span><span style=display:flex><span><span style=color:#44475a>  selector:
</span></span></span><span style=display:flex><span><span style=color:#44475a>    # select pods with the name &#34;wordpress&#34;
</span></span></span><span style=display:flex><span><span style=color:#44475a>    name: wordpress
</span></span></span><span style=display:flex><span><span style=color:#44475a>---
</span></span></span><span style=display:flex><span><span style=color:#44475a></span># Kubernetes API version
</span></span><span style=display:flex><span><span style=color:#44475a>apiVersion: v1
</span></span></span><span style=display:flex><span><span style=color:#44475a></span># Type of <span style=color:#f1fa8c>&#34;request&#34;</span>
</span></span><span style=display:flex><span><span style=color:#44475a>kind: Pod
</span></span></span><span style=display:flex><span><span style=color:#44475a></span># Metadata of the <span style=color:#f1fa8c>&#34;object&#34;</span>
</span></span><span style=display:flex><span><span style=color:#44475a>metadata:
</span></span></span><span style=display:flex><span><span style=color:#44475a>  # Name of the &#34;object&#34;
</span></span></span><span style=display:flex><span><span style=color:#44475a>  name: wordpress
</span></span></span><span style=display:flex><span><span style=color:#44475a>  # Labels of the &#34;object&#34;
</span></span></span><span style=display:flex><span><span style=color:#44475a>  labels:
</span></span></span><span style=display:flex><span><span style=color:#44475a>    # A lable named &#34;name&#34; with value &#34;wordpress&#34;
</span></span></span><span style=display:flex><span><span style=color:#44475a>    name: wordpress
</span></span></span><span style=display:flex><span><span style=color:#44475a></span># spec ~<span style=color:#ff79c6>=</span> Specifications of the <span style=color:#f1fa8c>&#34;object&#34;</span>
</span></span><span style=display:flex><span><span style=color:#44475a>spec:
</span></span></span><span style=display:flex><span><span style=color:#44475a>  # List of Container definitions
</span></span></span><span style=display:flex><span><span style=color:#44475a>  containers:
</span></span></span><span style=display:flex><span><span style=color:#44475a>    # What Docker image to use
</span></span></span><span style=display:flex><span><span style=color:#44475a>    - image: wordpress
</span></span></span><span style=display:flex><span><span style=color:#44475a>      # The &#34;name&#34;/&#34;suffix&#34; of the container name
</span></span></span><span style=display:flex><span><span style=color:#44475a>      name: wordpress
</span></span></span><span style=display:flex><span><span style=color:#44475a>      # List of environment variables
</span></span></span><span style=display:flex><span><span style=color:#44475a>      env:
</span></span></span><span style=display:flex><span><span style=color:#44475a>        - name: WORDPRESS_DB_HOST
</span></span></span><span style=display:flex><span><span style=color:#44475a>          value: mysql.default:3306
</span></span></span><span style=display:flex><span><span style=color:#44475a>        - name: WORDPRESS_DB_NAME
</span></span></span><span style=display:flex><span><span style=color:#44475a>          value: wordpress
</span></span></span><span style=display:flex><span><span style=color:#44475a>        - name: WORDPRESS_DB_USER
</span></span></span><span style=display:flex><span><span style=color:#44475a>          value: wordpress
</span></span></span><span style=display:flex><span><span style=color:#44475a>        - name: WORDPRESS_DB_PASSWORD
</span></span></span><span style=display:flex><span><span style=color:#44475a>          value: wordpress
</span></span></span><span style=display:flex><span><span style=color:#44475a>        - name: WORDPRESS_AUTH_KEY
</span></span></span><span style=display:flex><span><span style=color:#44475a>          value: SECURE_AUTH_KEY
</span></span></span><span style=display:flex><span><span style=color:#44475a>        - name: WORDPRESS_LOGGED_IN_KEY
</span></span></span><span style=display:flex><span><span style=color:#44475a>          value: SECURE_LOGGED_IN_KEY
</span></span></span><span style=display:flex><span><span style=color:#44475a>        - name: WORDPRESS_AUTH_SALT
</span></span></span><span style=display:flex><span><span style=color:#44475a>          value: SECURE_AUTH_SALT
</span></span></span><span style=display:flex><span><span style=color:#44475a>        - name: WORDPRESS_LOGGED_IN_SALT
</span></span></span><span style=display:flex><span><span style=color:#44475a>          value: SECURE_LOGGED_IN_SALT
</span></span></span><span style=display:flex><span><span style=color:#44475a>      # List of ports to &#34;publish&#34;
</span></span></span><span style=display:flex><span><span style=color:#44475a>      ports:
</span></span></span><span style=display:flex><span><span style=color:#44475a>        # ContainerPort exposes only to the inside of your network, not to the outside
</span></span></span><span style=display:flex><span><span style=color:#44475a>        # To reach the container we create a cluster wide service
</span></span></span><span style=display:flex><span><span style=color:#44475a>        - containerPort: 80
</span></span></span><span style=display:flex><span><span style=color:#44475a>          # gives the port a name
</span></span></span><span style=display:flex><span><span style=color:#44475a>          name: wordpress
</span></span></span></code></pre></div><p>You can see that the syntax is similar to the syntax of <code>docker-compose</code>. It has it&rsquo;s differences, for example the environment variables, but all in all it is similar.
The big difference to <code>docker-compose</code> is that there is more around the container &ldquo;defintions&rdquo;. In <code>docker-compose</code> we &ldquo;only&rdquo; have containers, no services, replication controller and other objects.</p><hr><h1 id=your-turn-lets-deploy-the-guestbook-application>Your turn, let&rsquo;s deploy the Guestbook application</h1><h2 id=run-the-guestbook>Run the Guestbook</h2><blockquote><p><strong>TASK</strong>: <a href=https://github.com/galexrt/workshop-docker/tree/master/kubernetes303><code>kubernetes303</code></a></p></blockquote><p>Enter the <code>guestbook/</code> directory and <code>kubectl</code> create/&ldquo;run&rdquo; the <code>guestbook-all-in-one.yaml</code> file.
For the forgetful, this is how you create/&ldquo;run&rdquo; the file:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span><span style=color:#44475a>kubectl create -f guestbook-all-in-one.yaml
</span></span></span></code></pre></div><blockquote><p><strong>Expected Output</strong></p><script type=text/javascript src=https://asciinema.org/a/c6vjqoascx8q7pkwid39kefhl.js id=asciicast-c6vjqoascx8q7pkwid39kefhl async data-speed=1.5></script></blockquote><p>This will start all services and replication controller that are required by the guestbook application.</p><h2 id=test-the-guestbook>Test the Guestbook</h2><p>To reach the guestbook, navigate to http://127.0.0.1:8080/api/v1/proxy/namespaces/default/services/frontend.</p><blockquote><p><img src=kubernetes-guesbook-home.png alt="Kubernetes Guesbook App">
The guestbook app just started, so there are no entries yet.
<img src=kubernetes-guesbook-entries.png alt="Kubernetes Guesbook App with some example entries">
Now with some entries added.</p></blockquote><p>Now add some entries on your own, then move on to the next section.</p><h2 id=shutdown-one-node>Shutdown one node</h2><blockquote><p>Please shutdown <strong>one</strong> node only, if you have less than <strong>five</strong> nodes. Thanks!
And <strong>don&rsquo;t</strong> shutdown the master server, without a replicated master setup not much will work then.</p></blockquote><p>Et voilà, the application is still up, running and reachable. Kubernetes is going to create new instances of the lost containers from the node.</p><p>Best would be to just reboot and not shutdown the server/VM. Kubernetes has no problem restarting the containers on other servers, but when running with low resources it is the best to keep the &ldquo;downtime&rdquo; low.</p><h1 id=write-your-own-deployment-files>Write your own &ldquo;deployment files&rdquo;</h1><p>As you have already seen some Kubernetes &ldquo;deployment&rdquo; files in this <a href=#Deployments-with-Kubernetes>Deployments with Kubernetes</a> section. We are now going deeper into this topic. To be exact we are now writing our own Kubernetes &ldquo;deployment&rdquo; files.</p><h2 id=wordpress--mysql---wip>WordPress + MySQL - WIP</h2><p>Details about a deploying WordPress with MySQL to Kubernetes can be found here: <a href=https://github.com/kubernetes/kubernetes/tree/release-1.4/examples/mysql-wordpress-pd>https://github.com/kubernetes/kubernetes/tree/release-1.4/examples/mysql-wordpress-pd</a></p><blockquote><p><strong>NOTE</strong></p><p>The link above uses PDs (PersistentDisks) (too. Replace the part with the PDs (PersistentDisks) with hostdirs.</p></blockquote><h1 id=have-fun-with-your-kubernetes-cluster>Have fun with your Kubernetes cluster!</h1><p>Now you can continue to play around with your Kubernetes cluster. Deploy other applications, if you need help please contact me.</p><p>If you want to stop the Kubernetes cluster, please stop all nodes at the same time! Not stopping them at the same time, causes the services required to run the cluster to desync and causes fatal errors.</p><hr><h1 id=the-end>The End</h1><p>If you are reading this, you have made it to the end. Well done, sir or madame! Have a cookie on my cap.</p><center>![Here is a Cookie - From Memegen](here-is-a-cookie.png)</center><hr><h1 id=solutions-for-tests>Solutions for &ldquo;Tests&rdquo;</h1><h2 id=nginx-dockerfile>nginx Dockerfile</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span><span style=color:#44475a>FROM debian:jessie
</span></span></span><span style=display:flex><span><span style=color:#44475a></span>
</span></span><span style=display:flex><span><span style=color:#44475a>RUN apt-get update &amp;&amp; apt-get install -y nginx
</span></span></span><span style=display:flex><span><span style=color:#44475a></span>
</span></span><span style=display:flex><span><span style=color:#44475a>ENTRYPOINT [&#34;nginx&#34;]
</span></span></span></code></pre></div><h2 id=wordpress-and-mysql-docker-composeyml>WordPress and MySQL <code>docker-compose.yml</code></h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span># Taken from https://www.digitalocean.com/community/tutorials/how-to-install-wordpress-and-phpmyadmin-with-docker-compose-on-ubuntu-14-04
</span></span><span style=display:flex><span><span style=color:#44475a>database:
</span></span></span><span style=display:flex><span><span style=color:#44475a>  image: sameersbn/mysql:latest
</span></span></span><span style=display:flex><span><span style=color:#44475a>  environment:
</span></span></span><span style=display:flex><span><span style=color:#44475a>    DB_NAME: wordpress
</span></span></span><span style=display:flex><span><span style=color:#44475a>    DB_USER: wordpress
</span></span></span><span style=display:flex><span><span style=color:#44475a>    DB_PASS: wordpress
</span></span></span><span style=display:flex><span><span style=color:#44475a>  volumes:
</span></span></span><span style=display:flex><span><span style=color:#44475a>    - &#34;/opt/docker/database:/var/lib/mysql:rw&#34;
</span></span></span><span style=display:flex><span><span style=color:#44475a>wordpress:
</span></span></span><span style=display:flex><span><span style=color:#44475a>  image: wordpress
</span></span></span><span style=display:flex><span><span style=color:#44475a>  links:
</span></span></span><span style=display:flex><span><span style=color:#44475a>    - mysql:database
</span></span></span><span style=display:flex><span><span style=color:#44475a>  ports:
</span></span></span><span style=display:flex><span><span style=color:#44475a>    - 8080:80
</span></span></span><span style=display:flex><span><span style=color:#44475a>  environment:
</span></span></span><span style=display:flex><span><span style=color:#44475a>    WORDPRESS_DB_HOST: mysql:3306
</span></span></span><span style=display:flex><span><span style=color:#44475a>    WORDPRESS_DB_NAME: wordpress
</span></span></span><span style=display:flex><span><span style=color:#44475a>    WORDPRESS_DB_USER: wordpress
</span></span></span><span style=display:flex><span><span style=color:#44475a>    WORDPRESS_DB_PASSWORD: wordpress
</span></span></span><span style=display:flex><span><span style=color:#44475a>    WORDPRESS_AUTH_KEY: SECURE_AUTH_KEY
</span></span></span><span style=display:flex><span><span style=color:#44475a>    WORDPRESS_LOGGED_IN_KEY: SECURE_LOGGED_IN_KEY
</span></span></span><span style=display:flex><span><span style=color:#44475a>    WORDPRESS_AUTH_SALT: SECURE_AUTH_SALT
</span></span></span><span style=display:flex><span><span style=color:#44475a>    WORDPRESS_LOGGED_IN_SALT: SECURE_LOGGED_IN_SALT
</span></span></span><span style=display:flex><span><span style=color:#44475a>phpmyadmin:
</span></span></span><span style=display:flex><span><span style=color:#44475a>  image: phpmyadmin/phpmyadmin
</span></span></span><span style=display:flex><span><span style=color:#44475a>  links:
</span></span></span><span style=display:flex><span><span style=color:#44475a>    - mysql:database
</span></span></span><span style=display:flex><span><span style=color:#44475a>  ports:
</span></span></span><span style=display:flex><span><span style=color:#44475a>    - 8181:80
</span></span></span><span style=display:flex><span><span style=color:#44475a>  environment:
</span></span></span><span style=display:flex><span><span style=color:#44475a>    PMA_HOST: mysql
</span></span></span><span style=display:flex><span><span style=color:#44475a>    PMA_USER: root
</span></span></span><span style=display:flex><span><span style=color:#44475a>    PMA_PASSWORD: workshop
</span></span></span></code></pre></div></article><footer class=post-footer><ul class=post-tags><li><a href=https://edenmal.moe/tags/Workshop><span class=tag>Workshop</span></a></li><li><a href=https://edenmal.moe/tags/Docker><span class=tag>Docker</span></a></li><li><a href=https://edenmal.moe/tags/Kubernetes><span class=tag>Kubernetes</span></a></li><li><a href=https://edenmal.moe/tags/Docker-for-Admins><span class=tag>Docker for Admins</span></a></li></ul><p class=post-copyright>© This page/post is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License, please give source if you wish to quote or reproduce.This post was published <strong>683</strong> days ago, content in the post may be inaccurate, even wrong now, please take risk yourself.</p></footer><script src=https://utteranc.es/client.js repo=galexrt/edenmal.moe issue-term=title label=blogpost theme=icy-dark crossorigin=anonymous async></script></section><footer class=site-footer><p>© 2017-2024 Alexander Trost</p><p>Powered by <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a> with customized theme <a href=https://github.com/laozhu/hugo-nuo target=_blank rel=noopener>Nuo</a>.</p></footer><link rel=stylesheet href=https://edenmal.moe/styles/icofont.min.min.css><script async src=https://edenmal.moe/cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.min.120e30ad299b8d6548dd1fbb6ab1d45fb508bf080219df63e5ab9750b1241207.js integrity="sha256-Eg4wrSmbjWVI3R+7arHUX7UIvwgCGd9j5auXULEkEgc="></script><script type=text/x-mathjax-config>
  MathJax.Ajax.config.path["MathJax"] = "/cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5";
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [['$','$'], ['\\(','\\)']],
      displayMath: [['$$','$$'], ['\\[','\\]']],
      processEscapes: true,
      processEnvironments: true,
      skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
      TeX: { equationNumbers: { autoNumber: "AMS" },
      extensions: ["AMSmath.js", "AMSsymbols.js"] }
    },
  });
</script><script type=text/x-mathjax-config>
  // Fix <code> tags after MathJax finishes running. This is a
  // hack to overcome a shortcoming of Markdown. Discussion at
  // https://github.com/mojombo/jekyll/issues/199
  MathJax.Hub.Queue(() => {
    MathJax.Hub.getAllJax().map(v => v.SourceElement().parentNode.className += ' has-jax');
  });
</script><script src=https://edenmal.moe/scripts/index.min.0375b6e63e18876ff8d4ad95bf8ef081176b6b994398d5bd22f5140f45565d37.js integrity="sha256-A3W25j4Yh2/41K2Vv47wgRdra5lDmNW9IvUUD0VWXTc="></script><script>"serviceWorker"in navigator&&navigator.serviceWorker.register("/service-worker.js").then(function(){console.log("[ServiceWorker] Registered")})</script></body></html>