<!doctype html><html lang=en-us><head><meta charset=utf-8><title>Container and Kubernetes - Day #1 | Edenmal - Sysadmin Garden of Eden</title>
<meta name=author content="Alexander Trost"><meta name=description content="Container und Kubernetes Training Material"><meta name=twitter:site content="@galexrt"><meta name=twitter:title content="Container and Kubernetes - Day #1 | Edenmal - Sysadmin Garden of Eden"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://edenmal.moe/post/covers/docker-logo-vertical.png"><meta name=twitter:description content="Container und Kubernetes Training Material"><meta property="og:type" content="article"><meta property="og:title" content="Container and Kubernetes - Day #1"><meta property="og:description" content="Container und Kubernetes Training Material"><meta property="og:url" content="https://edenmal.moe/post/2019/Container-and-Kubernetes-Training-Day1/"><meta property="og:image" content="https://edenmal.moe/post/covers/docker-logo-vertical.png"><meta name=generator content="Hugo 0.120.4"><link rel=canonical href=https://edenmal.moe/post/2019/Container-and-Kubernetes-Training-Day1/><meta name=renderer content="webkit"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=format-detection content="telephone=no,email=no,adress=no"><meta http-equiv=Cache-Control content="no-transform"><meta name=robots content="index,follow"><meta name=referrer content="origin-when-cross-origin"><meta name=theme-color content="#4d4ac7"><meta name=apple-mobile-web-app-capable content="yes"><meta name=apple-mobile-web-app-status-bar-style content="black"><meta name=apple-mobile-web-app-title content="Edenmal"><meta name=msapplication-tooltip content="Edenmal"><meta name=msapplication-navbutton-color content="#4d4ac7"><meta name=msapplication-TileColor content="#4d4ac7"><meta name=msapplication-TileImage content="/icons/icon-144x144.png"><link rel=icon href=https://edenmal.moe/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://edenmal.moe/icons/icon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://edenmal.moe/icons/icon-32x32.png><link rel=icon sizes=192x192 href=https://edenmal.moe/icons/icon-192x192.png><link rel=apple-touch-icon href=https://edenmal.moe/icons/icon-152x152.png><link rel=manifest href=https://edenmal.moe/manifest.json><link rel=preload href=https://edenmal.moe/styles/main-rendered.min.css as=style><link rel=preload href=https://edenmal.moe/images/avatar.png as=image><link rel=preload href=https://edenmal.moe/images/grey-prism.svg as=image><style>body{background-color:#f4f3f1;background-image:url(/images/grey-prism.svg);background-repeat:repeat;background-attachment:fixed}</style><link rel=stylesheet href=https://edenmal.moe/styles/main-rendered.min.css><link rel=stylesheet href=https://edenmal.moe/cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.3/photoswipe.min.min.css><link rel=stylesheet href=https://edenmal.moe/cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.3/default-skin/default-skin.min.min.css><script src=https://edenmal.moe/cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.3/photoswipe.min.min.819c76b4bba0f8b8c568f6e4860173f1d16e5046c01b008f4705ae823b5766e1.js integrity="sha256-gZx2tLug+LjFaPbkhgFz8dFuUEbAGwCPRwWugjtXZuE="></script><script src=https://edenmal.moe/cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.3/photoswipe-ui-default.min.min.2fcfc43be15566e9378af0e8247ba57fec8d4ee95c5dba15cf97e84d6c2115bc.js integrity="sha256-L8/EO+FVZuk3ivDoJHulf+yNTulcXboVz5foTWwhFbw="></script><script src=https://edenmal.moe/cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.min.min.77ec5e7d7f844e9b6c2413a352b48194493a65c75d94d5cd9679a225c2da773c.js integrity="sha256-d+xefX+ETptsJBOjUrSBlEk6ZcddlNXNlnmiJcLadzw="></script><script src=https://edenmal.moe/scripts/pswp-init.min.299a530b67d8be41667aa9ed78920e272e970b0ac8ab7540ba3a7c1382b52de2.js integrity="sha256-KZpTC2fYvkFmeqnteJIOJy6XCwrIq3VAujp8E4K1LeI="></script></head><body><div class=suspension><a role=button aria-label="Go to top" title="Go to top" class="to-top is-hide"><span class=icofont-caret-up aria-hidden=true></span></a>
<a role=button aria-label="Print page" title="Print page" class=print-page onclick=window.print()><span class=icofont-print aria-hidden=true></span></a></div><header class=site-header><a class=avatara href=https://edenmal.moe/><img class=avatar src=https://edenmal.moe/images/avatar.png alt=Avatar></a><h2 class=title><a href=https://edenmal.moe/>Edenmal</a></h2><p class=subtitle>Sysadmin Garden of Eden</p><button class=menu-toggle type=button aria-label="Main Menu" aria-expanded=false tab-index=0>
<span class=icofont-navigation-menu aria-hidden=true></span></button><nav class="site-menu collapsed"><h2 class=offscreen>Main Menu</h2><ul class=menu-list><li class="menu-item
is-active"><a href=https://edenmal.moe/>Home</a></li><li class=menu-item><a href=https://edenmal.moe/about/>About</a></li><li class=menu-item><a href=https://edenmal.moe/tags/>Tags</a></li><li class=menu-item><a href=https://edenmal.moe/events/>Events</a></li><li class=menu-item><a href=https://edenmal.moe/site-notice/>Impressum</a></li></ul></nav><nav class="social-menu collapsed"><h2 class=offscreen>Social Networks</h2><ul class=social-list><li class=social-item><a href=mailto:me@galexrt.moe title=Email aria-label=Email><span class=icofont-envelope aria-hidden=true></span></a></li><li class=social-item><a href=https://galexrt.moe/ rel=me title=Homepage aria-label=Homepage><span class=icofont-page aria-hidden=true></span></a></li><li class=social-item><a href=//github.com/galexrt rel=me title=GitHub aria-label=GitHub><span class=icofont-github aria-hidden=true></span></a></li><li class=social-item><a href=//twitter.com/galexrt rel=me title=Twitter aria-label=Twitter><span class=icofont-twitter aria-hidden=true></span></a></li><li class=social-item><a href=//www.linkedin.com/in/alexander-trost rel=me title=LinkedIn aria-label=LinkedIn><span class=icofont-linkedin aria-hidden=true></span></a></li><li class=social-item><a href=//www.xing.com/profile/Alexander_Trost18 rel=me title=XING aria-label=XING><span class=icofont-xing aria-hidden=true></span></a></li><li class=social-item><a rel=alternate type=application/rss+xml href=https://edenmal.moe/index.xml title=RSS aria-label=RSS><span class=icofont-rss aria-hidden=true></span></a></li></ul></nav></header><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><section class="main post-detail"><header class=post-header><h1 class=post-title>Container and Kubernetes - Day #1</h1><p class=post-meta>Author Alexander Trost · Read Time 61 minutes · Created Tue Mar 26 21:20:06 2019 · Updated Sat Mar 26 17:28:53 2022</p></header><article class=post-content><figure itemprop=associatedMedia itemscope itemtype=http://schema.org/ImageObject><a href=https://edenmal.moe/post/covers/docker-logo-vertical.png itemprop=contentUrl><img itemprop=thumbnail src=https://edenmal.moe/post/covers/docker-logo-vertical.png width=250px></a></figure><h2>Table of Contents</h2><nav id=TableOfContents><ul><li><a href=#welcome>Welcome!</a></li><li><a href=#goal-of-the-training>Goal of the Training</a></li><li><a href=#readme>README</a><ul><li><a href=#heads-up---blogger-words>Heads up - &ldquo;Blogger&rdquo; Words</a></li><li><a href=#whats-in-the-fcking-boxhttpswwwyoutubecomwatchvhoklpjavk_w><a href="https://www.youtube.com/watch?v=HOkLPjaVK_w">&ldquo;What&rsquo;s in the f*cking box?!&rdquo;</a></a></li></ul></li><li><a href=#goal-of-the-day>Goal of the Day</a></li><li><a href=#container-and-microservices>Container and Microservices</a><ul><li><a href=#why-do-people-like-the-docker-way>Why do people like the &ldquo;Docker way&rdquo;?</a></li><li><a href=#micro-what-microservices>Micro-what? Microservices!</a></li><li><a href=#container-container>Container? Container!</a></li></ul></li><li><a href=#prepare-for-the-docker-madness>Prepare for the Docker Madness</a><ul><li><a href=#side-notes>Side Notes</a></li><li><a href=#docker-system-requirements>Docker System Requirements</a></li><li><a href=#docker-installation>Docker Installation</a></li><li><a href=#docker-compose-installation><code>docker-compose</code> Installation</a></li><li><a href=#clone-the-workshop-repo>Clone the workshop repo</a></li></ul></li><li><a href=#running-your-first-docker-containers>Running your first Docker containers</a><ul><li><a href=#hello-world>Hello World!</a></li><li><a href=#basic-commands-you-need-to-know>Basic commands you need to know</a></li><li><a href=#how-do-you-execute-a-command--get-a-shell-inside-a-container>How do you execute a command / get a shell inside a container?</a></li><li><a href=#summary-of-what-we-did-so-far>Summary of what we did so far</a></li><li><a href=#starting-the-wordpress-container>Starting the WordPress container</a></li></ul></li><li><a href=#summary-of-what-we-did-so-far-1>Summary of what we did so far</a></li><li><a href=#data-data-everywhere>Data, Data everywhere!</a><ul><li><a href=#volumes-aka-mounts>Volumes aka Mounts</a></li><li><a href=#docker-volume-command><code>docker volume</code> command</a></li><li><a href=#data-containers--aka---volumes-from-deprecated>Data containers aka <code>--volumes-from</code> (DEPRECATED)</a></li></ul></li><li><a href=#networking>Networking</a><ul><li><a href=#nating-your-way-into-my-container>NATing your way into my container</a></li><li><a href=#over-seven-bridges-you-must-go-docker0-bridge-and-veth-interfaces>Over seven bridges you must go (docker0 bridge and veth interfaces)</a></li><li><a href=#publishing-ports>Publishing ports</a></li><li><a href=#looking-into-your-network>Looking into your network</a></li></ul></li><li><a href=#limiting-container-resources>Limiting container resources</a><ul><li><a href=#cpu-limit>CPU Limit</a></li><li><a href=#memory-and-swap-limit>Memory and Swap Limit</a></li></ul></li><li><a href=#selfies-i-mean-images>Selfies? I mean Images</a><ul><li><a href=#image-names-explained>Image Names explained</a></li><li><a href=#what-have-layer-cakes-to-do-with-container-images>What have Layer Cakes to do with Container Images?</a></li><li><a href=#dockerfile-examples>Dockerfile examples</a></li><li><a href=#understanding-dockerfiles>Understanding Dockerfiles</a></li><li><a href=#commands-you-need-to-know-when-working-with-container-images>Commands you need to know when working with Container images</a></li><li><a href=#lets-build-your-first-container-image>Let&rsquo;s build your first Container image</a></li><li><a href=#how-can-this-help-in-the-development-workflow>How can this help in the development workflow?</a></li></ul></li><li><a href=#composing-containers-together-with-docker-compose>&ldquo;Composing&rdquo; containers together with <code>docker-compose</code></a><ul><li><a href=#making-multi-container-applications-easier-to-start>Making multi container applications easier to start</a></li><li><a href=#starting-our-multi-container-applications-with-one-command>Starting our multi container applications with one command</a></li><li><a href=#deleting-all-containers-from-the-current-docker-compose-file>Deleting all containers from the current <code>docker-compose</code> file</a></li><li><a href=#restarting-all-container-started-by-the-current-docker-compose-file>Restarting all container started by the current <code>docker-compose</code> file</a></li><li><a href=#lets-play-some-more-with-docker-compose>Let&rsquo;s play some more with <code>docker-compose</code>!</a></li></ul></li><li><a href=#summary-of-the-day>Summary of the Day</a></li></ul></nav><hr><h2 id=welcome>Welcome!</h2><p>Quick short introduction to myself, my name is Alexander Trost. I’m a sysadmin who loves automation, containers, coding in Go, playing games but also with new technologies.
I&rsquo;m currently working at Cloudical as a DevOps Engineer, helping companies move to the cloud and / or to container technologies (e.g., Docker, Kubernetes, etc).</p><h2 id=goal-of-the-training>Goal of the Training</h2><p>The training is going to show how simple it is to get started with containers. In this case <a href=https://www.docker.com/>Docker</a> is used, as it is the most popular container toolchain and runtime right now.
After getting to know containers and Docker, we will hopefully realize that there is a need for some kind of <em>magical</em> orchestration layer to run applications and more in containers (in an orchestrated way). The important if you haven&rsquo;t noticed here is the orchestration of containers in an automated and orchestrated manner.</p><hr><h2 id=readme>README</h2><p>If you have any questions or something is unclear during the workshop, please do not hesistate to ask.</p><figure itemprop=associatedMedia itemscope itemtype=http://schema.org/ImageObject><a href=RTFM.png itemprop=contentUrl><img itemprop=thumbnail src=RTFM.png width=450px></a><figcaption><h4>RTFM before asking, thanks!</h4></figcaption></figure><p>Please before asking though make sure you have read the whole question, task and / or comment, thanks!</p><p>Now get ready for day #1 of the training!</p><h3 id=heads-up---blogger-words>Heads up - &ldquo;Blogger&rdquo; Words</h3><ul><li><strong>Grey Boxes</strong>: Mostly contain an useful tip, expected command output or something funny.</li><li><strong>TASK</strong>: Is a refer to a task in the workshop repository.</li><li><strong>WDWD</strong>: Stands for &ldquo;What does what do&rdquo; aka &ldquo;Me explaining what the things listed below do&rdquo; (short forms FTW!). I only explain new things in these sections.</li><li><strong>TL;DR</strong>: <strong>Too</strong> <strong>L</strong>ong <strong>D</strong>idn&rsquo;t <strong>R</strong>ead.</li></ul><h3 id=whats-in-the-fcking-boxhttpswwwyoutubecomwatchvhoklpjavk_w><a href="https://www.youtube.com/watch?v=HOkLPjaVK_w">&ldquo;What&rsquo;s in the f*cking box?!&rdquo;</a></h3><p>The VMs you are given for the training are running Fedora 29 (with Cockpit enabled).
Cockpit is a simple web management, which allows me to &ldquo;monitor&rdquo; the VMs and help, if a problem occurs.
Also to note <code>firewalld</code> has been stopped, disabled and removed, <code>iptables</code> and <code>ip6tables</code> have been cleared and rule persistence disabled.</p><h4 id=why-are-the-vms-running-fedora>Why are the VMs running Fedora?</h4><p>That&rsquo;s simple. Fedora is more up to date, not e.g., like Debian :P</p><p>More &ldquo;up to date&rdquo; may not mean more stable (for &ldquo;classical&rdquo; / legacy applications) but having the latest kernel and other important applications, programs and libraries in their latest versions just makes it easier to run containers.
(Most applications, programs and libraries are available in their latest version from Fedora repositories, meaning that we do not need to begin building and / or downloading binares for applications, programs and libraries which is nice)</p><h2 id=goal-of-the-day>Goal of the Day</h2><p>We are going to learn what containers are, why they have gained so much popularity and what use cases for container there are. After everyone is on the same page of what a container is, we are going to look at Docker, as it is the most common container runtime.
We will look at running and managing containers, and building container images with Docker. <code>docker-compose</code> will also be shown, to demonstrate the simplicity of containers for multi container applications.
This will allow everyone to manage Docker containers and build their own application container images. With that we are ready to dive into enterprise container orchestration with Kubernetes on the next day.</p><hr><h2 id=container-and-microservices>Container and Microservices</h2><h3 id=why-do-people-like-the-docker-way>Why do people like the &ldquo;Docker way&rdquo;?</h3><p>The &ldquo;Docker way&rdquo; is basically just a way to package applications but also simplicity to run the containerized applications. Making it as simple as possible to for example starting a WordPress with database server with only two commands (or one command using <code>docker-compose</code>).
Simpleness that almost everybody, with even very little knowledge about using a shell or cmd, could do it. That&rsquo;s what makes Docker great but also opens a &ldquo;dark&rdquo; side.
The &ldquo;dark&rdquo; side being that those people and for example open issues, because they are unable to do basic debugging of an issue on their own and / or <strong>R</strong>ead<strong>T</strong>he<strong>F</strong>ucking<strong>M</strong>anual.</p><p>Still overall Docker is a good tool, which started the whole &ldquo;container&rdquo; hype.
Thanks to that, all the awesome open source applications using containers, like <a href=https://github.com/opencontainers>Open Container Initiative</a>, <a href=http://kubernetes.io/>Kubernetes</a> and many many more.</p><h3 id=micro-what-microservices>Micro-what? Microservices!</h3><p>Microservices are small gears of a big application.
As an example if you have an application which can show the weather, time and stores the per user timezone, one can imagine the following microservices:</p><ul><li>Weather Service</li><li>Time Service</li><li>User Timezone Profile Service</li><li>Database</li></ul><p>If for example you have many people access the weather service, you could go ahead and scale up / down that single service as needed to accomplish the load.</p><p>A MariaDB database, NoSQL database, Redis, etc, can also be seenfor a big application like, e.g., GitLab, WordPress, Magento, PrestaShop, etc.</p><p>Due to containers being smaller than VMs developers can test locally with ease and containers are and should be ephemeral. You should never have a problem with a container being deleted and / or recreated because for example you would lose data.
But obviously there is also a plus point for production, if Microservices are done right. When done right, it will allow to scale an application with ease at the pain points.</p><p>Meaning, e.g., that if the database is overloaded you would be able to scale it .</p><h3 id=container-container>Container? Container!</h3><p>Currently Docker containers can (and will) only allow you to run any distribution that runs on Linux. NO WINDOWS or other bullshit!
Every container runs in it&rsquo;s own namespace. For this we need to understand how namespaces work.
A namespace is a separated &ldquo;branch&rdquo;, where processes, mounts, etc. can exist without disturbing other processes, mounts, etc. in other namespaces.</p><p>An advantage of namespaces is, that you can limit the cpu, memory, network, etc. for them. For example, a process that goes rogue, can be limited to specific resource limits.</p><p>This diagram should make it clear, how namespaces can create &ldquo;unlimited&rdquo; separated and isolated container environments.</p><p><figure itemprop=associatedMedia itemscope itemtype=http://schema.org/ImageObject><a href=linux-cgroups-namespaces-systemd-hierachy.png itemprop=contentUrl><img itemprop=thumbnail src=linux-cgroups-namespaces-systemd-hierachy.png width=1200px></a><figcaption><h4>Linux cgroups namespaces hierachy - by Shmuel Csaba Otto Traian</h4></figcaption></figure><i>This photo (<a href=https://commons.wikimedia.org/wiki/File:Linux_kernel_unified_hierarchy_cgroups_and_systemd.svg>original</a>) is made by Shmuel Csaba Otto Traian, licensed under the <a href=https://creativecommons.org/licenses/by-sa/3.0/deed.en>CC Attribution-Share Alike 3.0 Unported</a> license.</i></p><p>Docker and most other containers utilities use namespaces to separate containers from each other. There are several other techniques for kernel namespace separation to further improve security.</p><p>A container uses the running Linux kernel of the host, that is why there are less resources used, because a container is just using the existing kernel processes and doesn&rsquo;t need to spawn processes like that like when using a virtual machine.</p><p>Why is it a good idea to use separate namespaces for networked applications? Because if someone breaches for example your webserver, he is just in the container and not on the host server. If you&rsquo;ll then detect the breach, you just stop the container and would restart it with an updated image version that contains the latest webserver software.</p><blockquote><p><strong>TL;DR</strong></p><p>A container is NOT a VM. A container is a &ldquo;separate&rdquo; namespace in the container of the host and not like a VM where everything is virtualized for the system, which can then be controlled.</p></blockquote><hr><h2 id=prepare-for-the-docker-madness>Prepare for the Docker Madness</h2><blockquote><p><strong>NOTE</strong></p><p>These steps only need to be exeucted the VM which has <code>master</code> in its name, not the other machines.</p></blockquote><h3 id=side-notes>Side Notes</h3><ul><li>You can also install Docker on your system or in a VirtualBox. If you use a VirtualBox, please consider using Fedora 29 or anyother linux distro with at least kernel 4.x.</li><li>If you are a Windows or Mac OSX user, switch to linux m8, thanks! Just kidding, there are ways like <a href=http://boot2docker.io/>Boot2Docker</a> to run Docker &ldquo;there&rdquo; (I don&rsquo;t help or give any support if you use it though!).</li><li>The download and login details to the VMs will be given to you.</li></ul><h3 id=docker-system-requirements>Docker System Requirements</h3><figure itemprop=associatedMedia itemscope itemtype=http://schema.org/ImageObject><a href=system-requirements-too-damn-high.png itemprop=contentUrl><img itemprop=thumbnail src=system-requirements-too-damn-high.png width=325px></a><figcaption><h4>The System Requirements are too damn high - Meme</h4></figcaption></figure><p><strong>Nope, they&rsquo;re not! :-D</strong></p><ul><li>A Linux-based distribution</li><li>Linux Kernel <code>4.x+</code><ul><li>If you are on a RHEL based distribution, the <code>3.x</code> should also work though a more up to date kernel is preferred.</li></ul></li></ul><p>You can run Docker under any kernel <code>3.16+</code>, but I recommend you to use a more up to date kernel for the implemented improvements in some of the file system and network systems Docker uses.</p><h3 id=docker-installation>Docker Installation</h3><p>To install Docker run the command:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span><span style=color:#44475a>curl -sSL https://get.docker.com/ -o install-docker.sh
</span></span></span><span style=display:flex><span><span style=color:#44475a></span># Look at the install-docker.sh script to make sure there is nothing evil going on
</span></span><span style=display:flex><span><span style=color:#44475a>sh install-docker.sh
</span></span></span></code></pre></div><p>For more details on the installation of Docker, please refer to the Docker documentation Linux installation <a href=https://docs.docker.com/install/>docs</a> and select the distribution in the navigation sidebar, or the Windows installation <a href=https://docs.docker.com/docker-for-windows/>docs</a>.</p><p>Docker consistst of the client program <code>docker</code> and the Docker Daemon (<code>dockerd</code>). To keep it simple &ldquo;that is it&rdquo;, but there is more behind Docker.</p><p>After you have installed it hopefully without any errors popping up, you have to enable and start the Docker Engine:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span><span style=color:#44475a>systemctl enable docker.service
</span></span></span><span style=display:flex><span><span style=color:#44475a>systemctl start docker.service
</span></span></span></code></pre></div><p>This enables and starts the Docker daemon service.</p><p>To make sure the Docker daemon is working as expected, run <code>docker info</code>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span>$ docker info
</span></span><span style=display:flex><span><span style=color:#44475a>Containers: 0
</span></span></span><span style=display:flex><span><span style=color:#44475a> Running: 0
</span></span></span><span style=display:flex><span><span style=color:#44475a> Paused: 0
</span></span></span><span style=display:flex><span><span style=color:#44475a> Stopped: 0
</span></span></span><span style=display:flex><span><span style=color:#44475a>Images: 31
</span></span></span><span style=display:flex><span><span style=color:#44475a>Server Version: 18.09.3-ce
</span></span></span><span style=display:flex><span><span style=color:#44475a>Storage Driver: overlay2
</span></span></span><span style=display:flex><span><span style=color:#44475a> Backing Filesystem: extfs
</span></span></span><span style=display:flex><span><span style=color:#44475a> Supports d_type: true
</span></span></span><span style=display:flex><span><span style=color:#44475a> Native Overlay Diff: false
</span></span></span><span style=display:flex><span><span style=color:#44475a>Logging Driver: json-file
</span></span></span><span style=display:flex><span><span style=color:#44475a>Cgroup Driver: cgroupfs
</span></span></span><span style=display:flex><span><span style=color:#44475a>Plugins:
</span></span></span><span style=display:flex><span><span style=color:#44475a> Volume: local
</span></span></span><span style=display:flex><span><span style=color:#44475a> Network: bridge host macvlan null overlay
</span></span></span><span style=display:flex><span><span style=color:#44475a> Log: awslogs fluentd gcplogs gelf journald json-file local logentries splunk syslog
</span></span></span><span style=display:flex><span><span style=color:#44475a>Swarm: inactive
</span></span></span><span style=display:flex><span><span style=color:#44475a>Runtimes: runc
</span></span></span><span style=display:flex><span><span style=color:#44475a>Default Runtime: runc
</span></span></span><span style=display:flex><span><span style=color:#44475a>Init Binary: docker-init
</span></span></span><span style=display:flex><span><span style=color:#44475a>containerd version: bb71b10fd8f58240ca47fbb579b9d1028eea7c84.m
</span></span></span><span style=display:flex><span><span style=color:#44475a>runc version: ccb5efd37fb7c86364786e9137e22948751de7ed-dirty
</span></span></span><span style=display:flex><span><span style=color:#44475a>init version: fec3683
</span></span></span><span style=display:flex><span><span style=color:#44475a>Security Options:
</span></span></span><span style=display:flex><span><span style=color:#44475a> seccomp
</span></span></span><span style=display:flex><span><span style=color:#44475a>  Profile: default
</span></span></span><span style=display:flex><span><span style=color:#44475a>Kernel Version: 5.0.5
</span></span></span><span style=display:flex><span><span style=color:#44475a>Operating System: Manjaro Linux
</span></span></span><span style=display:flex><span><span style=color:#44475a>OSType: linux
</span></span></span><span style=display:flex><span><span style=color:#44475a>Architecture: x86_64
</span></span></span><span style=display:flex><span><span style=color:#44475a>CPUs: 16
</span></span></span><span style=display:flex><span><span style=color:#44475a>Total Memory: 31.35GiB
</span></span></span><span style=display:flex><span><span style=color:#44475a>Name: debwrk01
</span></span></span><span style=display:flex><span><span style=color:#44475a>ID: SZK7:4SPS:NJUU:6FTH:YUFZ:6U5B:CNGQ:HICZ:DEZZ:EADO:JDUB:6SGH
</span></span></span><span style=display:flex><span><span style=color:#44475a>Docker Root Dir: /var/lib/docker
</span></span></span><span style=display:flex><span><span style=color:#44475a>Debug Mode (client): false
</span></span></span><span style=display:flex><span><span style=color:#44475a>Debug Mode (server): false
</span></span></span><span style=display:flex><span><span style=color:#44475a>Username: galexrt
</span></span></span><span style=display:flex><span><span style=color:#44475a>Registry: https://index.docker.io/v1/
</span></span></span><span style=display:flex><span><span style=color:#44475a>Labels:
</span></span></span><span style=display:flex><span><span style=color:#44475a>Experimental: false
</span></span></span><span style=display:flex><span><span style=color:#44475a>Insecure Registries:
</span></span></span><span style=display:flex><span><span style=color:#44475a> 127.0.0.0/8
</span></span></span><span style=display:flex><span><span style=color:#44475a>Live Restore Enabled: false
</span></span></span></code></pre></div><p>After making sure Docker is working correctly, continue with either <a href=#non-root-user>Non-Root User section</a> when you accessing the server as a non-root user or directly to the next section, <a href=#docker-compose-installation><code>docker-compose</code> Installation</a>.</p><h4 id=non-root-user>Non-Root User</h4><p>If you are connected as a non-root user, you need to add your user to the <code>docker</code> group. The group name may vary depending on the distribution used.
To add your user to the <code>docker</code> group, you can run the following command:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span><span style=color:#44475a>gpasswd -a $USER docker
</span></span></span></code></pre></div><p>Please logout from the server, after you have added yourself to the group.</p><blockquote><p><strong>NOTE</strong></p><p>If you are persistent control connections for SSH, you need to terminate those connections as well when you are logged in as the user you just added to the Docker group.</p></blockquote><h3 id=docker-compose-installation><code>docker-compose</code> Installation</h3><figure itemprop=associatedMedia itemscope itemtype=http://schema.org/ImageObject><a href=docker-compose-logo.png itemprop=contentUrl><img itemprop=thumbnail src=docker-compose-logo.png width=225px></a><figcaption><h4>docker-compose Logo</h4></figcaption></figure><p>With curl we download the <code>docker-compose</code> binary, then we move <code>docker-compose</code> to your <code>/usr/local/bin</code> that is in your <code>PATH</code> and set the execute permission.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span>$ sudo curl -L <span style=color:#f1fa8c>&#34;https://github.com/docker/compose/releases/download/1.24.0/docker-compose-</span><span style=color:#ff79c6>$(</span>uname -s<span style=color:#ff79c6>)</span><span style=color:#f1fa8c>-</span><span style=color:#ff79c6>$(</span>uname -m<span style=color:#ff79c6>)</span><span style=color:#f1fa8c>&#34;</span> -o /usr/local/bin/docker-compose
</span></span><span style=display:flex><span>% Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
</span></span><span style=display:flex><span><span style=color:#44475a>                               Dload  Upload   Total   Spent    Left  Speed
</span></span></span><span style=display:flex><span><span style=color:#44475a>100   617    0   617    0     0   1226      0 --:--:-- --:--:-- --:--:--  1226
</span></span></span><span style=display:flex><span><span style=color:#44475a>100 15.4M  100 15.4M    0     0  5751k      0  0:00:02  0:00:02 --:--:-- 7099k
</span></span></span><span style=display:flex><span><span style=color:#44475a></span>$ sudo chmod +x /usr/local/bin/docker-compose
</span></span></code></pre></div><p>For more detailed <code>docker-compose</code> installation instructions, see <a href=https://docs.docker.com/compose/install/>https://docs.docker.com/compose/install/</a>.</p><p>After you have followed the commands above, you can check if the &ldquo;install&rdquo; was successfully by running <code>docker-compose version</code>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span>$ docker-compose version
</span></span><span style=display:flex><span><span style=color:#44475a>docker-compose version 1.23.2, build unknown
</span></span></span><span style=display:flex><span><span style=color:#44475a>docker-py version: 3.7.0
</span></span></span><span style=display:flex><span><span style=color:#44475a>CPython version: 3.7.2
</span></span></span><span style=display:flex><span><span style=color:#44475a>OpenSSL version: OpenSSL 1.1.1b  26 Feb 2019
</span></span></span></code></pre></div><h3 id=clone-the-workshop-repo>Clone the workshop repo</h3><p>Clone the repository, which contains the example and task files, from GitHub <code>https://github.com/galexrt/workshop-container-docker-kubernetes.git</code>. It&rsquo;ll provide all files and tasks used in the Workshop.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span>$ git clone https://github.com/galexrt/workshop-container-docker-kubernetes.git
</span></span><span style=display:flex><span><span style=color:#44475a>Cloning into &#39;workshop-container-docker-kubernetes&#39;...
</span></span></span><span style=display:flex><span><span style=color:#44475a>remote: Enumerating objects: 30, done.
</span></span></span><span style=display:flex><span><span style=color:#44475a>remote: Counting objects: 100% (30/30), done.
</span></span></span><span style=display:flex><span><span style=color:#44475a>remote: Compressing objects: 100% (23/23), done.
</span></span></span><span style=display:flex><span><span style=color:#44475a>remote: Total 30 (delta 3), reused 30 (delta 3), pack-reused 0
</span></span></span><span style=display:flex><span><span style=color:#44475a>Unpacking objects: 100% (30/30), done.
</span></span></span></code></pre></div><p>Now you are ready to run your first container!</p><hr><h2 id=running-your-first-docker-containers>Running your first Docker containers</h2><p>This section will guide you through starting your first container and the process of starting a WordPress container with a MariaDB database container.</p><h3 id=hello-world>Hello World!</h3><p>Now to start your first container and test your Docker installation, we will start like when learning a new programming language, with a simple example: a &ldquo;Hello World&rdquo; container.</p><p>To run the &ldquo;Hello World&rdquo; container, you just run the following command:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span>$ docker run hello-world
</span></span><span style=display:flex><span><span style=color:#44475a>Unable to find image &#39;hello-world:latest&#39; locally
</span></span></span><span style=display:flex><span><span style=color:#44475a>latest: Pulling from library/hello-world
</span></span></span><span style=display:flex><span><span style=color:#44475a>1b930d010525: Pull complete
</span></span></span><span style=display:flex><span><span style=color:#44475a>Digest: sha256:2557e3c07ed1e38f26e389462d03ed943586f744621577a99efb77324b0fe535
</span></span></span><span style=display:flex><span><span style=color:#44475a>Status: Downloaded newer image for hello-world:latest
</span></span></span><span style=display:flex><span><span style=color:#44475a></span>
</span></span><span style=display:flex><span><span style=color:#44475a>Hello from Docker!
</span></span></span><span style=display:flex><span><span style=color:#44475a>This message shows that your installation appears to be working correctly.
</span></span></span><span style=display:flex><span><span style=color:#44475a></span>
</span></span><span style=display:flex><span><span style=color:#44475a>To generate this message, Docker took the following steps:
</span></span></span><span style=display:flex><span><span style=color:#44475a> 1. The Docker client contacted the Docker daemon.
</span></span></span><span style=display:flex><span><span style=color:#44475a> 2. The Docker daemon pulled the &#34;hello-world&#34; image from the Docker Hub.
</span></span></span><span style=display:flex><span><span style=color:#44475a>    (amd64)
</span></span></span><span style=display:flex><span><span style=color:#44475a> 3. The Docker daemon created a new container from that image which runs the
</span></span></span><span style=display:flex><span><span style=color:#44475a>    executable that produces the output you are currently reading.
</span></span></span><span style=display:flex><span><span style=color:#44475a> 4. The Docker daemon streamed that output to the Docker client, which sent it
</span></span></span><span style=display:flex><span><span style=color:#44475a>    to your terminal.
</span></span></span><span style=display:flex><span><span style=color:#44475a></span>
</span></span><span style=display:flex><span><span style=color:#44475a>To try something more ambitious, you can run an Ubuntu container with:
</span></span></span><span style=display:flex><span><span style=color:#44475a> $ docker run -it ubuntu bash
</span></span></span><span style=display:flex><span><span style=color:#44475a></span>
</span></span><span style=display:flex><span><span style=color:#44475a>Share images, automate workflows, and more with a free Docker ID:
</span></span></span><span style=display:flex><span><span style=color:#44475a> https://hub.docker.com/
</span></span></span><span style=display:flex><span><span style=color:#44475a></span>
</span></span><span style=display:flex><span><span style=color:#44475a>For more examples and ideas, visit:
</span></span></span><span style=display:flex><span><span style=color:#44475a> https://docs.docker.com/get-started/
</span></span></span></code></pre></div><p>When everything went correct, you should have a similar output and I can now welcome you to the big world of the containers!</p><figure itemprop=associatedMedia itemscope itemtype=http://schema.org/ImageObject><a href=welcome-to-the-danger-zone.png itemprop=contentUrl><img itemprop=thumbnail src=welcome-to-the-danger-zone.png width=450px></a><figcaption><h4>Welcome to the Danger Zone! - Taken from MemeGenerator.net</h4></figcaption></figure><h3 id=basic-commands-you-need-to-know>Basic commands you need to know</h3><p>These are a few basic Docker commands which are useful and important for working with Docker:</p><h4 id=docker-ps><code>docker ps</code></h4><p>Displays all currently running containers. To display all containers even containers which are not running anymore, add the <code>-a</code> flag.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span>$ docker ps
</span></span><span style=display:flex><span># Or
</span></span><span style=display:flex><span>$ docker ps -a
</span></span></code></pre></div><h4 id=docker-start-container_name_or_id--docker-stop-container_name_or_id><code>docker start CONTAINER_NAME_OR_ID</code> / <code>docker stop CONTAINER_NAME_OR_ID</code></h4><p>Start or stop a container by sending a <code>SIGTERM</code> (<code>15</code>) first and after a timeout of default 10 seconds, a <code>SIGKILL</code> (<code>9</code>) is sent.
Both commands just print out the targeted container(s) name.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span>$ docker stop my-cool-container
</span></span><span style=display:flex><span><span style=color:#44475a>my-cool-container
</span></span></span><span style=display:flex><span><span style=color:#44475a></span>$ docker start my-cool-container
</span></span><span style=display:flex><span><span style=color:#44475a>my-cool-container
</span></span></span></code></pre></div><h4 id=docker-restart-container_name_or_id><code>docker restart CONTAINER_NAME_OR_ID</code></h4><p>Stop and start the given container(s). Where <code>CONTAINER_NAME_OR_ID</code> is a container ID or name.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span>$ docker restart my-cool-container
</span></span><span style=display:flex><span><span style=color:#44475a>my-cool-container
</span></span></span></code></pre></div><h4 id=docker-rm-container_name_or_id><code>docker rm CONTAINER_NAME_OR_ID</code></h4><p>Remove a stopped or exited container. Where <code>CONTAINER_NAME_OR_ID</code> is a container ID or name.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span>$ docker rm my-cool-container
</span></span><span style=display:flex><span><span style=color:#44475a>my-cool-container
</span></span></span></code></pre></div><h4 id=docker-logs-container_name_or_id><code>docker logs CONTAINER_NAME_OR_ID</code></h4><p>Show the logs of a container. Where <code>CONTAINER_NAME_OR_ID</code> is a container ID or name.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span>$ docker logs my-cool-container
</span></span><span style=display:flex><span><span style=color:#44475a>[... Many log lines from the my-cool-container application ...]
</span></span></span></code></pre></div><h4 id=docker-images><code>docker images</code></h4><p>List the images with the tags and size which are currently on the Docker host.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span>$ docker images
</span></span><span style=display:flex><span><span style=color:#44475a>REPOSITORY                         TAG                                          IMAGE ID            CREATED             SIZE
</span></span></span><span style=display:flex><span><span style=color:#44475a>fedora-emacs                       latest                                       f8f91b022f8c        About an hour ago   965MB
</span></span></span><span style=display:flex><span><span style=color:#44475a>wordpress                          5.1-php7.1-apache                            bfb3e0bc8467        3 days ago          412MB
</span></span></span><span style=display:flex><span><span style=color:#44475a>golang                             1.12.2-stretch                               c7942203692b        3 days ago          774MB
</span></span></span><span style=display:flex><span><span style=color:#44475a>busybox                            1.30.1-glibc                                 d5d8c9fc06a4        7 days ago          4.46MB
</span></span></span><span style=display:flex><span><span style=color:#44475a>centos                             7                                            9f38484d220f        3 weeks ago         202MB
</span></span></span><span style=display:flex><span><span style=color:#44475a>mariadb                            10.4.3-bionic                                9057231b8afe        4 weeks ago         379MB
</span></span></span><span style=display:flex><span><span style=color:#44475a>fedora                             29                                           d7372e6c93c6        7 weeks ago         275MB
</span></span></span></code></pre></div><h4 id=docker-run><code>docker run</code></h4><p>Create and start a container. This comnmand will be shown extensively in the next section.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span><span style=color:#44475a>docker run --help
</span></span></span><span style=display:flex><span><span style=color:#44475a></span>
</span></span><span style=display:flex><span><span style=color:#44475a>Usage:	docker run [OPTIONS] IMAGE [COMMAND] [ARG...]
</span></span></span><span style=display:flex><span><span style=color:#44475a></span>
</span></span><span style=display:flex><span><span style=color:#44475a>Run a command in a new container
</span></span></span><span style=display:flex><span><span style=color:#44475a></span>
</span></span><span style=display:flex><span><span style=color:#44475a>Options:
</span></span></span><span style=display:flex><span><span style=color:#44475a>      --add-host list                  Add a custom host-to-IP mapping (host:ip)
</span></span></span><span style=display:flex><span><span style=color:#44475a>  -a, --attach list                    Attach to STDIN, STDOUT or STDERR
</span></span></span><span style=display:flex><span><span style=color:#44475a>      --blkio-weight uint16            Block IO (relative weight), between 10 and 1000, or 0 to disable (default 0)
</span></span></span><span style=display:flex><span><span style=color:#44475a>      --blkio-weight-device list       Block IO weight (relative device weight) (default [])
</span></span></span><span style=display:flex><span><span style=color:#44475a>      --cap-add list                   Add Linux capabilities
</span></span></span><span style=display:flex><span><span style=color:#44475a>      --cap-drop list                  Drop Linux capabilities
</span></span></span><span style=display:flex><span><span style=color:#44475a>      --cgroup-parent string           Optional parent cgroup for the container
</span></span></span><span style=display:flex><span><span style=color:#44475a>      --cidfile string                 Write the container ID to the file
</span></span></span><span style=display:flex><span><span style=color:#44475a>      --cpu-period int                 Limit CPU CFS (Completely Fair Scheduler) period
</span></span></span><span style=display:flex><span><span style=color:#44475a>      --cpu-quota int                  Limit CPU CFS (Completely Fair Scheduler) quota
</span></span></span><span style=display:flex><span><span style=color:#44475a>      --cpu-rt-period int              Limit CPU real-time period in microseconds
</span></span></span><span style=display:flex><span><span style=color:#44475a>      --cpu-rt-runtime int             Limit CPU real-time runtime in microseconds
</span></span></span><span style=display:flex><span><span style=color:#44475a>  -c, --cpu-shares int                 CPU shares (relative weight)
</span></span></span><span style=display:flex><span><span style=color:#44475a>      --cpus decimal                   Number of CPUs
</span></span></span><span style=display:flex><span><span style=color:#44475a>      --cpuset-cpus string             CPUs in which to allow execution (0-3, 0,1)
</span></span></span><span style=display:flex><span><span style=color:#44475a>      --cpuset-mems string             MEMs in which to allow execution (0-3, 0,1)
</span></span></span><span style=display:flex><span><span style=color:#44475a>  -d, --detach                         Run container in background and print container ID
</span></span></span><span style=display:flex><span><span style=color:#44475a>      --detach-keys string             Override the key sequence for detaching a container
</span></span></span><span style=display:flex><span><span style=color:#44475a>      --device list                    Add a host device to the container
</span></span></span><span style=display:flex><span><span style=color:#44475a>      --device-cgroup-rule list        Add a rule to the cgroup allowed devices list
</span></span></span><span style=display:flex><span><span style=color:#44475a>      --device-read-bps list           Limit read rate (bytes per second) from a device (default [])
</span></span></span><span style=display:flex><span><span style=color:#44475a>      --device-read-iops list          Limit read rate (IO per second) from a device (default [])
</span></span></span><span style=display:flex><span><span style=color:#44475a>      --device-write-bps list          Limit write rate (bytes per second) to a device (default [])
</span></span></span><span style=display:flex><span><span style=color:#44475a>      --device-write-iops list         Limit write rate (IO per second) to a device (default [])
</span></span></span><span style=display:flex><span><span style=color:#44475a>      --disable-content-trust          Skip image verification (default true)
</span></span></span><span style=display:flex><span><span style=color:#44475a>      --dns list                       Set custom DNS servers
</span></span></span><span style=display:flex><span><span style=color:#44475a>      --dns-option list                Set DNS options
</span></span></span><span style=display:flex><span><span style=color:#44475a>      --dns-search list                Set custom DNS search domains
</span></span></span><span style=display:flex><span><span style=color:#44475a>      --entrypoint string              Overwrite the default ENTRYPOINT of the image
</span></span></span><span style=display:flex><span><span style=color:#44475a>  -e, --env list                       Set environment variables
</span></span></span><span style=display:flex><span><span style=color:#44475a>      --env-file list                  Read in a file of environment variables
</span></span></span><span style=display:flex><span><span style=color:#44475a>      --expose list                    Expose a port or a range of ports
</span></span></span><span style=display:flex><span><span style=color:#44475a>      --group-add list                 Add additional groups to join
</span></span></span><span style=display:flex><span><span style=color:#44475a>      --health-cmd string              Command to run to check health
</span></span></span><span style=display:flex><span><span style=color:#44475a>      --health-interval duration       Time between running the check (ms|s|m|h) (default 0s)
</span></span></span><span style=display:flex><span><span style=color:#44475a>      --health-retries int             Consecutive failures needed to report unhealthy
</span></span></span><span style=display:flex><span><span style=color:#44475a>      --health-start-period duration   Start period for the container to initialize before starting health-retries countdown (ms|s|m|h) (default 0s)
</span></span></span><span style=display:flex><span><span style=color:#44475a>      --health-timeout duration        Maximum time to allow one check to run (ms|s|m|h) (default 0s)
</span></span></span><span style=display:flex><span><span style=color:#44475a>      --help                           Print usage
</span></span></span><span style=display:flex><span><span style=color:#44475a>  -h, --hostname string                Container host name
</span></span></span><span style=display:flex><span><span style=color:#44475a>      --init                           Run an init inside the container that forwards signals and reaps processes
</span></span></span><span style=display:flex><span><span style=color:#44475a>  -i, --interactive                    Keep STDIN open even if not attached
</span></span></span><span style=display:flex><span><span style=color:#44475a>      --ip string                      IPv4 address (e.g., 172.30.100.104)
</span></span></span><span style=display:flex><span><span style=color:#44475a>      --ip6 string                     IPv6 address (e.g., 2001:db8::33)
</span></span></span><span style=display:flex><span><span style=color:#44475a>      --ipc string                     IPC mode to use
</span></span></span><span style=display:flex><span><span style=color:#44475a>      --isolation string               Container isolation technology
</span></span></span><span style=display:flex><span><span style=color:#44475a>      --kernel-memory bytes            Kernel memory limit
</span></span></span><span style=display:flex><span><span style=color:#44475a>  -l, --label list                     Set meta data on a container
</span></span></span><span style=display:flex><span><span style=color:#44475a>      --label-file list                Read in a line delimited file of labels
</span></span></span><span style=display:flex><span><span style=color:#44475a>      --link list                      Add link to another container
</span></span></span><span style=display:flex><span><span style=color:#44475a>      --link-local-ip list             Container IPv4/IPv6 link-local addresses
</span></span></span><span style=display:flex><span><span style=color:#44475a>      --log-driver string              Logging driver for the container
</span></span></span><span style=display:flex><span><span style=color:#44475a>      --log-opt list                   Log driver options
</span></span></span><span style=display:flex><span><span style=color:#44475a>      --mac-address string             Container MAC address (e.g., 92:d0:c6:0a:29:33)
</span></span></span><span style=display:flex><span><span style=color:#44475a>  -m, --memory bytes                   Memory limit
</span></span></span><span style=display:flex><span><span style=color:#44475a>      --memory-reservation bytes       Memory soft limit
</span></span></span><span style=display:flex><span><span style=color:#44475a>      --memory-swap bytes              Swap limit equal to memory plus swap: &#39;-1&#39; to enable unlimited swap
</span></span></span><span style=display:flex><span><span style=color:#44475a>      --memory-swappiness int          Tune container memory swappiness (0 to 100) (default -1)
</span></span></span><span style=display:flex><span><span style=color:#44475a>      --mount mount                    Attach a filesystem mount to the container
</span></span></span><span style=display:flex><span><span style=color:#44475a>      --name string                    Assign a name to the container
</span></span></span><span style=display:flex><span><span style=color:#44475a>      --network string                 Connect a container to a network (default &#34;default&#34;)
</span></span></span><span style=display:flex><span><span style=color:#44475a>      --network-alias list             Add network-scoped alias for the container
</span></span></span><span style=display:flex><span><span style=color:#44475a>      --no-healthcheck                 Disable any container-specified HEALTHCHECK
</span></span></span><span style=display:flex><span><span style=color:#44475a>      --oom-kill-disable               Disable OOM Killer
</span></span></span><span style=display:flex><span><span style=color:#44475a>      --oom-score-adj int              Tune host&#39;s OOM preferences (-1000 to 1000)
</span></span></span><span style=display:flex><span><span style=color:#44475a>      --pid string                     PID namespace to use
</span></span></span><span style=display:flex><span><span style=color:#44475a>      --pids-limit int                 Tune container pids limit (set -1 for unlimited)
</span></span></span><span style=display:flex><span><span style=color:#44475a>      --privileged                     Give extended privileges to this container
</span></span></span><span style=display:flex><span><span style=color:#44475a>  -p, --publish list                   Publish a container&#39;s port(s) to the host
</span></span></span><span style=display:flex><span><span style=color:#44475a>  -P, --publish-all                    Publish all exposed ports to random ports
</span></span></span><span style=display:flex><span><span style=color:#44475a>      --read-only                      Mount the container&#39;s root filesystem as read only
</span></span></span><span style=display:flex><span><span style=color:#44475a>      --restart string                 Restart policy to apply when a container exits (default &#34;no&#34;)
</span></span></span><span style=display:flex><span><span style=color:#44475a>      --rm                             Automatically remove the container when it exits
</span></span></span><span style=display:flex><span><span style=color:#44475a>      --runtime string                 Runtime to use for this container
</span></span></span><span style=display:flex><span><span style=color:#44475a>      --security-opt list              Security Options
</span></span></span><span style=display:flex><span><span style=color:#44475a>      --shm-size bytes                 Size of /dev/shm
</span></span></span><span style=display:flex><span><span style=color:#44475a>      --sig-proxy                      Proxy received signals to the process (default true)
</span></span></span><span style=display:flex><span><span style=color:#44475a>      --stop-signal string             Signal to stop a container (default &#34;SIGTERM&#34;)
</span></span></span><span style=display:flex><span><span style=color:#44475a>      --stop-timeout int               Timeout (in seconds) to stop a container
</span></span></span><span style=display:flex><span><span style=color:#44475a>      --storage-opt list               Storage driver options for the container
</span></span></span><span style=display:flex><span><span style=color:#44475a>      --sysctl map                     Sysctl options (default map[])
</span></span></span><span style=display:flex><span><span style=color:#44475a>      --tmpfs list                     Mount a tmpfs directory
</span></span></span><span style=display:flex><span><span style=color:#44475a>  -t, --tty                            Allocate a pseudo-TTY
</span></span></span><span style=display:flex><span><span style=color:#44475a>      --ulimit ulimit                  Ulimit options (default [])
</span></span></span><span style=display:flex><span><span style=color:#44475a>  -u, --user string                    Username or UID (format: &lt;name|uid&gt;[:&lt;group|gid&gt;])
</span></span></span><span style=display:flex><span><span style=color:#44475a>      --userns string                  User namespace to use
</span></span></span><span style=display:flex><span><span style=color:#44475a>      --uts string                     UTS namespace to use
</span></span></span><span style=display:flex><span><span style=color:#44475a>  -v, --volume list                    Bind mount a volume
</span></span></span><span style=display:flex><span><span style=color:#44475a>      --volume-driver string           Optional volume driver for the container
</span></span></span><span style=display:flex><span><span style=color:#44475a>      --volumes-from list              Mount volumes from the specified container(s)
</span></span></span><span style=display:flex><span><span style=color:#44475a>  -w, --workdir string                 Working directory inside the container
</span></span></span></code></pre></div><p>As we can see <code>docker run</code> has a lot of flags, to choose from. These flags allow to &ldquo;configure&rdquo; how the container should created.</p><blockquote><p><strong>NOTE</strong></p><p>Most of these flags are also available for <code>docker create</code>, which can be used to create containers but not start them.</p></blockquote><p>In this workshop we are only covering the basic flags, you should know to begin with.</p><p>So we are going to focus on the usage part first:</p><blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console></code></pre></div></blockquote><p>$ docker run &ndash;help</p><p>Usage: docker run [OPTIONS] IMAGE [COMMAND] [ARG&mldr;]</p><p>Run a command in a new container</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mysql data-lang=mysql><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>&gt;</span> <span style=color:#ff79c6>**</span>WDWD<span style=color:#ff79c6>**</span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>*</span> <span style=color:#ff79c6>`</span>[OPTIONS]<span style=color:#ff79c6>`</span> <span style=color:#ff79c6>-</span> Run flags <span style=color:#ff79c6>for</span> the container <span style=color:#ff79c6>to</span> be run.
</span></span><span style=display:flex><span><span style=color:#ff79c6>*</span> <span style=color:#ff79c6>`</span>IMAGE<span style=color:#ff79c6>`</span> <span style=color:#ff79c6>-</span> The name of the Container image <span style=color:#ff79c6>to</span> <span style=color:#ff79c6>use</span> <span style=color:#ff79c6>for</span> the container.
</span></span><span style=display:flex><span><span style=color:#ff79c6>*</span> <span style=color:#ff79c6>`</span>[COMMAND] [ARG ...]<span style=color:#ff79c6>`</span> <span style=color:#ff79c6>-</span> Depending <span style=color:#ff79c6>on</span> the images, <span style=color:#ff79c6>`</span>COMMAND<span style=color:#ff79c6>`</span> <span style=color:#ff79c6>and</span> <span style=color:#ff79c6>`</span>ARG<span style=color:#ff79c6>`</span>s will be used either <span style=color:#ff79c6>as</span> arguments <span style=color:#ff79c6>or</span> <span style=color:#ff79c6>as</span> the command <span style=color:#ff79c6>+</span> arguments <span style=color:#ff79c6>by</span> the so called <span style=color:#f1fa8c>&#34;entrypoint&#34;</span> of the container.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>I<span style=color:#f1fa8c>&#39;m going in depth about image names, command args and entrypoint later on in [&#34;Understanding Dockerfiles&#34;](#Understanding-Dockerfiles).
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>### Starting the MariaDB database server
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>We are going to use the &#34;official&#34; MariaDB Container image from the Docker Hub.
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>So we will now specify that image as the `IMAGE` argument in our `docker run` command now:
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>```console
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>docker run \
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>    mariadb:10.4.3-bionic
</span></span></span></code></pre></div><p>When running this command the first time, Docker will pull the image from the Docker Hub and then create the container from it.
But as we have not given any configuration details for it, the &ldquo;entrypoint&rdquo; script exits with an error telling us that we need to specify certain environment variables.
The &ldquo;entrypoint&rdquo; script is the &ldquo;first&rdquo; thing to be executed when the container is started, which happens automatically when using <code>docker run</code>.</p><p>The output should look something like this:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span>$ docker run <span style=color:#f1fa8c>\
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c></span><span style=color:#44475a>   mariadb:10.4.3-bionic
</span></span></span><span style=display:flex><span><span style=color:#44475a>Unable to find image &#39;mariadb:10.4.3-bionic&#39; locally
</span></span></span><span style=display:flex><span><span style=color:#44475a>10.4.3-bionic: Pulling from library/mariadb
</span></span></span><span style=display:flex><span><span style=color:#44475a>898c46f3b1a1: Pull complete
</span></span></span><span style=display:flex><span><span style=color:#44475a>63366dfa0a50: Pull complete
</span></span></span><span style=display:flex><span><span style=color:#44475a>041d4cd74a92: Pull complete
</span></span></span><span style=display:flex><span><span style=color:#44475a>6e1bee0f8701: Pull complete
</span></span></span><span style=display:flex><span><span style=color:#44475a>0fa9bfc0c84b: Pull complete
</span></span></span><span style=display:flex><span><span style=color:#44475a>8e9b088fe106: Pull complete
</span></span></span><span style=display:flex><span><span style=color:#44475a>af96bccda5c4: Pull complete
</span></span></span><span style=display:flex><span><span style=color:#44475a>0655ee57b408: Pull complete
</span></span></span><span style=display:flex><span><span style=color:#44475a>58e50a9049b1: Pull complete
</span></span></span><span style=display:flex><span><span style=color:#44475a>57cd7839e491: Pull complete
</span></span></span><span style=display:flex><span><span style=color:#44475a>23d8b0c94134: Pull complete
</span></span></span><span style=display:flex><span><span style=color:#44475a>4aaa8cd60ac7: Pull complete
</span></span></span><span style=display:flex><span><span style=color:#44475a>052f0d0b139f: Pull complete
</span></span></span><span style=display:flex><span><span style=color:#44475a>78d717e43484: Pull complete
</span></span></span><span style=display:flex><span><span style=color:#44475a>Digest: sha256:fb69aaa343a69826d4fb00809b8eb340a660cec3651a946dfd87f2113e0af627
</span></span></span><span style=display:flex><span><span style=color:#44475a>Status: Downloaded newer image for mariadb:10.4.3-bionic
</span></span></span><span style=display:flex><span><span style=color:#44475a>error: database is uninitialized and password option is not specified
</span></span></span><span style=display:flex><span><span style=color:#44475a>  You need to specify one of MYSQL_ROOT_PASSWORD, MYSQL_ALLOW_EMPTY_PASSWORD and MYSQL_RANDOM_ROOT_PASSWORD
</span></span></span></code></pre></div><p>What is the container named? Can the Docker daemon read our mind and has already named <code>database</code>? A random name is given to the container, and thankfully no.
When a container is started and no name is given, it will receive a randomly generated name. It is an actual name and not just some bits and bytes mashed in a mixer, that would be the container id.</p><p>In the <a href=#basic-commands-you-need-to-know>Basic commands you need to know</a> section we have learned about the <code>docker ps</code> command. Now we are going to use it to learn more about it and get the name and id of the first try at a <code>mariadb</code> container.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span>$ docker ps
</span></span><span style=display:flex><span><span style=color:#44475a>CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES
</span></span></span></code></pre></div><p>What&rsquo;s that? No container in the list of running containers. Due to the missing configuration as seen in the above logs the container is not running anymore and has terminated itself.
The <code>docker ps</code> command has a flag called <code>-a</code> which will show us all container, even those not running anymore:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span>$ docker ps -a
</span></span><span style=display:flex><span><span style=color:#44475a>CONTAINER ID        IMAGE                   COMMAND                  CREATED              STATUS                          PORTS               NAMES
</span></span></span><span style=display:flex><span><span style=color:#44475a>7864ef7db36a        mariadb:10.4.3-bionic   &#34;docker-entrypoint.s…&#34;   About a minute ago   Exited (1) About a minute ago                       recursing_bell
</span></span></span></code></pre></div><p>In this case the container (short) ID is <code>7864ef7db36a</code> and the generated name is <code>recursing_bell</code>, to change that so that we can target the container more easily we are going to give the container a name in the next section.</p><h4 id=lets-give-the-container-a-name-before-continuing>Let&rsquo;s give the container a name before continuing</h4><figure itemprop=associatedMedia itemscope itemtype=http://schema.org/ImageObject><a href=hello_my_name_is_docker_container_sticker.png itemprop=contentUrl><img itemprop=thumbnail src=hello_my_name_is_docker_container_sticker.png width=475px></a><figcaption><h4>Hello my name is: Mr. Docker, Container</h4></figcaption></figure><p>(Original image taken from <a href=https://commons.wikimedia.org/wiki/File:Hello_my_name_is_sticker.svg>https://commons.wikimedia.org/wiki/File:Hello_my_name_is_sticker.svg</a>)</p><p>Our MariaDB database server container should have a name, right? When not specifying a name for the container it will get a randomized name.
Every container gets an unique ID and randomized name. We can set / override the name with the <code>--name=NAME</code> flag.
Let&rsquo;s name it &ldquo;database&rdquo;.</p><p>Before running the command again, let&rsquo;s first add a name to the container and add some configuration to it. The configuration part will be done in the next section though.</p><p>Adding a name to a container is as simple as adding another flag to the <code>docker run</code> command, example:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span><span style=color:#44475a>docker run \
</span></span></span><span style=display:flex><span><span style=color:#44475a>    --name=database \
</span></span></span><span style=display:flex><span><span style=color:#44475a>    mariadb:10.4.3-bionic
</span></span></span></code></pre></div><p>This gives the container the name <code>database</code>, which makes it easier to target the container and simplifies later processes, like connecting from the upcoming WordPress container to the MariaDB database server container.</p><h4 id=how-would-one-configure-the-mariadb-database-server-container>How would one configure the MariaDB database server container?</h4><p>One big questions will be for you, &ldquo;How can I configure the MariaDB database server?&rdquo; in the container.</p><p>You can..
<strong>A)</strong> use config files
or
<strong>B)</strong> use environment variables (portable and the best way).</p><p>The most portable way is to use environment variables.
Most containers that are configured through environment variables, have a script, the entrypoint, that sets config variables and a lot more, before the main application / program is started.</p><p>In the case of the <code>mariadb</code> container image the following environment variables are available for configuration:</p><ul><li><code>MYSQL_USER</code> - Database User to create. User will be given access to the database(s) from <code>MYSQL_DATABASE</code>.</li><li><code>MYSQL_PASSWORD</code> - Password for the given database user.</li><li><code>MYSQL_DATABASE</code> - Database to create and gain access to the username given in <code>MYSQL_USER</code>.</li><li><code>MYSQL_ROOT_PASSWORD</code> - Root user password for database server.</li><li><code>MYSQL_ROOT_HOST</code> - Root user allowed host (range) for database server.</li><li>And more to configure the database more granular..</li></ul><p>To specify an environment variable, the <code>--env</code> (or <code>-e</code> short form) flag can be used:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span><span style=color:#44475a>docker run \
</span></span></span><span style=display:flex><span><span style=color:#44475a>[...]
</span></span></span><span style=display:flex><span><span style=color:#44475a>    --env &#39;MYSQL_USER=wordpress&#39; \
</span></span></span><span style=display:flex><span><span style=color:#44475a>    -e &#39;MYSQL_PASSWORD=wordpress&#39; \
</span></span></span><span style=display:flex><span><span style=color:#44475a>    -e &#39;MYSQL_DATABASE=wordpress&#39; \
</span></span></span><span style=display:flex><span><span style=color:#44475a>    -e &#39;MYSQL_ROOT_PASSWORD=secure_password&#39; \
</span></span></span><span style=display:flex><span><span style=color:#44475a>    -e &#39;MYSQL_ROOT_HOST=%&#39; \
</span></span></span><span style=display:flex><span><span style=color:#44475a>[...]
</span></span></span></code></pre></div><p><em>*sarcasm on* 100% secure passwords used here *sarcasm off*</em></p><blockquote><p>Use secure passwords when running in production!
<code>openssl rand -base64 64</code>, can be used to generate a &ldquo;secure&rdquo; passwords.</p></blockquote><h4 id=does-the-container-keep-on-running-or-do-i-need-something-like-screen-or-what>Does the container keep on running or do I need something like screen or what?!</h4><p>If you run the command to start the container, upon start you see some log output coming, but should notice that when closing the terminal, the database container will be immediately stopped (run <code>docker ps -a</code> to see all containers).
When you <code>docker run</code> a container, by default your current <code>stdin</code> and <code>stdout</code> will be attached to the container, making it &ldquo;interactive&rdquo; (If you want an interactive container, you should still add <code>--interactive</code> flag, so it is clear from that).
If you want as for most applications, like database, web, cache and so on server application, you can disable the attachment of <code>stdin</code> and <code>stdout</code> by adding the <code>--detach</code> (or short <code>-d</code>) flag to the command. To view logs of the detached container you can normally use <code>docker logs CONTAINER_NAME_OR_ID</code>.</p><p>Have you already run into errors where Docker is telling you that a container with the same exists? You need to delete exited / stopped containers with the <code>docker rm CONTAINER_NAME_OR_ID</code> command (where <code>CONTAINER_NAME_OR_ID</code> would be, is the name or ID of the container, e.g., <code>database</code>), this &ldquo;clears&rdquo; their name and removes the container.</p><p>The command to delete the container named <code>database</code> is like this:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span>$ docker rm database
</span></span><span style=display:flex><span><span style=color:#44475a>database
</span></span></span></code></pre></div><blockquote><p><strong>NOTE</strong></p><p>On success it will print out the name of the container(s) stopped.</p></blockquote><h4 id=how-do-i-save-the-database-data-outside-the-container>How do I save the database data outside the container?</h4><p>You want to save your data outside of the container, for a simple reason: If you stop and delete the container, your data is gone. For this Docker has volumes.
A Volume is like a mount from the host system inside the container.
The volume flag is <code>--volume</code> (or <code>-v</code>). The syntax of the volume flag is for example:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span><span style=color:#44475a>docker run \
</span></span></span><span style=display:flex><span><span style=color:#44475a>[...]
</span></span></span><span style=display:flex><span><span style=color:#44475a>    -v HOST_PATH:CONTAINER_PATH:MODE \
</span></span></span><span style=display:flex><span><span style=color:#44475a>[...]
</span></span></span></code></pre></div><blockquote><p><strong>WDWD</strong></p></blockquote><ul><li><code>HOST_PATH</code> - Path to mount from the host system inside the container.</li><li><code>CONTAINER_PATH</code> - &ldquo;Mount&rdquo; destination path in the container.</li><li><code>:MODE</code> - Optional. Can be <code>rw</code> (read-write), <code>ro</code> (read-only), <code>z</code> / <code>Z</code> cause files to be SELinux relabeled on the path. Default is <code>rw</code>.</li></ul><blockquote><p><strong>NOTE</strong></p></blockquote><ul><li>If the host path doesn&rsquo;t exist it&rsquo;ll get created.</li><li>The host path can be a file too.</li><li>Docker doesn&rsquo;t distinguish between file or folder. If the path doesn&rsquo;t exist, a directory always get&rsquo;s created.</li></ul><h4 id=running-the-mariadb-database-server-container>Running the MariaDB database server container</h4><p>Now we have all components, we need for running the MariaDB container.</p><p>When we have put everything we learned now together, we should get something that looks like this:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span><span style=color:#44475a>docker run \
</span></span></span><span style=display:flex><span><span style=color:#44475a>    -d \
</span></span></span><span style=display:flex><span><span style=color:#44475a>    --name=database \
</span></span></span><span style=display:flex><span><span style=color:#44475a>    -e &#39;MYSQL_USER=wordpress&#39; \
</span></span></span><span style=display:flex><span><span style=color:#44475a>    -e &#39;MYSQL_PASSWORD=wordpress&#39; \
</span></span></span><span style=display:flex><span><span style=color:#44475a>    -e &#39;MYSQL_DATABASE=wordpress&#39; \
</span></span></span><span style=display:flex><span><span style=color:#44475a>    -e &#39;MYSQL_ROOT_PASSWORD=secure_password&#39; \
</span></span></span><span style=display:flex><span><span style=color:#44475a>    -e &#39;MYSQL_ROOT_HOST=%&#39; \
</span></span></span><span style=display:flex><span><span style=color:#44475a>    -v /opt/docker/wordpress/mysql:/var/lib/mysql \
</span></span></span><span style=display:flex><span><span style=color:#44475a>    mariadb:10.4.3-bionic
</span></span></span></code></pre></div><blockquote><p><strong>WDWD</strong></p></blockquote><ul><li><code>-d</code> - To run the container detached.</li><li><code>--name=wordpress</code> - Gives the container the name &ldquo;wordpress&rdquo;.</li><li><code>-e ...=...</code> - Specify each an environment variables to be added to the container, as seen in <a href=#how-would-one-configure-the-mariadb-database-server-container>How would one configure the MariaDB database server container?</a>.</li><li><code>-v /opt/docker/wordpress/mysql:/var/lib/mysql</code> - Mount <code>/opt/docker/wordpress/mysql</code> directory of the host to inside the container at <code>/var/lib/mysql</code>.</li><li><code>mariadb:10.4.3-bionic</code> - Specifies what image to use.</li></ul><p>If you run the run command with the <code>--detach</code> (or <code>-d</code>), it&rsquo;ll just return the unique (long) ID of the container.
With <code>docker logs CONTAINER</code> (where <code>CONTAINER</code> is a container ID or name), you&rsquo;ll get the logs of the first process in the container.</p><h3 id=how-do-you-execute-a-command--get-a-shell-inside-a-container>How do you execute a command / get a shell inside a container?</h3><p>Let&rsquo;s check the MariaDB server if the wanted <code>wordpress</code> database has been created. For that we need to execute a command inside the <code>database</code> container.</p><p>To execute a command inside a container, for example in the MariaDB <code>database</code> container for, e.g., maintenance access.</p><p>The following <code>mysql</code> command will execute the <code>SHOW DATAbASE</code> query which lists the existing databases:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span><span style=color:#44475a>mysql -u root -p -e &#34;SHOW DATABASES;&#34;
</span></span></span></code></pre></div><p>The command <code>docker exec</code> can be used to execute a separate command inside a container.</p><p>Running <code>docker exec --help</code> will shows the help menu:</p><blockquote><p><strong>EXAMPLE</strong></p></blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span>$ docker <span style=color:#8be9fd;font-style:italic>exec</span> --help
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#44475a>Usage:	docker exec [OPTIONS] CONTAINER COMMAND [ARG...]
</span></span></span><span style=display:flex><span><span style=color:#44475a></span>
</span></span><span style=display:flex><span><span style=color:#44475a>Run a command in a running container
</span></span></span><span style=display:flex><span><span style=color:#44475a></span>
</span></span><span style=display:flex><span><span style=color:#44475a>Options:
</span></span></span><span style=display:flex><span><span style=color:#44475a>  -d, --detach               Detached mode: run command in the background
</span></span></span><span style=display:flex><span><span style=color:#44475a>      --detach-keys string   Override the key sequence for detaching a container
</span></span></span><span style=display:flex><span><span style=color:#44475a>  -e, --env list             Set environment variables
</span></span></span><span style=display:flex><span><span style=color:#44475a>  -i, --interactive          Keep STDIN open even if not attached
</span></span></span><span style=display:flex><span><span style=color:#44475a>      --privileged           Give extended privileges to the command
</span></span></span><span style=display:flex><span><span style=color:#44475a>  -t, --tty                  Allocate a pseudo-TTY
</span></span></span><span style=display:flex><span><span style=color:#44475a>  -u, --user string          Username or UID (format: &lt;name|uid&gt;[:&lt;group|gid&gt;])
</span></span></span><span style=display:flex><span><span style=color:#44475a>  -w, --workdir string       Working directory inside the container
</span></span></span></code></pre></div><p>To run a command interactively for example opening an interactive MariaDB shell session, the command would be:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span><span style=color:#44475a>docker exec \
</span></span></span><span style=display:flex><span><span style=color:#44475a>    -it \
</span></span></span><span style=display:flex><span><span style=color:#44475a>    CONTAINER \
</span></span></span><span style=display:flex><span><span style=color:#44475a>    mysql -u root -p -e &#34;SHOW DATABASES;&#34;
</span></span></span></code></pre></div><blockquote><p><strong>WDWD</strong></p></blockquote><ul><li><code>-i</code> - Attach the stdin aka &ldquo;interactive mode&rdquo;.</li><li><code>-t</code> - Optional. Allocate a pseudo-TTY (pseudo TeleTYpewriter) to the shell / command run.</li><li><code>CONTAINER</code> - Container ID or name of the container the command should be executed in.</li><li><code>mysql -u root -p</code> - The command and arguments for the command to execute inside the container.</li></ul><p>You can also use the <code>--detach</code> (or <code>-d</code>) option to exec the command non-interactively inside the container with no logs or exit code).</p><p>When running the above <code>docker exec</code> command, be sure to enter the MySQL <code>root</code> user password when prompted for it.</p><blockquote><p><strong>NOTE</strong></p><p>To be able to run a command in the container, the command / binary / file has to exist in the container! Also to note that when the command / binary is not in the containers <code>PATH</code>, you must give the full absolute path to it.</p></blockquote><h3 id=summary-of-what-we-did-so-far>Summary of what we did so far</h3><p>We now have a MariaDB 10.4.3 container running which is configured to create a database named <code>wordpress</code> with a user named <code>wordpress</code> and password <code>wordpress</code>.</p><p>Now we are going to move on to create the WordPress container which will use the database container.</p><hr><h3 id=starting-the-wordpress-container>Starting the WordPress container</h3><p>So you now already know some &ldquo;basics&rdquo;, about starting containers. I&rsquo;m not going in depth with every little thing anymore.</p><h4 id=how-can-the-wordpress-container-and-the-mariadb-container-communicate-with-each-other>How can the WordPress container and the MariaDB container communicate with each other?</h4><figure itemprop=associatedMedia itemscope itemtype=http://schema.org/ImageObject><a href=cat5-cat6-internet-807540.png itemprop=contentUrl><img itemprop=thumbnail src=cat5-cat6-internet-807540.png width=650px></a><figcaption><h4>Got network communication for your containers?</h4></figcaption></figure><p>(Original photo taken from <a href=https://www.pexels.com/photo/cat5-cat6-internet-network-807540/>pexels.com</a> Free stock photo site)</p><p>In Docker in general by default all containers can talk to each other, if they know the IP address.</p><blockquote><p><strong>NOTE</strong> There is an option for the Docker daemon that is called <code>Inter Container Communication</code> (<code>ICC</code>) <code>--icc=[true/false]</code>, default <code>true</code>, but disabling this may have other implications than just stopping ICC communication too.</p></blockquote><p>So now to make sure the WordPress container can talk to the MariaDB container, we could use the IP address of the MariaDB container. To get the IP address of the container we can use <code>docker inspect CONTAINER_OR_IMAGE</code> (where <code>CONTAINER_OR_IMAGE</code> is the unique ID or name of the container). <code>docker inspect</code> command will return a JSON output with &ldquo;all&rdquo; informations about the given container(s), but is also working for Docker containers image(s) (<code>docker images</code>).</p><p>But it would be too much work to keep the IP address up to date, when the container gets a new IP address! That is where the &ldquo;Docker Networking&rdquo; feature comes into play.</p><p>So to be able to use this Docker Networking feature, we need to create a network for the application containers.
This can be done using <code>docker network create</code> command:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span><span style=color:#44475a>docker network \
</span></span></span><span style=display:flex><span><span style=color:#44475a>    create \
</span></span></span><span style=display:flex><span><span style=color:#44475a>    [OPTIONS] \
</span></span></span><span style=display:flex><span><span style=color:#44475a>    [NETWORK_NAME]
</span></span></span></code></pre></div><blockquote><p><strong>WDWD</strong></p></blockquote><ul><li><code>OPTIONS</code> - Options for the <code>docker network create</code> command.</li><li><code>NETWORK_NAME</code> - The name of the network to be created.</li></ul><p>Running the following command, will create a new network in Docker which means there is a new network device on the server created too:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span><span style=color:#44475a>docker network \
</span></span></span><span style=display:flex><span><span style=color:#44475a>    create \
</span></span></span><span style=display:flex><span><span style=color:#44475a>    wordpress
</span></span></span></code></pre></div><p>This new network device can be seen in the output below:</p><blockquote><p><strong>EXAMPLE</strong></p></blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span>$ docker network create wordpress
</span></span><span style=display:flex><span><span style=color:#44475a>4cc4efd905ff369efdf691dfe9d20c7c55775e628ccb57cc3fdac499785ea05b
</span></span></span><span style=display:flex><span><span style=color:#44475a></span>$ ip addr show
</span></span><span style=display:flex><span><span style=color:#44475a>1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000
</span></span></span><span style=display:flex><span><span style=color:#44475a>    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
</span></span></span><span style=display:flex><span><span style=color:#44475a>    inet 127.0.0.1/8 scope host lo
</span></span></span><span style=display:flex><span><span style=color:#44475a>       valid_lft forever preferred_lft forever
</span></span></span><span style=display:flex><span><span style=color:#44475a>    inet6 ::1/128 scope host
</span></span></span><span style=display:flex><span><span style=color:#44475a>       valid_lft forever preferred_lft forever
</span></span></span><span style=display:flex><span><span style=color:#44475a>2: enp4s0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc fq_codel state UP group default qlen 1000
</span></span></span><span style=display:flex><span><span style=color:#44475a>[...]
</span></span></span><span style=display:flex><span><span style=color:#44475a>3: docker0: &lt;NO-CARRIER,BROADCAST,MULTICAST,UP&gt; mtu 1500 qdisc noqueue state DOWN group default
</span></span></span><span style=display:flex><span><span style=color:#44475a>    link/ether 02:42:d1:cc:07:47 brd ff:ff:ff:ff:ff:ff
</span></span></span><span style=display:flex><span><span style=color:#44475a>    inet 172.17.0.1/16 brd 172.17.255.255 scope global docker0
</span></span></span><span style=display:flex><span><span style=color:#44475a>       valid_lft forever preferred_lft forever
</span></span></span><span style=display:flex><span><span style=color:#44475a>    inet6 fe80::42:d1ff:fecc:747/64 scope link
</span></span></span><span style=display:flex><span><span style=color:#44475a>       valid_lft forever preferred_lft forever
</span></span></span><span style=display:flex><span><span style=color:#44475a>4: br-4cc4efd905ff: &lt;NO-CARRIER,BROADCAST,MULTICAST,UP&gt; mtu 1500 qdisc noqueue state DOWN group default
</span></span></span><span style=display:flex><span><span style=color:#44475a>    link/ether 02:42:90:e4:8d:a1 brd ff:ff:ff:ff:ff:ff
</span></span></span><span style=display:flex><span><span style=color:#44475a>    inet 172.18.0.1/16 brd 172.18.255.255 scope global br-4cc4efd905ff
</span></span></span><span style=display:flex><span><span style=color:#44475a>       valid_lft forever preferred_lft forever
</span></span></span></code></pre></div><h4 id=network---resolvconf-and-hostnames>Network - <code>resolv.conf</code> and hostnames</h4><p>As we are talking about network, let&rsquo;s take a quick look at the <code>resolv.conf</code> and hostnames.
Running the following commands will show you the <code>resolv.conf</code> and hostname of the container (output below the <strong>WDWD</strong> explanation):</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span>$ docker run <span style=color:#f1fa8c>\
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c></span><span style=color:#44475a>    -it \
</span></span></span><span style=display:flex><span><span style=color:#44475a>    --rm \
</span></span></span><span style=display:flex><span><span style=color:#44475a>    --entrypoint=/bin/bash \
</span></span></span><span style=display:flex><span><span style=color:#44475a>    wordpress:5.1-php7.1-apache
</span></span></span><span style=display:flex><span><span style=color:#44475a></span>$ hostname
</span></span><span style=display:flex><span>$ cat /etc/hosts
</span></span><span style=display:flex><span>$ <span style=color:#8be9fd;font-style:italic>exit</span>
</span></span><span style=display:flex><span># The <span style=color:#f1fa8c>`</span>--rm<span style=color:#f1fa8c>`</span> flag takes care of removing the container <span style=color:#ff79c6>then</span>, so no need to manually delete the container
</span></span></code></pre></div><blockquote><p><strong>WDWD</strong></p><ul><li><code>--rm</code> - Causes the container to be deleted when stopped / exited.</li><li><code>--entrypoint=/bin/bash</code> - This overwrites the command executed (as proccess number #1 in the container), when the container is started.</li></ul></blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span>$ docker run <span style=color:#f1fa8c>\
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c></span><span style=color:#44475a>    -it \
</span></span></span><span style=display:flex><span><span style=color:#44475a>    --rm \
</span></span></span><span style=display:flex><span><span style=color:#44475a>    --entrypoint=/bin/bash \
</span></span></span><span style=display:flex><span><span style=color:#44475a>    wordpress:5.1-php7.1-apache
</span></span></span><span style=display:flex><span><span style=color:#44475a>root@7c329dddc849:/var/www/html# hostname
</span></span></span><span style=display:flex><span><span style=color:#44475a>7c329dddc849
</span></span></span></code></pre></div><p>Every container is getting a random hostname, you can override the hostname of a container using the <code>--hostname=HOSTNAME</code> flag for <code>docker run</code> / <code>docker create</code>. As a general note your application should try to not rely on the hostname too much, that can also be important for later on with Kubernetes.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span><span style=color:#44475a>root@7c329dddc849:/var/www/html# cat /etc/resolv.conf
</span></span></span><span style=display:flex><span><span style=color:#44475a></span># Generated by NetworkManager
</span></span><span style=display:flex><span><span style=color:#44475a>search lan
</span></span></span><span style=display:flex><span><span style=color:#44475a>nameserver 172.16.1.1
</span></span></span></code></pre></div><p>The <code>resolv.conf</code> is partially passed through from the host system. Meaning that in this example <code>172.16.1.1</code> is the address of the local nameserver I&rsquo;m using (<code>172.16.1.1/24</code> is the network range the host is in).</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span><span style=color:#44475a>root@7c329dddc849:/var/www/html# cat /etc/hosts
</span></span></span><span style=display:flex><span><span style=color:#44475a>127.0.0.1	localhost
</span></span></span><span style=display:flex><span><span style=color:#44475a>::1	localhost ip6-localhost ip6-loopback
</span></span></span><span style=display:flex><span><span style=color:#44475a>fe00::0	ip6-localnet
</span></span></span><span style=display:flex><span><span style=color:#44475a>ff00::0	ip6-mcastprefix
</span></span></span><span style=display:flex><span><span style=color:#44475a>ff02::1	ip6-allnodes
</span></span></span><span style=display:flex><span><span style=color:#44475a>ff02::2	ip6-allrouters
</span></span></span><span style=display:flex><span><span style=color:#44475a>172.17.0.3	7c329dddc849
</span></span></span><span style=display:flex><span><span style=color:#44475a>root@7c329dddc849:/var/www/html# exit
</span></span></span></code></pre></div><p>The <code>/etc/hosts</code> file is generated per container and has the hostname of the container as an entry in it. As we can see the hostname does not resolve to <code>127.0.0.1</code>, where everyone feels at home, but to the IP of the container (depending on who you ask this is good or bad, to be left uncommented).</p><h4 id=lets-connect-the-database-container-to-the-wordpress-network>Let&rsquo;s connect the database container to the <code>wordpress</code> network</h4><p>There are two choices to connect the database container to the <code>wordpress</code> network:</p><ul><li>Stop, delete and create the database container again but now with the <code>--net=wordpress</code> flag added to the <code>docker run</code> command:</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span><span style=color:#44475a>docker run \
</span></span></span><span style=display:flex><span><span style=color:#44475a>    -d \
</span></span></span><span style=display:flex><span><span style=color:#44475a>    --net=wordpress \
</span></span></span><span style=display:flex><span><span style=color:#44475a>    --name=database \
</span></span></span><span style=display:flex><span><span style=color:#44475a>    -e &#39;MYSQL_ROOT_PASSWORD=secure_password&#39; \
</span></span></span><span style=display:flex><span><span style=color:#44475a>    -e &#39;MYSQL_USER=wordpress&#39; \
</span></span></span><span style=display:flex><span><span style=color:#44475a>    -e &#39;MYSQL_PASSWORD=wordpress&#39; \
</span></span></span><span style=display:flex><span><span style=color:#44475a>    -e &#39;MYSQL_DATABASE=wordpress&#39; \
</span></span></span><span style=display:flex><span><span style=color:#44475a>    -v /opt/docker/wordpress/mysql:/var/lib/mysql \
</span></span></span><span style=display:flex><span><span style=color:#44475a>    mariadb:10.4.3-bionic
</span></span></span></code></pre></div><ul><li>Use the <code>docker network connect</code> command:</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span><span style=color:#44475a>docker network connect [NETWORK_NAME] [CONTAINER_NAME]
</span></span></span></code></pre></div><p>In this case that would be:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span><span style=color:#44475a>docker network connect wordpress database
</span></span></span></code></pre></div><p>The command connects the <code>database</code> container to the <code>wordpress</code> network, that we previously created.</p><p>Now that the <code>database</code> container is in the <code>wordpress</code> network, we can go ahead and begin to start the WordPress instance.</p><h4 id=running-the-wordpress-container>Running the WordPress container</h4><p>To configure our WordPress container, the Container image comes with extra environment variables.
The WordPress container image name is <code>wordpress</code> (<a href=https://hub.docker.com/_/wordpress/>Docker Hub - WordPress Image</a>) and the tag for now is <code>5.1-php7.1-apache</code>.</p><p>The possible environment variables for the configuration are the following ones:</p><ul><li><code>WORDPRESS_DB_HOST=...</code> - Set to <code>database</code> so it will connect to the <code>database</code> container.</li><li><code>WORDPRESS_DB_USER=...</code> - Set to <code>wordpress</code> as we have configured the <code>database</code> container to create a user with name <code>wordpress</code>.</li><li><code>WORDPRESS_DB_PASSWORD=...</code> - Set to <code>wordpress</code> as we have configured the <code>database</code> container to create the <code>wordpress</code> user with password <code>wordpress</code>.</li><li><code>WORDPRESS_MYSQL_DATABASE=...</code> - Set to <code>wordpress</code> as we have configured the <code>database</code> container to create a database <code>wordpress</code> for the <code>wordpress</code> user.</li><li><code>WORDPRESS_AUTH_KEY=...</code>, <code>WORDPRESS_SECURE_AUTH_KEY=...</code>, <code>WORDPRESS_LOGGED_IN_KEY=...</code>, <code>WORDPRESS_NONCE_KEY=...</code>, <code>WORDPRESS_AUTH_SALT=...</code>, <code>WORDPRESS_SECURE_AUTH_SALT=...</code>, <code>WORDPRESS_LOGGED_IN_SALT</code> - These need to be set to a secure random value; in production use different random values per variable.</li><li>And other ones which are &ldquo;optional&rdquo; in regards to getting the WordPress container up&rsquo;n&rsquo;running.</li></ul><p>The command to run the WordPress container should look like this now:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span><span style=color:#44475a>docker run \
</span></span></span><span style=display:flex><span><span style=color:#44475a>    -d \
</span></span></span><span style=display:flex><span><span style=color:#44475a>    --net=wordpress \
</span></span></span><span style=display:flex><span><span style=color:#44475a>    --name=wordpress \
</span></span></span><span style=display:flex><span><span style=color:#44475a>    -e &#39;WORDPRESS_DB_HOST=database&#39; \
</span></span></span><span style=display:flex><span><span style=color:#44475a>    -e &#39;WORDPRESS_DB_USER=wordpress&#39; \
</span></span></span><span style=display:flex><span><span style=color:#44475a>    -e &#39;WORDPRESS_DB_PASSWORD=wordpress&#39; \
</span></span></span><span style=display:flex><span><span style=color:#44475a>    -e &#39;WORDPRESS_AUTH_KEY=wordpress&#39; \
</span></span></span><span style=display:flex><span><span style=color:#44475a>    -e &#39;WORDPRESS_SECURE_AUTH_KEY=wordpress&#39; \
</span></span></span><span style=display:flex><span><span style=color:#44475a>    -e &#39;WORDPRESS_LOGGED_IN_KEY=wordpress&#39; \
</span></span></span><span style=display:flex><span><span style=color:#44475a>    -e &#39;WORDPRESS_NONCE_KEY=wordpress&#39; \
</span></span></span><span style=display:flex><span><span style=color:#44475a>    -e &#39;WORDPRESS_AUTH_SALT=wordpress&#39; \
</span></span></span><span style=display:flex><span><span style=color:#44475a>    -e &#39;WORDPRESS_SECURE_AUTH_SALT=wordpress&#39; \
</span></span></span><span style=display:flex><span><span style=color:#44475a>    -e &#39;WORDPRESS_LOGGED_IN_SALT=wordpress&#39; \
</span></span></span><span style=display:flex><span><span style=color:#44475a>    -p 80:80 \
</span></span></span><span style=display:flex><span><span style=color:#44475a>    wordpress:5.1-php7.1-apache
</span></span></span></code></pre></div><blockquote><p><strong>WDWD</strong></p><ul><li><code>-d</code> - To run the container detached.</li><li><code>--net=wordpress</code> - Put the container inside the <code>wordpress</code> network, we created earlier.</li><li><code>--name=wordpress</code> - Gives the container the name <code>wordpress</code>.</li><li><code>-e ...=...</code> - Specifies environment variables, that are used for configuration.</li><li><code>wordpress:5.1-php7.1-apache</code> - Specifies what image to use.</li></ul></blockquote><p>Now execute the command and you should be able to see the WordPress installation screen at <code>http://IP_ADDRESS_OF_THE_SERVER:80</code>.</p><blockquote><p><strong>NOTE</strong></p><p>All data inside the container, will be lost on removal of the container! In our case, we already use volumes, so don&rsquo;t worry.</p></blockquote><p>For cleanup you now stop and delete the containers.</p><p>To stop the <code>wordpress</code> , run <code>docker stop CONTAINER</code> (where <code>CONTAINER</code> in this case is <code>wordpress</code>). After stopping the container, you can remove it with <code>docker rm CONTAINER</code>.
The container has to be stopped, before it can be removed.</p><h4 id=how-can-the-wordpress-container-be-reached-from-the-outside-world-now>How can the WordPress container be reached from the outside world now?</h4><p>Right now it can&rsquo;t but we can change this by making the webserver port (<code>80</code>) available to the &ldquo;public&rdquo;, by publishing / exposing the port(s).
That is what the <code>--publish</code> (or <code>-p</code>) flag is used for, in this format:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span><span style=color:#44475a>docker run \
</span></span></span><span style=display:flex><span><span style=color:#44475a>[OTHER_OPTIONS] \
</span></span></span><span style=display:flex><span><span style=color:#44475a></span>#   -p HOST_ADDRESS:HOST_PORT:CONTAINER_PORT/PROTOCOL
</span></span><span style=display:flex><span><span style=color:#44475a>    -p 80:80/tcp \
</span></span></span><span style=display:flex><span><span style=color:#44475a>[...]
</span></span></span></code></pre></div><blockquote><p><strong>WDWD</strong></p><ul><li><code>HOST_ADDRESS:</code> - Optional. By default <code>0.0.0.0</code>. Address to expose the port on the host system.</li><li><code>HOST_PORT</code> - Host port to expose the container port on.</li><li><code>CONTAINER_PORT</code> - Container port to expose.</li><li><code>/PROTOCOL</code> - Optional. By default <code>tcp</code>. The port protocol, currently can be <code>tcp</code> or <code>udp</code>.</li></ul></blockquote><p>And that&rsquo;s how you forward / publish ports from the container to the outside.</p><h2 id=summary-of-what-we-did-so-far-1>Summary of what we did so far</h2><p>You should now be able to list containers, start up container, create a network for your containers and be able to access them from the &ldquo;outside&rdquo;.</p><p>Please make sure to stop and / or remove stopped / terminated containers.</p><p>Now that we looked into some of most important beginner topics of Docker, we are going to take a look deeper into these topics.</p><hr><h2 id=data-data-everywhere>Data, Data everywhere!</h2><figure itemprop=associatedMedia itemscope itemtype=http://schema.org/ImageObject><a href=data-data-everywhere-meme.png itemprop=contentUrl><img itemprop=thumbnail src=data-data-everywhere-meme.png width=350px></a><figcaption><h4>Data Data everywhere! Meme - Made with Imgur Memegen</h4></figcaption></figure><h3 id=volumes-aka-mounts>Volumes aka Mounts</h3><p>Volumes add persistence to your data. When a container is stopped and removed, the data in the container is lost.
With a volume you would mount the part of the data out of the container. For example with our MariaDB container, we would mount the container path <code>/var/lib/mysql/</code> (contains the MariaDB databases) somewhere safe.
So if the MariaDB server inside the container should ever crash and the container then be terminated, you can just fire up with the <code>docker start</code> command or delete the container and execute the <code>docker run</code> command again. The MariaDB container then starts using the data where it exited.</p><p>I already showed the option, but here is it again (Long form <code>--volume=</code>):</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span><span style=color:#44475a>docker run \
</span></span></span><span style=display:flex><span><span style=color:#44475a>[OPTIONS]
</span></span></span><span style=display:flex><span><span style=color:#44475a>    -v HOST_PATH:CONTAINER_PATH:MODE
</span></span></span><span style=display:flex><span><span style=color:#44475a>[IMAGE] [ARGUMENTS]
</span></span></span></code></pre></div><blockquote><p><strong>WDWD</strong></p><ul><li><code>HOST_PATH</code> - Path to mount from the host system inside the container.</li><li><code>CONTAINER_PATH</code> - &ldquo;Mount&rdquo; destination path in the container.</li><li><code>:MODE</code> - Is optional. Can be <code>rw</code> (read-write) or <code>ro</code> (read-only). Defaults to <code>rw</code>.</li></ul><p><strong>TL;DR</strong></p><p><code>-v HOST_PATH:CONTAINER_PATH</code> allows you to store data from containers on the host.</p><p><strong>NOTE</strong></p><p>When the host path doesn&rsquo;t exist, it will be created. BUT the permissions will be a bit &ldquo;freaky&rdquo;, when the path get&rsquo;s created on the host, the directory will be (by default) owned by <code>root:root</code>, directory permissions <code>drwxr-xr-x</code>.</p></blockquote><h3 id=docker-volume-command><code>docker volume</code> command</h3><p>Docker nowadays also allows to create volumes for containers locally but also through available storage drivers.</p><p>Through plugins for the Docker Engine you can access multiple different storage systems / softwares.
A list of volume plugins can be found here: <a href=https://docs.docker.com/engine/extend/legacy_plugins/#volume-plugins>Docker Engine Documentation - Volume Plugins</a>.</p><p>This in general is pretty useful as the Docker engine takes care to provide a volume for your container(s), but in regards to the second day when we start to run Kubernetes we will see that Docker doesn&rsquo;t matter too much anymore with such features.</p><p>To mention it already there is a new interface for requesting / &ldquo;managing&rdquo; storage, which is named <strong>C</strong>ontainer <strong>S</strong>torage <strong>I</strong>nterface (CSI). The goal of CSI is to have an unified interface through which anyone can request storage. Mounting of the requested storage is done by the storage dependent CSI driver then.</p><h3 id=data-containers--aka---volumes-from-deprecated>Data containers aka <code>--volumes-from</code> (DEPRECATED)</h3><blockquote><p><strong>NOTE</strong></p><ul><li>I do NOT recommend this method as I often enough &ldquo;accidentally&rdquo; clear all exited / dead containers, so my disk space doesn&rsquo;t run out.</li><li>I also have cron jobs running on my servers, that clean exited containers. Meaning data containers would just get cleared out everytime.</li></ul></blockquote><p>You can store data inside another container, that&rsquo;s called data volume containers.
When creating an image, you can specify those volumes. You create a container that has a volume &ldquo;built-into&rdquo; (Specified while the image was built), meaning that assuming it is our MariaDB server image the in-built volume would be located at <code>/var/lib/mysql</code>
The data volume container runs &ldquo;nothing&rdquo;, it is just there for purpose of getting used by another container. For this you change the entrypoint with the following run option <code>--entrypoint=COMMAND</code> (where command could be just <code>/bin/true</code>) so the container stops and doesn&rsquo;t run the program it should.</p><p>Now that we would have a data container, we can use the volumes from this container using the <code>--volumes-from=CONTAINER</code> (where <code>CONTAINER</code> is a container name or ID) option.</p><p>Let&rsquo;s assume we have a data container, created from the example here, with the volume <code>/data</code> and we have a second container, running the same image, that would save the data to <code>/data</code>.
In this case using the <code>--volumes-from</code> option would write the data inside the first container, the data container.</p><p><strong>I personally don&rsquo;t recommend data container for data sharing, as I find it a bad practice to store data inside a ephemeral container.</strong></p><hr><h2 id=networking>Networking</h2><figure itemprop=associatedMedia itemscope itemtype=http://schema.org/ImageObject><a href=network-stuff-brace-yourself-meme.png itemprop=contentUrl><img itemprop=thumbnail src=network-stuff-brace-yourself-meme.png width=350px></a><figcaption><h4>Brace Yourself Network Stuff Incoming - Made using Imgur Memegen</h4></figcaption></figure><h3 id=nating-your-way-into-my-container>NATing your way into my container</h3><blockquote><p>I&rsquo;m not going to explain NAT in-depth here.</p></blockquote><p>Network Address Translation (NAT) allows multiple devices to sit behind the same IP address.</p><p>Docker creates <code>iptables</code> rules to allow traffic to the container.</p><h3 id=over-seven-bridges-you-must-go-docker0-bridge-and-veth-interfaces>Over seven bridges you must go (docker0 bridge and veth interfaces)</h3><p>By default Docker creates a bridge called <code>docker0</code>, that is used as a bridge to your &ldquo;normal&rdquo; network interface(s) (e.g., <code>eth0</code>, <code>en0</code>, etc).
The <code>docker0</code> bridge tries to find an unoccupied network range, mostly from the <code>172.17.0.1/16</code> IP range as a network. This IP address range will be used, to assign every container a separate IP.
Sometimes the bridge address range needs to be adjusted, even though Docker tries it&rsquo;s &ldquo;best&rdquo; to find a free IP range. In most cases when you are running Docker in a corporate network, get in touch with your network team to ask for a &ldquo;free range&rdquo;.</p><blockquote><p><strong>NOTE</strong></p><p>To manually override the Docker bridge address, you can add the <code>--bip=192.168.1.0/24</code> (where <code>192.168.1.0/24</code> is an unused IP range) to your Docker Daemon flags in the Systemd Unit file or through the &ldquo;config&rdquo; files, e.g., on Debian based systems <code>/etc/default/docker</code> or on RHEL based systems <code>/etc/sysconfig/docker</code> or <code>/etc/sysconfig/docker-network</code>.</p></blockquote><blockquote><p><strong>EXAMPLE</strong> <code>docker0</code> interface</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback></code></pre></div></blockquote><p>$ ip addr show docker0
4: docker0: &lt;NO-CARRIER,BROADCAST,MULTICAST,UP> mtu 1500 qdisc noqueue state DOWN group default
link/ether 02:42:d1:cc:07:47 brd ff:ff:ff:ff:ff:ff
inet 172.17.0.1/16 brd 172.17.255.255 scope global docker0
valid_lft forever preferred_lft forever
inet6 fe80::42:d1ff:fecc:747/64 scope link
valid_lft forever preferred_lft forever</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mysql data-lang=mysql><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>When</span> a container <span style=color:#ff79c6>is</span> created, a <span style=color:#ff79c6>`</span>veth<span style=color:#ff79c6>`</span> interface will be <span style=color:#50fa7b>created</span> (depending <span style=color:#ff79c6>on</span> the network mode, [next section](<span style=color:#6272a4>#network-modes-default-host-or-other)). The `veth` interface will have an unique name.
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span><span style=color:#ff79c6>`</span>veth<span style=color:#ff79c6>`</span> stands <span style=color:#ff79c6>for</span> virtual ethernet device <span style=color:#ff79c6>and</span> it will be connected <span style=color:#ff79c6>to</span> the <span style=color:#ff79c6>`</span>docker0<span style=color:#ff79c6>`</span> bridge, <span style=color:#ff79c6>to</span> acquire network connectivity.
</span></span><span style=display:flex><span>The veth interface will <span style=color:#ff79c6>not</span> <span style=color:#ff79c6>show</span> the IP address <span style=color:#ff79c6>when</span> <span style=color:#ff79c6>using</span> tools <span style=color:#ff79c6>like</span> <span style=color:#ff79c6>`</span>ip addr <span style=color:#ff79c6>show</span><span style=color:#ff79c6>`</span> <span style=color:#ff79c6>or</span> <span style=color:#ff79c6>`</span>ifconfig<span style=color:#ff79c6>`</span> <span style=color:#ff79c6>on</span> the host, but you are able <span style=color:#ff79c6>to</span> see the IP inside the container.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>&gt;</span> <span style=color:#ff79c6>**</span>EXAMPLE<span style=color:#ff79c6>**</span> <span style=color:#ff79c6>`</span>veth<span style=color:#ff79c6>`</span> interface of container <span style=color:#ff79c6>from</span> host
</span></span><span style=display:flex><span><span style=color:#ff79c6>&gt;</span> <span style=color:#ff79c6>```</span>auto
</span></span><span style=display:flex><span>$ ip addr <span style=color:#ff79c6>show</span> veth9af2aa6
</span></span><span style=display:flex><span><span style=color:#bd93f9>138</span>: veth9af2aa6<span style=color:#ff79c6>@</span>if137: <span style=color:#ff79c6>&lt;</span>BROADCAST,MULTICAST,UP,LOWER_UP<span style=color:#ff79c6>&gt;</span> mtu <span style=color:#bd93f9>1500</span> qdisc noqueue master br<span style=color:#ff79c6>-</span><span style=color:#bd93f9>4</span>cc4efd905ff state UP <span style=color:#ff79c6>group</span> <span style=color:#ff79c6>default</span>
</span></span><span style=display:flex><span>    link<span style=color:#ff79c6>/</span>ether be:e2:<span style=color:#bd93f9>72</span>:ce:<span style=color:#bd93f9>72</span>:<span style=color:#bd93f9>1</span>b brd ff:ff:ff:ff:ff:ff link<span style=color:#ff79c6>-</span>netnsid <span style=color:#bd93f9>0</span>
</span></span><span style=display:flex><span>    inet6 fe80::bce2:<span style=color:#bd93f9>72</span>ff:fece:<span style=color:#bd93f9>721</span>b<span style=color:#ff79c6>/</span><span style=color:#bd93f9>64</span> scope link
</span></span><span style=display:flex><span>       valid_lft forever preferred_lft forever
</span></span></code></pre></div><p>Previously we also had it about other networks / bridges in regards to <code>docker network</code> commands. When running <code>docker network create</code> a new bridge will be created which has its &ldquo;own&rdquo; IP range as can been seen in the example output.</p><blockquote><p><strong>EXAMPLE</strong> <code>docker network create</code> &ldquo;normal&rdquo; bridge on host</p></blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>$ ip addr show br-4cc4efd905ff
</span></span><span style=display:flex><span>104: br-4cc4efd905ff: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default
</span></span><span style=display:flex><span>    link/ether 02:42:90:e4:8d:a1 brd ff:ff:ff:ff:ff:ff
</span></span><span style=display:flex><span>    inet 172.18.0.1/16 brd 172.18.255.255 scope global br-4cc4efd905ff
</span></span><span style=display:flex><span>       valid_lft forever preferred_lft forever
</span></span><span style=display:flex><span>    inet6 fe80::42:90ff:fee4:8da1/64 scope link
</span></span><span style=display:flex><span>       valid_lft forever preferred_lft forever
</span></span></code></pre></div><p>You can view the IP address and much more information of containers, using <code>docker inspect CONTAINER_NAME</code>:</p><blockquote><p><strong>EXAMPLE</strong> <code>docker inspect database</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback></code></pre></div></blockquote><p>$ docker inspect database
[
{
[&mldr;]
&ldquo;Name&rdquo;: &ldquo;/database&rdquo;,
[&mldr;]
&ldquo;NetworkSettings&rdquo;: {
[&mldr;]
&ldquo;Ports&rdquo;: {
&ldquo;3306/tcp&rdquo;: null
},
[&mldr;]
&ldquo;Networks&rdquo;: {
&ldquo;wordpress&rdquo;: {
[&mldr;]
&ldquo;Gateway&rdquo;: &ldquo;172.18.0.1&rdquo;,
&ldquo;IPAddress&rdquo;: &ldquo;172.18.0.2&rdquo;,
&ldquo;IPPrefixLen&rdquo;: 16,
[&mldr;]
&ldquo;MacAddress&rdquo;: &ldquo;02:42:ac:12:00:02&rdquo;,
[&mldr;]
}
}
}
}
]</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mysql data-lang=mysql><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6272a4>#### Multi Machine Network
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>
</span></span><span style=display:flex><span>Docker Swarm, which <span style=color:#ff79c6>is</span> the <span style=color:#f1fa8c>&#34;clustered&#34;</span> mode <span style=color:#ff79c6>/</span> <span style=color:#f1fa8c>&#34;version&#34;</span> of Docker, can allow you <span style=color:#ff79c6>to</span> <span style=color:#ff79c6>create</span> an overlay network, <span style=color:#ff79c6>between</span> multiple machines. But I<span style=color:#f1fa8c>&#39;m not going deeper into this here.
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>For people interested in this feature, see the [Docker Docs `network create`](https://docs.docker.com/engine/reference/commandline/network_create/).
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>#### IPv6
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c><figure itemprop=associatedMedia itemscope itemtype=http://schema.org/ImageObject>
    <a href=i-think-we-have-a-problem-cheezeburger.png itemprop=contentUrl>
        <img itemprop=thumbnail src=i-think-we-have-a-problem-cheezeburger.png width=300px>
    </a>
    
    <figcaption>
        <h4>&#39;State of IPv6 and containers&#39; - Image taken from Cheezburger.com</h4>
        
    </figcaption>
    
</figure>

</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>&gt; _Let&#39;</span>s <span style=color:#ff79c6>not</span> talk about that, okay ..<span style=color:#ff79c6>?</span>_
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>With</span> Docker itself it <span style=color:#ff79c6>is</span> <span style=color:#ff79c6>not</span> too much of a problem <span style=color:#ff79c6>to</span> <span style=color:#ff79c6>use</span> IPv6, but sadly <span style=color:#ff79c6>not</span> too optimal.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>You can have IPv4 <span style=color:#ff79c6>and</span> IPv6, but let<span style=color:#f1fa8c>&#39;s concern ourselves with that when we are looking at Kubernetes. Reason for looking at this topic first in Kubernetes is that, in Kubernetes you won&#39;</span>t really <span style=color:#ff79c6>use</span> the networking of Docker anymore.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6272a4>### Network modes (&#34;default&#34;, host or other)
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>
</span></span><span style=display:flex><span>I<span style=color:#f1fa8c>&#39;ve wrote, that I&#39;</span>m <span style=color:#ff79c6>not</span> going deeper <span style=color:#ff79c6>into</span> Docker<span style=color:#f1fa8c>&#39;s own (overlay) network feature, but with this topic, I&#39;</span>ll have <span style=color:#ff79c6>to</span> go <span style=color:#ff79c6>into</span> it just a <span style=color:#8be9fd>bit</span>.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>When</span> running a container <span style=color:#ff79c6>in</span> the <span style=color:#ff79c6>default</span> network <span style=color:#50fa7b>mode</span> (named <span style=color:#ff79c6>`</span><span style=color:#ff79c6>default</span><span style=color:#ff79c6>`</span>, <span style=color:#ff79c6>`--</span>net<span style=color:#ff79c6>=</span><span style=color:#ff79c6>default</span><span style=color:#ff79c6>`</span>). The <span style=color:#ff79c6>`</span><span style=color:#ff79c6>default</span><span style=color:#ff79c6>`</span> network mode causes every container <span style=color:#ff79c6>to</span> get a separate network interface <span style=color:#ff79c6>/</span> stack.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>There <span style=color:#ff79c6>is</span> also the network mode <span style=color:#ff79c6>`</span>host<span style=color:#ff79c6>`</span> available <span style=color:#ff79c6>by</span> <span style=color:#ff79c6>default</span>. The <span style=color:#ff79c6>`</span>host<span style=color:#ff79c6>`</span> network mode gives the host network stack aka <span style=color:#f1fa8c>&#34;full access to the network of the host system&#34;</span> inside the container.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>The <span style=color:#ff79c6>`--</span>net<span style=color:#ff79c6>`</span> flag can also take a name of a network which has been created <span style=color:#ff79c6>using</span> the <span style=color:#ff79c6>`</span>docker network<span style=color:#ff79c6>`</span> command, e.g, <span style=color:#ff79c6>as</span> used <span style=color:#ff79c6>in</span> the example <span style=color:#ff79c6>`</span>wordpress<span style=color:#ff79c6>`</span> <span style=color:#ff79c6>as</span> the network name <span style=color:#ff79c6>`--</span>net<span style=color:#ff79c6>=</span>wordpress<span style=color:#ff79c6>`</span>.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>&gt;</span> <span style=color:#ff79c6>**</span>NOTE<span style=color:#ff79c6>**</span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>&gt;</span> <span style=color:#ff79c6>For</span> the upcoming example outputs, the <span style=color:#ff79c6>`</span>docker0<span style=color:#ff79c6>`</span> bridge uses the <span style=color:#ff79c6>`</span><span style=color:#bd93f9>172</span>.<span style=color:#bd93f9>17</span>.<span style=color:#bd93f9>0</span>.<span style=color:#bd93f9>1</span><span style=color:#ff79c6>/</span><span style=color:#bd93f9>16</span><span style=color:#ff79c6>`!</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>The below snippet shows how the contaienr inside network looks <span style=color:#ff79c6>for</span> <span style=color:#f1fa8c>&#34;default&#34;</span> (<span style=color:#ff79c6>/</span> unspecified) network mode:
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>&gt;</span> <span style=color:#ff79c6>**</span>EXAMPLE<span style=color:#ff79c6>**</span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>&gt;</span> <span style=color:#ff79c6>```</span>console
</span></span><span style=display:flex><span>HOST $ docker run <span style=color:#ff79c6>-</span>it debian:jessie ip addr <span style=color:#ff79c6>show</span>
</span></span><span style=display:flex><span><span style=color:#bd93f9>1</span>: lo: <span style=color:#ff79c6>&lt;</span>LOOPBACK,UP,LOWER_UP<span style=color:#ff79c6>&gt;</span> mtu <span style=color:#bd93f9>65536</span> qdisc noqueue state UNKNOWN <span style=color:#ff79c6>group</span> <span style=color:#ff79c6>default</span> qlen <span style=color:#bd93f9>1000</span>
</span></span><span style=display:flex><span>    link<span style=color:#ff79c6>/</span>loopback <span style=color:#bd93f9>00</span>:<span style=color:#bd93f9>00</span>:<span style=color:#bd93f9>00</span>:<span style=color:#bd93f9>00</span>:<span style=color:#bd93f9>00</span>:<span style=color:#bd93f9>00</span> brd <span style=color:#bd93f9>00</span>:<span style=color:#bd93f9>00</span>:<span style=color:#bd93f9>00</span>:<span style=color:#bd93f9>00</span>:<span style=color:#bd93f9>00</span>:<span style=color:#bd93f9>00</span>
</span></span><span style=display:flex><span>    inet <span style=color:#bd93f9>127</span>.<span style=color:#bd93f9>0</span>.<span style=color:#bd93f9>0</span>.<span style=color:#bd93f9>1</span><span style=color:#ff79c6>/</span><span style=color:#bd93f9>8</span> scope host lo
</span></span><span style=display:flex><span>       valid_lft forever preferred_lft forever
</span></span><span style=display:flex><span><span style=color:#bd93f9>141</span>: eth0<span style=color:#ff79c6>@</span>if142: <span style=color:#ff79c6>&lt;</span>BROADCAST,MULTICAST,UP,LOWER_UP<span style=color:#ff79c6>&gt;</span> mtu <span style=color:#bd93f9>1500</span> qdisc noqueue state UP <span style=color:#ff79c6>group</span> <span style=color:#ff79c6>default</span>
</span></span><span style=display:flex><span>    link<span style=color:#ff79c6>/</span>ether <span style=color:#bd93f9>02</span>:<span style=color:#bd93f9>42</span>:ac:<span style=color:#bd93f9>11</span>:<span style=color:#bd93f9>00</span>:<span style=color:#bd93f9>02</span> brd ff:ff:ff:ff:ff:ff
</span></span><span style=display:flex><span>    inet <span style=color:#bd93f9>172</span>.<span style=color:#bd93f9>17</span>.<span style=color:#bd93f9>0</span>.<span style=color:#bd93f9>2</span><span style=color:#ff79c6>/</span><span style=color:#bd93f9>16</span> brd <span style=color:#bd93f9>172</span>.<span style=color:#bd93f9>17</span>.<span style=color:#bd93f9>255</span>.<span style=color:#bd93f9>255</span> scope global eth0
</span></span><span style=display:flex><span>       valid_lft forever preferred_lft forever
</span></span></code></pre></div><p>As you can see the container is getting an IP from the <code>docker0</code> bridge.</p><p>What about using the host&rsquo;s network with <code>--net=host</code>?</p><blockquote><p><strong>EXAMPLE</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console></code></pre></div></blockquote><p>$ docker run -it &ndash;net=host debian:jessie ip addr show
1: lo: &lt;LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000
link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
inet 127.0.0.1/8 scope host lo
valid_lft forever preferred_lft forever
inet6 ::1/128 scope host
valid_lft forever preferred_lft forever
2: enp4s0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc fq_codel state UP group default qlen 1000
link/ether REDACTED brd ff:ff:ff:ff:ff:ff
inet 172.16.1.99/24 brd 172.16.1.255 scope global noprefixroute dynamic enp4s0
valid_lft 5204sec preferred_lft 5204sec
inet6 REDACTED/64 scope global noprefixroute dynamic
valid_lft 86396sec preferred_lft 14396sec
inet6 fe80::800b:52b6:865b:5444/64 scope link noprefixroute
valid_lft forever preferred_lft forever
4: docker0: &lt;NO-CARRIER,BROADCAST,MULTICAST,UP> mtu 1500 qdisc noqueue state DOWN group default
link/ether 02:42:d1:cc:07:47 brd ff:ff:ff:ff:ff:ff
inet 172.17.0.1/16 brd 172.17.255.255 scope global docker0
valid_lft forever preferred_lft forever
inet6 fe80::42:d1ff:fecc:747/64 scope link
valid_lft forever preferred_lft forever
104: br-4cc4efd905ff: &lt;BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP group default
link/ether 02:42:90:e4:8d:a1 brd ff:ff:ff:ff:ff:ff
inet 172.18.0.1/16 brd 172.18.255.255 scope global br-4cc4efd905ff
valid_lft forever preferred_lft forever
inet6 fe80::42:90ff:fee4:8da1/64 scope link
valid_lft forever preferred_lft forever
138: veth9af2aa6@if137: &lt;BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue master br-4cc4efd905ff state UP group default
link/ether be:e2:72:ce:72:1b brd ff:ff:ff:ff:ff:ff
inet6 fe80::bce2:72ff:fece:721b/64 scope link
valid_lft forever preferred_lft forever</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mysql data-lang=mysql><span style=display:flex><span>
</span></span><span style=display:flex><span>The container <span style=color:#ff79c6>is</span> getting full access <span style=color:#ff79c6>to</span> the host<span style=color:#f1fa8c>&#39;s network stack when using `--net=host`.
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>The `br-4cc4efd905ff` interface is the `wordpress` network previously created.
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>&gt; **WARNING**
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>&gt;
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>&gt; This means that there are no namespaces between the host&#39;</span>s network stack <span style=color:#ff79c6>and</span> the container<span style=color:#ff79c6>!</span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>&gt;</span> A container running <span style=color:#ff79c6>with</span> <span style=color:#ff79c6>`--</span>net<span style=color:#ff79c6>=</span>host<span style=color:#ff79c6>`</span> can potentially shutdown your server.
</span></span><span style=display:flex><span><span style=color:#ff79c6>&gt;</span> Only <span style=color:#ff79c6>use</span> <span style=color:#ff79c6>`--</span>net<span style=color:#ff79c6>=</span>host<span style=color:#ff79c6>`</span> <span style=color:#ff79c6>when</span> you know what you are doing <span style=color:#ff79c6>and</span> what the implications are.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Just <span style=color:#ff79c6>for</span> comparsion here the <span style=color:#ff79c6>`</span>ip addr <span style=color:#ff79c6>show</span><span style=color:#ff79c6>`</span> output directly <span style=color:#ff79c6>from</span> the host <span style=color:#ff79c6>to</span> compare it <span style=color:#ff79c6>with</span> the above output <span style=color:#ff79c6>from</span> the container.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>&gt;</span> <span style=color:#ff79c6>**</span>EXAMPLE<span style=color:#ff79c6>**</span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>&gt;</span> <span style=color:#ff79c6>```</span>console
</span></span><span style=display:flex><span>HOST $ ip addr <span style=color:#ff79c6>show</span>
</span></span><span style=display:flex><span><span style=color:#bd93f9>1</span>: lo: <span style=color:#ff79c6>&lt;</span>LOOPBACK,UP,LOWER_UP<span style=color:#ff79c6>&gt;</span> mtu <span style=color:#bd93f9>65536</span> qdisc noqueue state UNKNOWN <span style=color:#ff79c6>group</span> <span style=color:#ff79c6>default</span> qlen <span style=color:#bd93f9>1000</span>
</span></span><span style=display:flex><span>    link<span style=color:#ff79c6>/</span>loopback <span style=color:#bd93f9>00</span>:<span style=color:#bd93f9>00</span>:<span style=color:#bd93f9>00</span>:<span style=color:#bd93f9>00</span>:<span style=color:#bd93f9>00</span>:<span style=color:#bd93f9>00</span> brd <span style=color:#bd93f9>00</span>:<span style=color:#bd93f9>00</span>:<span style=color:#bd93f9>00</span>:<span style=color:#bd93f9>00</span>:<span style=color:#bd93f9>00</span>:<span style=color:#bd93f9>00</span>
</span></span><span style=display:flex><span>    inet <span style=color:#bd93f9>127</span>.<span style=color:#bd93f9>0</span>.<span style=color:#bd93f9>0</span>.<span style=color:#bd93f9>1</span><span style=color:#ff79c6>/</span><span style=color:#bd93f9>8</span> scope host lo
</span></span><span style=display:flex><span>       valid_lft forever preferred_lft forever
</span></span><span style=display:flex><span>    inet6 ::<span style=color:#bd93f9>1</span><span style=color:#ff79c6>/</span><span style=color:#bd93f9>128</span> scope host
</span></span><span style=display:flex><span>       valid_lft forever preferred_lft forever
</span></span><span style=display:flex><span><span style=color:#bd93f9>2</span>: enp4s0: <span style=color:#ff79c6>&lt;</span>BROADCAST,MULTICAST,UP,LOWER_UP<span style=color:#ff79c6>&gt;</span> mtu <span style=color:#bd93f9>1500</span> qdisc fq_codel state UP <span style=color:#ff79c6>group</span> <span style=color:#ff79c6>default</span> qlen <span style=color:#bd93f9>1000</span>
</span></span><span style=display:flex><span>    link<span style=color:#ff79c6>/</span>ether REDACTED brd ff:ff:ff:ff:ff:ff
</span></span><span style=display:flex><span>    inet <span style=color:#bd93f9>172</span>.<span style=color:#bd93f9>16</span>.<span style=color:#bd93f9>1</span>.<span style=color:#bd93f9>99</span><span style=color:#ff79c6>/</span><span style=color:#bd93f9>24</span> brd <span style=color:#bd93f9>172</span>.<span style=color:#bd93f9>16</span>.<span style=color:#bd93f9>1</span>.<span style=color:#bd93f9>255</span> scope global dynamic noprefixroute enp4s0
</span></span><span style=display:flex><span>       valid_lft <span style=color:#bd93f9>5188</span>sec preferred_lft <span style=color:#bd93f9>5188</span>sec
</span></span><span style=display:flex><span>    inet6 REDACTED<span style=color:#ff79c6>/</span><span style=color:#bd93f9>64</span> scope global dynamic noprefixroute
</span></span><span style=display:flex><span>       valid_lft <span style=color:#bd93f9>86395</span>sec preferred_lft <span style=color:#bd93f9>14395</span>sec
</span></span><span style=display:flex><span>    inet6 fe80::<span style=color:#bd93f9>800</span>b:<span style=color:#bd93f9>52</span>b6:<span style=color:#bd93f9>865</span>b:<span style=color:#bd93f9>5444</span><span style=color:#ff79c6>/</span><span style=color:#bd93f9>64</span> scope link noprefixroute
</span></span><span style=display:flex><span>       valid_lft forever preferred_lft forever
</span></span><span style=display:flex><span><span style=color:#bd93f9>4</span>: docker0: <span style=color:#ff79c6>&lt;</span>NO<span style=color:#ff79c6>-</span>CARRIER,BROADCAST,MULTICAST,UP<span style=color:#ff79c6>&gt;</span> mtu <span style=color:#bd93f9>1500</span> qdisc noqueue state DOWN <span style=color:#ff79c6>group</span> <span style=color:#ff79c6>default</span>
</span></span><span style=display:flex><span>    link<span style=color:#ff79c6>/</span>ether <span style=color:#bd93f9>02</span>:<span style=color:#bd93f9>42</span>:d1:cc:<span style=color:#bd93f9>07</span>:<span style=color:#bd93f9>47</span> brd ff:ff:ff:ff:ff:ff
</span></span><span style=display:flex><span>    inet <span style=color:#bd93f9>172</span>.<span style=color:#bd93f9>17</span>.<span style=color:#bd93f9>0</span>.<span style=color:#bd93f9>1</span><span style=color:#ff79c6>/</span><span style=color:#bd93f9>16</span> brd <span style=color:#bd93f9>172</span>.<span style=color:#bd93f9>17</span>.<span style=color:#bd93f9>255</span>.<span style=color:#bd93f9>255</span> scope global docker0
</span></span><span style=display:flex><span>       valid_lft forever preferred_lft forever
</span></span><span style=display:flex><span>    inet6 fe80::<span style=color:#bd93f9>42</span>:d1ff:fecc:<span style=color:#bd93f9>747</span><span style=color:#ff79c6>/</span><span style=color:#bd93f9>64</span> scope link
</span></span><span style=display:flex><span>       valid_lft forever preferred_lft forever
</span></span><span style=display:flex><span><span style=color:#bd93f9>104</span>: br<span style=color:#ff79c6>-</span><span style=color:#bd93f9>4</span>cc4efd905ff: <span style=color:#ff79c6>&lt;</span>BROADCAST,MULTICAST,UP,LOWER_UP<span style=color:#ff79c6>&gt;</span> mtu <span style=color:#bd93f9>1500</span> qdisc noqueue state UP <span style=color:#ff79c6>group</span> <span style=color:#ff79c6>default</span>
</span></span><span style=display:flex><span>    link<span style=color:#ff79c6>/</span>ether <span style=color:#bd93f9>02</span>:<span style=color:#bd93f9>42</span>:<span style=color:#bd93f9>90</span>:e4:<span style=color:#bd93f9>8</span>d:a1 brd ff:ff:ff:ff:ff:ff
</span></span><span style=display:flex><span>    inet <span style=color:#bd93f9>172</span>.<span style=color:#bd93f9>18</span>.<span style=color:#bd93f9>0</span>.<span style=color:#bd93f9>1</span><span style=color:#ff79c6>/</span><span style=color:#bd93f9>16</span> brd <span style=color:#bd93f9>172</span>.<span style=color:#bd93f9>18</span>.<span style=color:#bd93f9>255</span>.<span style=color:#bd93f9>255</span> scope global br<span style=color:#ff79c6>-</span><span style=color:#bd93f9>4</span>cc4efd905ff
</span></span><span style=display:flex><span>       valid_lft forever preferred_lft forever
</span></span><span style=display:flex><span>    inet6 fe80::<span style=color:#bd93f9>42</span>:<span style=color:#bd93f9>90</span>ff:fee4:<span style=color:#bd93f9>8</span>da1<span style=color:#ff79c6>/</span><span style=color:#bd93f9>64</span> scope link
</span></span><span style=display:flex><span>       valid_lft forever preferred_lft forever
</span></span><span style=display:flex><span><span style=color:#bd93f9>138</span>: veth9af2aa6<span style=color:#ff79c6>@</span>if137: <span style=color:#ff79c6>&lt;</span>BROADCAST,MULTICAST,UP,LOWER_UP<span style=color:#ff79c6>&gt;</span> mtu <span style=color:#bd93f9>1500</span> qdisc noqueue master br<span style=color:#ff79c6>-</span><span style=color:#bd93f9>4</span>cc4efd905ff state UP <span style=color:#ff79c6>group</span> <span style=color:#ff79c6>default</span>
</span></span><span style=display:flex><span>    link<span style=color:#ff79c6>/</span>ether be:e2:<span style=color:#bd93f9>72</span>:ce:<span style=color:#bd93f9>72</span>:<span style=color:#bd93f9>1</span>b brd ff:ff:ff:ff:ff:ff link<span style=color:#ff79c6>-</span>netnsid <span style=color:#bd93f9>0</span>
</span></span><span style=display:flex><span>    inet6 fe80::bce2:<span style=color:#bd93f9>72</span>ff:fece:<span style=color:#bd93f9>721</span>b<span style=color:#ff79c6>/</span><span style=color:#bd93f9>64</span> scope link
</span></span><span style=display:flex><span>       valid_lft forever preferred_lft forever
</span></span></code></pre></div><h3 id=publishing-ports>Publishing ports</h3><p>Docker creates <code>iptables</code> rules so published (/ exposing) ports are reachable from the host itself but also from the outside.</p><p>In the below example output below, all <code>iptables</code> rules are shown that are created when one container is publishing / exposing port <code>3000/TCP</code>:</p><blockquote><p><strong>EXAMPLE</strong></p><p><code>iptables</code> filter rules</p></blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span># iptables -L -n
</span></span><span style=display:flex><span>Chain INPUT (policy ACCEPT)
</span></span><span style=display:flex><span>target     prot opt source               destination
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Chain FORWARD (policy DROP)
</span></span><span style=display:flex><span>target     prot opt source               destination
</span></span><span style=display:flex><span>DOCKER-USER  all  --  0.0.0.0/0            0.0.0.0/0
</span></span><span style=display:flex><span>DOCKER-ISOLATION-STAGE-1  all  --  0.0.0.0/0            0.0.0.0/0
</span></span><span style=display:flex><span>ACCEPT     all  --  0.0.0.0/0            0.0.0.0/0            ctstate RELATED,ESTABLISHED
</span></span><span style=display:flex><span>DOCKER     all  --  0.0.0.0/0            0.0.0.0/0
</span></span><span style=display:flex><span>ACCEPT     all  --  0.0.0.0/0            0.0.0.0/0
</span></span><span style=display:flex><span>ACCEPT     all  --  0.0.0.0/0            0.0.0.0/0
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Chain OUTPUT (policy ACCEPT)
</span></span><span style=display:flex><span>target     prot opt source               destination
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Chain DOCKER (1 references)
</span></span><span style=display:flex><span>target     prot opt source               destination
</span></span><span style=display:flex><span>ACCEPT     tcp  --  0.0.0.0/0            172.17.0.2           tcp dpt:3000
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Chain DOCKER-ISOLATION-STAGE-1 (1 references)
</span></span><span style=display:flex><span>target     prot opt source               destination
</span></span><span style=display:flex><span>DOCKER-ISOLATION-STAGE-2  all  --  0.0.0.0/0            0.0.0.0/0
</span></span><span style=display:flex><span>RETURN     all  --  0.0.0.0/0            0.0.0.0/0
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Chain DOCKER-ISOLATION-STAGE-2 (1 references)
</span></span><span style=display:flex><span>target     prot opt source               destination
</span></span><span style=display:flex><span>DROP       all  --  0.0.0.0/0            0.0.0.0/0
</span></span><span style=display:flex><span>RETURN     all  --  0.0.0.0/0            0.0.0.0/0
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Chain DOCKER-USER (1 references)
</span></span><span style=display:flex><span>target     prot opt source               destination
</span></span><span style=display:flex><span>RETURN     all  --  0.0.0.0/0            0.0.0.0/0
</span></span></code></pre></div><blockquote><p><code>iptables</code> nat rules</p></blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span># iptables -t nat -L -n
</span></span><span style=display:flex><span>Chain PREROUTING (policy ACCEPT)
</span></span><span style=display:flex><span>target     prot opt source               destination
</span></span><span style=display:flex><span>DOCKER     all  --  0.0.0.0/0            0.0.0.0/0            ADDRTYPE match dst-type LOCAL
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Chain INPUT (policy ACCEPT)
</span></span><span style=display:flex><span>target     prot opt source               destination
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Chain OUTPUT (policy ACCEPT)
</span></span><span style=display:flex><span>target     prot opt source               destination
</span></span><span style=display:flex><span>DOCKER     all  --  0.0.0.0/0           !127.0.0.0/8          ADDRTYPE match dst-type LOCAL
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Chain POSTROUTING (policy ACCEPT)
</span></span><span style=display:flex><span>target     prot opt source               destination
</span></span><span style=display:flex><span>MASQUERADE  all  --  172.17.0.0/16        0.0.0.0/0
</span></span><span style=display:flex><span>MASQUERADE  tcp  --  172.17.0.2           172.17.0.2           tcp dpt:3000
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Chain DOCKER (2 references)
</span></span><span style=display:flex><span>target     prot opt source               destination
</span></span><span style=display:flex><span>RETURN     all  --  0.0.0.0/0            0.0.0.0/0
</span></span><span style=display:flex><span>DNAT       tcp  --  0.0.0.0/0            0.0.0.0/0            tcp dpt:3000 to:172.17.0.2:3000
</span></span></code></pre></div><p>As we can see Docker uses a separate <code>DOCKER</code> chain in the <code>FORWARD</code> chain, to map incoming traffic on port 80 to the container IP.
After the destination IP has been changed, Docker uses DNAT (Destination Network Address Translation), to &ldquo;map&rdquo; the traffic to the container&rsquo;s end address.</p><blockquote><p><strong>TASK</strong> <a href=https://github.com/galexrt/workshop-container-docker-kubernetes/tree/master/network101><code>network101</code></a></p></blockquote><p>You can use the script <code>show_me_dat_network.sh</code> from task <code>network101</code>, to view your network interfaces and current <code>iptables</code> rules.</p><h3 id=looking-into-your-network>Looking into your network</h3><blockquote><p><strong>TASK</strong> <a href=https://github.com/galexrt/workshop-container-docker-kubernetes/tree/master/network101><code>network101</code></a></p></blockquote><p>Do you want to visualize your container network situation? Yes? Then the perfect tool for this is Weave Scope.</p><p>In the <code>network101</code> task is a file called <code>start_weave_scope.sh</code>. The script downloads the Weave Scope wrapper script, that starts the containers needed for Weave Scope to function.
The commands that are used to download the Weave Scope wrapper script are:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span><span style=color:#44475a>sudo wget -O /usr/local/bin/scope https://git.io/scope
</span></span></span><span style=display:flex><span><span style=color:#44475a>sudo chmod a+x /usr/local/bin/scope
</span></span></span><span style=display:flex><span><span style=color:#44475a>sudo scope launch
</span></span></span></code></pre></div><p>After the image of the container has been pulled and started, you can then navigate to <code>http://IP_ADDRESS_OF_THE_SERVER:4040</code> to see the Weave Scope UI.</p><figure itemprop=associatedMedia itemscope itemtype=http://schema.org/ImageObject><a href=weavescope_ui.png itemprop=contentUrl><img itemprop=thumbnail src=weavescope_ui.png width=900px></a><figcaption><h4>Weave Scope UI</h4></figcaption></figure><p>Through the Weave Scope UI you gain an immersive insight into your network of the containers.</p><hr><h2 id=limiting-container-resources>Limiting container resources</h2><figure itemprop=associatedMedia itemscope itemtype=http://schema.org/ImageObject><a href=its-ok-i-know-my-limit-meme.png itemprop=contentUrl><img itemprop=thumbnail src=its-ok-i-know-my-limit-meme.png width=250px></a><figcaption><h4>It's OK I know my limit - said the rogue process</h4></figcaption></figure><p>As I already mentioned in the <a href=#Container>Container!?</a> part, namespaces are able to limit the resources available to processes, etc.</p><h3 id=cpu-limit>CPU Limit</h3><p>Limiting the precious computing resource of a container.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span>$ docker run --help
</span></span><span style=display:flex><span><span style=color:#44475a>[...]
</span></span></span><span style=display:flex><span><span style=color:#44475a>  --cpu-period                    Limit CPU CFS (Completely Fair Scheduler) period
</span></span></span><span style=display:flex><span><span style=color:#44475a>  --cpu-quota                     Limit CPU CFS (Completely Fair Scheduler) quota
</span></span></span><span style=display:flex><span><span style=color:#44475a>  --cpuset-cpus                   CPUs in which to allow execution (0-3, 0,1)
</span></span></span><span style=display:flex><span><span style=color:#44475a>[...]
</span></span></span></code></pre></div><p>You can limit the time period and the quota of the CFS (Completely Fair Scheduler).
Limiting a container to specific cores is also possible (<code>--cpuset-cpus</code>).</p><h3 id=memory-and-swap-limit>Memory and Swap Limit</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span>$ docker run --help
</span></span><span style=display:flex><span><span style=color:#44475a>[...]
</span></span></span><span style=display:flex><span><span style=color:#44475a>  --cpuset-mems                   MEMs in which to allow execution (0-3, 0,1)
</span></span></span><span style=display:flex><span><span style=color:#44475a>[...]
</span></span></span><span style=display:flex><span><span style=color:#44475a>  --kernel-memory                 Kernel memory limit
</span></span></span><span style=display:flex><span><span style=color:#44475a>[...]
</span></span></span><span style=display:flex><span><span style=color:#44475a>  --memory-reservation            Memory soft limit
</span></span></span><span style=display:flex><span><span style=color:#44475a>  --memory-swap                   Swap limit equal to memory plus swap: &#39;-1&#39; to enable unlimited swap
</span></span></span><span style=display:flex><span><span style=color:#44475a>  --memory-swappiness=-1          Tune container memory swappiness (0 to 100)
</span></span></span><span style=display:flex><span><span style=color:#44475a>[...]
</span></span></span><span style=display:flex><span><span style=color:#44475a>  --oom-kill-disable              Disable OOM Killer
</span></span></span><span style=display:flex><span><span style=color:#44475a>  --oom-score-adj                 Tune host&#39;s OOM preferences (-1000 to 1000)
</span></span></span><span style=display:flex><span><span style=color:#44475a>[...]
</span></span></span></code></pre></div><p>As you can see, there is a good amount of option to play around with the memory a container can use and how it can use the memory.</p><p>A good feature if you have limited memory available is to play with the memory swappiness.</p><p>The <code>OOM</code> (Linux Out of Memory Management) options are good, if you have memory intensive applications, but only limited memory available. So important application container don&rsquo;t get killed, when the system should run out of memory.</p><hr><h2 id=selfies-i-mean-images>Selfies? I mean Images</h2><p>An image is the core of a container. Without an image, there would be no container.
Creating images is simple to do, depending on what you try to &ldquo;containerize&rdquo;.
In this part we set a simple goal. Our goal is to create a container that runs nginx in it.</p><h3 id=image-names-explained>Image Names explained</h3><p>Images that &ldquo;come&rdquo; from the <a href=https://hub.docker.com/>Docker Image Hub</a>, don&rsquo;t need a repository specified.</p><p>The image we used for the MariaDB container is:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span><span style=color:#44475a>mariadb:10.4.3-bionic
</span></span></span></code></pre></div><blockquote><p><strong>WDWD</strong></p><ul><li><code>sameersbn</code> - The username of the creator.</li><li><code>mysql</code> - The image name.</li><li><code>latest</code> - The &ldquo;version&rdquo; tag. The tag can be anything, but emojis.</li></ul></blockquote><p>An example for an image that is pulled from a different image server, than the official Docker Hub, is my <a href=https://github.com/galexrt/dellhw_exporter>Prometheus DellHW Exporter</a> image that is hosted on <a href=https://quay.io>quay.io</a>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span><span style=color:#44475a>quay.io/galexrt/dellhw_exporter:v1.3.5
</span></span></span><span style=display:flex><span><span style=color:#44475a>SERVER/USERNAME/IMAGE_NAME:TAG
</span></span></span></code></pre></div><blockquote><p><strong>WDWD</strong></p><ul><li><code>quay.io</code>, <code>SERVER</code> - Defaults to <code>docker.io</code>. The image repository server to pull the image from.</li><li><code>galexrt</code>, <code>USERNAME</code> - Username of the image author / uploader.</li><li><code>dellhw_exporter</code>, <code>IMAGE_NAME</code> - Name of the image.</li><li><code>v1.3.5</code>, <code>TAG</code> - Like git tags. When not specified, the default is <code>latest</code>.</li></ul></blockquote><p>In the case of official created images, like the WordPress image we used no server and username is required (by default).
Official images are &ldquo;marked&rdquo; by not having a username in the image &ldquo;address&rdquo;. When browsing such iamges on Docker Hub, the URL does have an underscore instead of a username, e.g., <code>https://hub.docker.com/_/wordpress/</code>.</p><h3 id=what-have-layer-cakes-to-do-with-container-images>What have Layer Cakes to do with Container Images?</h3><figure itemprop=associatedMedia itemscope itemtype=http://schema.org/ImageObject><a href=layer-cake-from-wikimedia.png itemprop=contentUrl><img itemprop=thumbnail src=layer-cake-from-wikimedia.png width=850px></a><figcaption><h4>Mhh, tasty, isn't it? But now back to the topic.</h4></figcaption></figure><blockquote><p><strong>TASK</strong>: <a href=https://github.com/galexrt/workshop-container-docker-kubernetes/tree/master/dockerfile101><code>dockerfile101</code></a></p></blockquote><p>In the Docker universe, a Container image is built from the bottom to the top like a cake, the bottom is a baseimage (or any other image as a base).
Every &ldquo;new&rdquo; layer on top of it, is an action that had been run when building the image.</p><p>Meaning if we create an image from the baseimage <code>fedora:29</code> like the example <code>Dockerfile</code>, a cross-section / profile would look like this:</p><figure itemprop=associatedMedia itemscope itemtype=http://schema.org/ImageObject><a href=container-image-layers-diagram.png itemprop=contentUrl><img itemprop=thumbnail src=container-image-layers-diagram.png width=750px></a><figcaption><h4>Dockerfile Steps / Container Image Layers</h4></figcaption></figure><p>That is one of the reasons, why Container images are so small. If you download 10 images that are based on <code>debian:jessie</code>, you would only have to download the created / modified layers, because the baseimage is the same for these 10 images.
To build / create an image, you create a Dockerfile and that&rsquo;s what we are going to talk about next.</p><h3 id=dockerfile-examples>Dockerfile examples</h3><p>As you may have already seen in the current task directory <code>dockerfile101</code>, there is a file called <code>Dockerfile</code>.
A <code>Dockerfile</code> contains container image build instructions. <code>Dockerfile</code>s have their own syntax, but the syntax is pretty simple.</p><p>I&rsquo;m going to show you two more or less advanced Dockerfile examples in the next section, one for a Golang and one for a Python application.</p><h4 id=golang-application-with-dependency-dockerfile-example>Golang application with Dependency Dockerfile Example</h4><p>Taken from the <a href=https://github.com/galexrt/dellhw_exporter>GitHub project galexrt/dellhw_exporter</a>, file <code>Dockerfile</code>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span><span style=color:#44475a>FROM centos:7
</span></span></span><span style=display:flex><span><span style=color:#44475a>LABEL maintainer=&#34;Alexander Trost &lt;galexrt@googlemail.com&gt;&#34;
</span></span></span><span style=display:flex><span><span style=color:#44475a></span>
</span></span><span style=display:flex><span># Environment variables
</span></span><span style=display:flex><span><span style=color:#44475a>ENV DSU_VERSION=&#34;DSU_18.08.00&#34; \
</span></span></span><span style=display:flex><span><span style=color:#44475a>    PATH=&#34;$PATH:/opt/dell/srvadmin/bin:/opt/dell/srvadmin/sbin&#34; \
</span></span></span><span style=display:flex><span><span style=color:#44475a>    USER=&#34;root&#34; \
</span></span></span><span style=display:flex><span><span style=color:#44475a>    PASS=&#34;password&#34; \
</span></span></span><span style=display:flex><span><span style=color:#44475a>    SYSTEMCTL_SKIP_REDIRECT=&#34;1&#34;
</span></span></span><span style=display:flex><span><span style=color:#44475a></span>
</span></span><span style=display:flex><span># Do overall update and install missing packages needed <span style=color:#ff79c6>for</span> OpenManage
</span></span><span style=display:flex><span><span style=color:#44475a>RUN yum -y update &amp;&amp; \
</span></span></span><span style=display:flex><span><span style=color:#44475a>    yum -y install sysvinit-tools wget perl passwd gcc which tar libstdc++.so.6 compat-libstdc++-33.i686 glibc.i686 &amp;&amp; \
</span></span></span><span style=display:flex><span><span style=color:#44475a>    echo &#34;$USER:$PASS&#34; | chpasswd &amp;&amp; \
</span></span></span><span style=display:flex><span><span style=color:#44475a>    wget -q -O - &#34;https://linux.dell.com/repo/hardware/${DSU_VERSION}/bootstrap.cgi&#34; | bash &amp;&amp; \
</span></span></span><span style=display:flex><span><span style=color:#44475a>    rpm --import &#34;https://linux.dell.com/repo/pgp_pubkeys/0x1285491434D8786F.asc&#34; &amp;&amp; \
</span></span></span><span style=display:flex><span><span style=color:#44475a>    yum -y install srvadmin-base srvadmin-storageservices &amp;&amp; \
</span></span></span><span style=display:flex><span><span style=color:#44475a>    yum clean all
</span></span></span><span style=display:flex><span><span style=color:#44475a></span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#44475a>ADD .build/linux-amd64/dellhw_exporter /bin/dellhw_exporter
</span></span></span><span style=display:flex><span><span style=color:#44475a></span>
</span></span><span style=display:flex><span><span style=color:#44475a>ENTRYPOINT [&#34;/bin/dellhw_exporter&#34;]
</span></span></span><span style=display:flex><span><span style=color:#44475a></span>
</span></span><span style=display:flex><span><span style=color:#44475a>CMD [&#34;-container&#34;]
</span></span></span></code></pre></div><h4 id=advanced-python-application-dockerfile-example>Advanced Python Application Dockerfile Example</h4><p>Taken from the <a href=https://github.com/galexrt/docker-healthchecks>GitHub project galexrt/docker-healthchecks</a>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span><span style=color:#44475a>FROM debian:stretch
</span></span></span><span style=display:flex><span><span style=color:#44475a>LABEL maintainer=&#34;Alexander Trost &lt;galexrt@googlemail.com&gt;&#34;
</span></span></span><span style=display:flex><span><span style=color:#44475a></span>
</span></span><span style=display:flex><span><span style=color:#44475a>ENV DATA_DIR=&#34;/data&#34; \
</span></span></span><span style=display:flex><span><span style=color:#44475a>    HEALTHCHECKS_VERSION=&#34;master&#34; \
</span></span></span><span style=display:flex><span><span style=color:#44475a>    HEALTHCHECKS_USER=&#34;1000&#34; \
</span></span></span><span style=display:flex><span><span style=color:#44475a>    HEALTHCHECKS_GROUP=&#34;1000&#34;
</span></span></span><span style=display:flex><span><span style=color:#44475a></span>
</span></span><span style=display:flex><span><span style=color:#44475a>RUN groupadd -g &#34;$HEALTHCHECKS_GROUP&#34; healthchecks &amp;&amp; \
</span></span></span><span style=display:flex><span><span style=color:#44475a>    useradd -u &#34;$HEALTHCHECKS_USER&#34; -g &#34;$HEALTHCHECKS_GROUP&#34; -m -d /home/healthchecks -s /bin/bash healthchecks &amp;&amp; \
</span></span></span><span style=display:flex><span><span style=color:#44475a>    apt-get update &amp;&amp; \
</span></span></span><span style=display:flex><span><span style=color:#44475a>    apt-get install -y wget sudo gnupg2 &amp;&amp; \
</span></span></span><span style=display:flex><span><span style=color:#44475a>    echo &#34;deb http://apt.postgresql.org/pub/repos/apt/ stretch-pgdg main&#34; &gt; /etc/apt/sources.list.d/psql.list &amp;&amp; \
</span></span></span><span style=display:flex><span><span style=color:#44475a>    wget -q -O- https://www.postgresql.org/media/keys/ACCC4CF8.asc | \
</span></span></span><span style=display:flex><span><span style=color:#44475a>    apt-key add - &amp;&amp; \
</span></span></span><span style=display:flex><span><span style=color:#44475a>    apt-get update &amp;&amp; \
</span></span></span><span style=display:flex><span><span style=color:#44475a>    apt-get dist-upgrade -y &amp;&amp; \
</span></span></span><span style=display:flex><span><span style=color:#44475a>    apt-get install -y git python3 python3-dev python3-setuptools python3-dateutil \
</span></span></span><span style=display:flex><span><span style=color:#44475a>        python-mysqldb postgresql-server-dev-9.6 build-essential libxml2-dev \
</span></span></span><span style=display:flex><span><span style=color:#44475a>        libxslt-dev libz-dev default-libmysqlclient-dev supervisor nginx &amp;&amp; \
</span></span></span><span style=display:flex><span><span style=color:#44475a>    easy_install3 -U pip &amp;&amp; \
</span></span></span><span style=display:flex><span><span style=color:#44475a>    mkdir -p /healthchecks &#34;$DATA_DIR&#34; &amp;&amp; \
</span></span></span><span style=display:flex><span><span style=color:#44475a>    chown healthchecks:healthchecks -R /healthchecks &#34;$DATA_DIR&#34; &amp;&amp; \
</span></span></span><span style=display:flex><span><span style=color:#44475a>    easy_install3 six &amp;&amp; \
</span></span></span><span style=display:flex><span><span style=color:#44475a>    pip install gunicorn &amp;&amp; \
</span></span></span><span style=display:flex><span><span style=color:#44475a>    sudo -u healthchecks -g healthchecks sh -c &#34;git clone https://github.com/healthchecks/healthchecks.git /healthchecks &amp;&amp; \
</span></span></span><span style=display:flex><span><span style=color:#44475a>    cd /healthchecks &amp;&amp; \
</span></span></span><span style=display:flex><span><span style=color:#44475a>    git checkout $HEALTHCHECKS_VERSION &amp;&amp; \
</span></span></span><span style=display:flex><span><span style=color:#44475a>    pip install -r requirements.txt --user &amp;&amp; \
</span></span></span><span style=display:flex><span><span style=color:#44475a>    pip install mysqlclient --user&#34; &amp;&amp; \
</span></span></span><span style=display:flex><span><span style=color:#44475a>    apt-get --purge remove -y build-essential python3-dev gnupg2 &amp;&amp; \
</span></span></span><span style=display:flex><span><span style=color:#44475a>    apt-get -q autoremove -y &amp;&amp; \
</span></span></span><span style=display:flex><span><span style=color:#44475a>    rm -rf /tmp/*
</span></span></span><span style=display:flex><span><span style=color:#44475a></span>
</span></span><span style=display:flex><span><span style=color:#44475a>COPY entrypoint.sh /entrypoint.sh
</span></span></span><span style=display:flex><span><span style=color:#44475a>COPY includes/scripts/ /usr/local/bin/
</span></span></span><span style=display:flex><span><span style=color:#44475a>COPY includes/supervisor/ /etc/supervisor/
</span></span></span><span style=display:flex><span><span style=color:#44475a>COPY includes/nginx/ /etc/nginx/
</span></span></span><span style=display:flex><span><span style=color:#44475a></span>
</span></span><span style=display:flex><span><span style=color:#44475a>RUN chown -R healthchecks:healthchecks \
</span></span></span><span style=display:flex><span><span style=color:#44475a>  /etc/nginx \
</span></span></span><span style=display:flex><span><span style=color:#44475a>  /var/lib/nginx \
</span></span></span><span style=display:flex><span><span style=color:#44475a>  /var/log \
</span></span></span><span style=display:flex><span><span style=color:#44475a>  /run
</span></span></span><span style=display:flex><span><span style=color:#44475a></span>
</span></span><span style=display:flex><span><span style=color:#44475a>USER 1000
</span></span></span><span style=display:flex><span><span style=color:#44475a></span>
</span></span><span style=display:flex><span><span style=color:#44475a>VOLUME [&#34;$DATA_DIR&#34;]
</span></span></span><span style=display:flex><span><span style=color:#44475a></span>
</span></span><span style=display:flex><span><span style=color:#44475a>EXPOSE 8000/tcp
</span></span></span><span style=display:flex><span><span style=color:#44475a></span>
</span></span><span style=display:flex><span><span style=color:#44475a>ENTRYPOINT [&#34;/entrypoint.sh&#34;]
</span></span></span><span style=display:flex><span><span style=color:#44475a></span>
</span></span><span style=display:flex><span><span style=color:#44475a>CMD [&#34;app:run&#34;]
</span></span></span></code></pre></div><p><strong>Don&rsquo;t worry we&rsquo;re going to start with a simple and basic image!</strong> :-)</p><h3 id=understanding-dockerfiles>Understanding Dockerfiles</h3><blockquote><p><strong>TASK</strong>: <a href=https://github.com/galexrt/workshop-container-docker-kubernetes/tree/master/dockerfile202><code>dockerfile202</code></a></p><p><strong>TIP</strong></p><p>If you have trouble writing a <code>Dockerfile</code>, checkout the <a href=https://docs.docker.com/engine/reference/builder/>Dockerfile Docs</a> for the full &ldquo;syntax&rdquo;.</p></blockquote><p>You will create an image with <code>nginx</code> installed (You can later expand it, with more functionality, like with PHP-FPM).</p><p>To guide you in creating a nginx image, I show you an example of a http webserver application written in golang, before you are going to create your own <code>nginx</code> image.</p><p><strong>Golang Dockerfile Example</strong>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span># golang image where workspace <span style=color:#ff79c6>(</span>GOPATH<span style=color:#ff79c6>)</span> configured at /go.
</span></span><span style=display:flex><span><span style=color:#44475a>FROM golang:1.12.2-stretch
</span></span></span><span style=display:flex><span><span style=color:#44475a></span>
</span></span><span style=display:flex><span># Add a label to the image so everyone knows who is maintaing it.
</span></span><span style=display:flex><span><span style=color:#44475a>LABEL maintainer=&#34;John Doe &lt;john.doe@example.com&gt;&#34;
</span></span></span><span style=display:flex><span><span style=color:#44475a></span>
</span></span><span style=display:flex><span># Copy the <span style=color:#8be9fd;font-style:italic>local</span> package files to the container’s workspace.
</span></span><span style=display:flex><span><span style=color:#44475a>ADD . /go/src/github.com/galexrt/workshop-container-docker-kubernetes
</span></span></span><span style=display:flex><span><span style=color:#44475a></span>
</span></span><span style=display:flex><span># Build the project inside the container.
</span></span><span style=display:flex><span><span style=color:#44475a>RUN go install github.com/galexrt/workshop-container-docker-kubernetes
</span></span></span><span style=display:flex><span><span style=color:#44475a></span>
</span></span><span style=display:flex><span># Run the  <span style=color:#8be9fd;font-style:italic>command</span> when the container starts.
</span></span><span style=display:flex><span><span style=color:#44475a>ENTRYPOINT [&#34;/go/bin/workshop-container-docker-kubernetes&#34;]
</span></span></span><span style=display:flex><span><span style=color:#44475a></span>
</span></span><span style=display:flex><span># http server listens on port 8080.
</span></span><span style=display:flex><span><span style=color:#44475a>EXPOSE 8080
</span></span></span></code></pre></div><blockquote><p><strong>WDWD</strong></p><ul><li><code>FROM ...</code> - Sets the baseimage.</li><li><code>LABEL ...=...</code> - Labels to add to the image, in key value pairs (<code>KEY=VALUE</code>).</li><li><code>COPY ... ...</code> - Copy files from the build root.</li><li><code>ADD ... ...</code> - Same as <code>COPY</code>, but target can be &ldquo;online&rdquo; and if it is an archive, it will be extracted.</li><li><code>RUN ...</code> - Run commands (Shell used <code>/bin/sh</code>).</li><li><code>ENTRYPOINT ["..."]</code> - The command to execute when the container is started.</li><li><code>CMD ["..."]</code> - Arguments for the <code>ENTRYPOINT</code>.</li><li><code>EXPOSE 8080/TCP NUMBER/PROTOCOL...</code> - Expose a port (This is important when linking containers together, as otherwise the port would not reachable from the other containers). Protocol can be <code>TCP</code> or <code>UDP</code>.</li></ul></blockquote><p>There&rsquo;s even the possibility, to execute specific commands when the image is used as a base image, the base instruction is called <code>ONBUILD ...</code>, but explaining this is beyond the scope of this training. Thanks for understanding!</p><blockquote><p>The <code>ONBUILD</code> instruction adds to the image a <em>trigger</em> instruction to be executed at a later time, when the image is used as the base for another build. The trigger will be executed in the context of the downstream build, as if it had been inserted immediately after the FROM instruction in the downstream <code>Dockerfile</code>.</p><p>– Quote from <a href=https://docs.docker.com/engine/reference/builder/#onbuild>Docker Dockerfile Documentation - ONBUILD section</a></p></blockquote><p>To build an image we use the <code>docker build</code> command. Building this golang example image, we run the following command:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span><span style=color:#44475a>docker build -f Dockerfile -t workshop-gowebapp .
</span></span></span></code></pre></div><blockquote><p><strong>WDWD</strong></p><ul><li><code>build</code> - Used to build Container images.</li><li><code>-t IMAGE_NAME</code> - Specify the name (with an optional tag) of the image, you are creating. <code>IMAGE_NAME</code> is a string name for the image with an optional tag specified. The tag is added by adding double dots like this <code>:TAG_NAME</code>. This flag in itself is optional.<ul><li><strong>NOTE</strong> This options is useful when manually building and pushing a Container image to a repository, so you can specify the name of the image as you want.</li></ul></li><li><code>-f DOCKERFILE</code> - Set the location of the <code>Dockerfile</code> (Optional).</li><li><code>.</code> - The image build root of the image build (<strong>Important</strong> when <code>ADD</code> or <code>COPY</code> is used in the <code>Dockerfile</code>). All files will be at least added to the build environment for easy access, but not added to the image itself.</li></ul></blockquote><p>As you can see, it isn&rsquo;t hard to build your first Container images.
If you want to see more advanced examples, you can find more examples in my GitHub repositories <a href="https://github.com/search?q=user%3Agalexrt+docker-">here</a>.</p><h3 id=commands-you-need-to-know-when-working-with-container-images>Commands you need to know when working with Container images</h3><h4 id=listing-the-container-images>Listing the Container images</h4><p>To list the Container images, use the <code>docker images</code> command:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span><span style=color:#44475a>docker images
</span></span></span></code></pre></div><p>The command can also take a name of an image, but then it will only show quick overview of the given image.</p><h4 id=deleting-a-container-image>Deleting a Container image</h4><p>To delete a Container image, you use the <code>docker rmi</code> command. The syntax is basically the same as for the <code>docker rm</code> command:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span><span style=color:#44475a>docker rmi IMAGE [IMAGE...]
</span></span></span></code></pre></div><blockquote><p><strong>WDWD</strong></p><ul><li><code>rmi</code> - The subcommand for deleting one or more image(s).</li><li><code>IMAGE [IMAGE...]</code> - One or more image names or IDs to delete.</li></ul></blockquote><h4 id=build-a-container-image-from-dockerfile>Build a Container image from Dockerfile</h4><p>Use this command to build images:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span><span style=color:#44475a>docker build -t IMAGE_NAME -f DOCKERFILE BUILD_PATH
</span></span></span></code></pre></div><blockquote><p><strong>WDWD</strong></p><ul><li><code>build</code> - The build subcommand.</li><li><code>-t IMAGE_NAME</code> - More details to <code>IMAGE_NAME</code> are going to be explained in a later section, <a href=#Image-Names-explained>here</a> or see above <strong>WDWD</strong> part.</li><li><code>DOCKERFILE</code> - Path to a Dockerfile. Defaults to the current work directory with <code>Dockerfile</code> attached as a file name.</li><li><code>BUILD_PATH</code> - The build root path. Files in the directory will be added to the Docker build environment, but not to the image itself. The files are only added when the specified Dockerfile has instructions to do so. You can&rsquo;t go deeper than the <code>BUILD_PATH</code>!</li></ul></blockquote><h3 id=lets-build-your-first-container-image>Let&rsquo;s build your first Container image</h3><p>Now that we know some <code>Dockerfile</code> basics, we can start building our own <code>nginx</code> image from the baseimage <code>debian:jessie</code>.</p><p>Let&rsquo;s make this like a test in the school, replace all <code>__BLANK__</code> with the correct answer (Solutions are <a href=#nginx-Dockerfile>here</a>):</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span><span style=color:#44475a>FROM __BLANK__
</span></span></span><span style=display:flex><span><span style=color:#44475a></span>
</span></span><span style=display:flex><span><span style=color:#44475a>RUN __BLANK__
</span></span></span><span style=display:flex><span><span style=color:#44475a></span>
</span></span><span style=display:flex><span><span style=color:#44475a>ENTRYPOINT [&#34;__BLANK__&#34;]
</span></span></span></code></pre></div><p>Got all blanks filled out? Good. Let&rsquo;s build the image:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span><span style=color:#44475a>docker build -t workshop-nginx .
</span></span></span></code></pre></div><blockquote><p><strong>Expected Output of <code>docker build -t workshop-nginx .</code></strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console></code></pre></div></blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>
</span></span><span style=display:flex><span>The build should go successfully, when you filled in the blanks correctly. Let&#39;s run the image to see if it is working, the container name will be `workshop-nginx`:
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>```console
</span></span><span style=display:flex><span>docker run \
</span></span><span style=display:flex><span>    --name=workshop-nginx \
</span></span><span style=display:flex><span>    -d \
</span></span><span style=display:flex><span>    -p 80:80 \
</span></span><span style=display:flex><span>    workshop-nginx
</span></span></code></pre></div><p>If you did something wrong, remove the container using (where <code>CONTAINER_NAME</code> is a container ID or name):</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span><span style=color:#44475a>docker rm CONTAINER_NAME
</span></span></span></code></pre></div><p>To check if the container is running with your image, run <code>docker ps -a</code>.</p><blockquote><p><strong>WDWD</strong></p><ul><li><code>ps</code> - Like the <code>ps </code>command, but for the containers.</li><li><code>-a</code> - Show all containers, whether their current state, without it showing only running containers.</li></ul></blockquote><p>You should see that the container you started, has exited.
There&rsquo;s a simple reason, why the container exited / stopped. When running a command as the entrypoint, it has to stay running, not fork to background. When the process forks to background, Docker will think the process has stopped and the container status will be set to <code>exited</code> with the last return code.</p><p>That&rsquo;s why we need to tell <code>nginx</code>, not to run as a daemon, not fork to background, with the following additional arguments <code>"-g", "daemon off;"</code> (these arguments must be added to the <code>ENTRYPOINT</code> line of the <code>Dockerfile</code>).</p><p>So we could make a change to the <code>nginx.conf</code>, overwrite <code>nginx.conf</code> with a custom one or <strong>just change</strong> the <code>ENTRYPOINT</code> line to make it look like this:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span><span style=color:#44475a>ENTRYPOINT [&#34;nginx&#34;, &#34;-g&#34;, &#34;daemon off;&#34;]
</span></span></span></code></pre></div><p>Let&rsquo;s rebuild the image (same <code>docker build</code> command) and run it again. Open <code>http://IP_ADDRESS_OF_THE_SERVER:8080</code> in your browser and voilà it should show the nginx default page.</p><p>To go further with your created image, let&rsquo;s &ldquo;mount&rdquo; a volume inside the container with our own <code>index.html</code>.
Use the <code>index.html</code> from task <code>dockerfile202</code> or create one yourself.</p><p>Now we add a volume to the container. Add <code>-v "$(pwd)":"/usr/share/nginx/html"</code> to the <code>docker run</code> command, but don&rsquo;t forget add the argument before the image name.
Your command should look like this:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span><span style=color:#44475a>docker run \
</span></span></span><span style=display:flex><span><span style=color:#44475a>    --name=workshop-nginx \
</span></span></span><span style=display:flex><span><span style=color:#44475a>    -d \
</span></span></span><span style=display:flex><span><span style=color:#44475a>    -p 8080:80 \
</span></span></span><span style=display:flex><span><span style=color:#44475a>    -v &#34;$(pwd)&#34;:&#34;/usr/share/nginx/html&#34; \
</span></span></span><span style=display:flex><span><span style=color:#44475a>    workshop-nginx
</span></span></span></code></pre></div><p>This starts a container named <code>workshop-nginx</code> running the image <code>workshop-nginx</code> with a volume mounted at <code>/usr/share/nginx/html</code>.
Run the command and if everything went well after a few seconds, you can now open <code>http://IP_ADDRESS_OF_THE_SERVER:8080</code> in the browser. You should see the contents of the previously created <code>index.html</code>. Well done!</p><h3 id=how-can-this-help-in-the-development-workflow>How can this help in the development workflow?</h3><p>If you are for example creating a new CMS written in PHP, you could create a Dockerfile for it so that a Container image can be created for it.
On every push to the git repository of the project, the image could be built and automatic checks could be run, to ensure every feature is working fine.</p><p>For example Travis CI has switched big parts of their build infrastructure to Docker containers.
Quoting Travis CIsome headings from their <a href=https://blog.travis-ci.com/2014-12-17-faster-builds-with-container-based-infrastructure/>blog post</a>:</p><blockquote><p>Builds start in seconds
Faster builds
More available resources in a build container
Better network capacity, availability and throughput
Easier to scale</p></blockquote><p>As we can see, containers can be better than VMs depending on the use case.</p><p>Due to the lower resource usage, containers are good for the development workflow, making it faster and cheaper in the end.</p><hr><h2 id=composing-containers-together-with-docker-compose>&ldquo;Composing&rdquo; containers together with <code>docker-compose</code></h2><h3 id=making-multi-container-applications-easier-to-start>Making multi container applications easier to start</h3><blockquote><p><strong>TASK</strong>: <a href=https://github.com/galexrt/workshop-container-docker-kubernetes/tree/master/compose101><code>compose101</code></a></p></blockquote><p>To remove the process of typing all <code>docker run</code> and so on, commands to start the containers, <code>docker-compose</code> has been created.
<code>docker-compose</code> makes it <em>easy peasy lemon squeezy</em> to run one to many containers using one command.
The syntax of a <code>docker-compose.yml</code> is YAML. As it is just YAML, you can basically just use a YAML syntax checker, e.g., <a href=https://yaml-online-parser.appspot.com/>Online YAML Parser</a>.</p><p>In our example with WordPress we will create a <code>docker-compose.yml</code> for our MariaDB database server, WordPress and as an extra we&rsquo;ll add phpMyAdmin to it too.</p><p>Create the <code>docker-compose.yml</code> file. I made this part like a test again, so you can see where you have knowledge holes, replace all <code>__BLANK__</code> with the correct answer (the solution is available in the <code>docker-compose-solution.yml</code> file of task <code>compose101</code>):</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span><span style=color:#44475a>version: &#39;3.1&#39;
</span></span></span><span style=display:flex><span><span style=color:#44475a>services:
</span></span></span><span style=display:flex><span><span style=color:#44475a>  # mariadb database image configuration, see https://hub.docker.com/_/mariadb
</span></span></span><span style=display:flex><span><span style=color:#44475a>  database:
</span></span></span><span style=display:flex><span><span style=color:#44475a>    image: &#34;mariadb:10.4.3-bionic&#34;
</span></span></span><span style=display:flex><span><span style=color:#44475a>    environment:
</span></span></span><span style=display:flex><span><span style=color:#44475a>      MYSQL_DATABASE: wordpress
</span></span></span><span style=display:flex><span><span style=color:#44475a>      MYSQL_USER: wordpress
</span></span></span><span style=display:flex><span><span style=color:#44475a>      MYSQL_PASSWORD: wordpress
</span></span></span><span style=display:flex><span><span style=color:#44475a>      MYSQL_ROOT_PASSWORD: secure_password
</span></span></span><span style=display:flex><span><span style=color:#44475a>      MYSQL_ROOT_HOST: &#39;%&#39;
</span></span></span><span style=display:flex><span><span style=color:#44475a>    volumes:
</span></span></span><span style=display:flex><span><span style=color:#44475a>      - &#34;/opt/docker/database:/var/lib/mysql:rw&#34;
</span></span></span><span style=display:flex><span><span style=color:#44475a>  # wordpress image configuration, see https://hub.docker.com/r/_/wordpress/
</span></span></span><span style=display:flex><span><span style=color:#44475a>  wordpress:
</span></span></span><span style=display:flex><span><span style=color:#44475a>    image: &#34;wordpress:5.1-php7.1-apache&#34;
</span></span></span><span style=display:flex><span><span style=color:#44475a>    ports:
</span></span></span><span style=display:flex><span><span style=color:#44475a>      - 8080:80
</span></span></span><span style=display:flex><span><span style=color:#44475a>    environment:
</span></span></span><span style=display:flex><span><span style=color:#44475a>      WORDPRESS_DB_HOST: &#34;__BLANK__&#34;
</span></span></span><span style=display:flex><span><span style=color:#44475a>      WORDPRESS_DB_NAME: __BLANK__
</span></span></span><span style=display:flex><span><span style=color:#44475a>      WORDPRESS_DB_USER: __BLANK__
</span></span></span><span style=display:flex><span><span style=color:#44475a>      WORDPRESS_DB_PASSWORD: __BLANK__
</span></span></span><span style=display:flex><span><span style=color:#44475a>      WORDPRESS_AUTH_KEY: SECURE_AUTH_KEY
</span></span></span><span style=display:flex><span><span style=color:#44475a>      WORDPRESS_LOGGED_IN_KEY: SECURE_LOGGED_IN_KEY
</span></span></span><span style=display:flex><span><span style=color:#44475a>      WORDPRESS_AUTH_SALT: SECURE_AUTH_SALT
</span></span></span><span style=display:flex><span><span style=color:#44475a>      WORDPRESS_LOGGED_IN_SALT: SECURE_LOGGED_IN_SALT
</span></span></span><span style=display:flex><span><span style=color:#44475a>  # phpmyadmin image configuration, see https://hub.docker.com/r/phpmyadmin/phpmyadmin/
</span></span></span><span style=display:flex><span><span style=color:#44475a>  phpmyadmin:
</span></span></span><span style=display:flex><span><span style=color:#44475a>    image: &#34;phpmyadmin/phpmyadmin:4.8&#34;
</span></span></span><span style=display:flex><span><span style=color:#44475a>    ports:
</span></span></span><span style=display:flex><span><span style=color:#44475a>      - 8181:80
</span></span></span><span style=display:flex><span><span style=color:#44475a>    environment:
</span></span></span><span style=display:flex><span><span style=color:#44475a>      PMA_HOST: database
</span></span></span><span style=display:flex><span><span style=color:#44475a>      PMA_USER: root
</span></span></span><span style=display:flex><span><span style=color:#44475a>      PMA_PASSWORD: secure_password
</span></span></span></code></pre></div><blockquote><p><strong>WDWD</strong></p><ul><li><code>database:</code> - Name of the container.</li><li><code>image:</code> - Defines the used image for the container.</li><li><code>links: []</code> - A list of container links.</li><li><code>ports: []</code> - A list of published ports.</li><li><code>environment: []</code> - Key / Value list of environment variables (Format: <code>NAME: VALUE</code>).</li></ul></blockquote><p>I have also added the environment variables <code>DB_REMOTE_ROOT_NAME</code> and <code>DB_REMOTE_ROOT_PASS</code>, so that Admin can access the MariaDB server.</p><h4 id=networking-changes>Networking Changes</h4><p>As you might have spotted the above <code>docker-compose</code> file does not have anything related to which <code>network</code> to use in it.
That is because <code>docker-compose</code> creates a <code>network</code> based on the &ldquo;project name&rdquo; by default, meaning that there is no need in our case to create another network.</p><h3 id=starting-our-multi-container-applications-with-one-command>Starting our multi container applications with one command</h3><blockquote><p><strong>TASK</strong>: <a href=https://github.com/galexrt/workshop-container-docker-kubernetes/tree/master/compose101><code>compose101</code></a></p></blockquote><p>To run / start the content of the filled out <code>docker-compose.yml</code> (if you are too lazy to fill out the file, use the <code>docker-compose-solutions.yml</code>) run:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span><span style=color:#44475a>docker-compose -f docker-compose.yml up
</span></span></span></code></pre></div><blockquote><p><strong>WDWD</strong></p><ul><li><code>docker-compose</code> - The <code>docker-compose</code> command.</li><li><code>-f DOCKER_COMPOSE_YML</code> - Optional. Defaults to <code>docker-compose.yml</code>. <code>DOCKER_COMPOSE_YML</code> is a path to a valid <code>docker-compose</code> file.</li><li><code>up</code> - Starts the containers defined in the given docker-compose file.</li></ul><p><strong>EXAMPLE</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console></code></pre></div></blockquote><p>$ docker-compose up # no need for <code>-f DOCKER_COMPOSE_YML</code> flag as the default file is used <code>docker-compose.yml</code>
Creating compose101_database_1 &mldr; done
Creating compose101_phpmyadmin_1 &mldr; done
Creating compose101_wordpress_1 &mldr; done
Attaching to compose101_database_1, compose101_phpmyadmin_1, compose101_wordpress_1
phpmyadmin_1 | phpMyAdmin not found in /var/www/html - copying now&mldr;
wordpress_1 | WordPress not found in /var/www/html - copying now&mldr;
phpmyadmin_1 | Complete! phpMyAdmin has been successfully copied to /var/www/html
wordpress_1 | Complete! WordPress has been successfully copied to /var/www/html
phpmyadmin_1 | /usr/lib/python2.7/site-packages/supervisor/options.py:461: UserWarning: Supervisord is running as root and it is searching for its configuration file in default locations (including its current working directory); you probably want to specify a &ldquo;-c&rdquo; argument specifying an absolute path to a configuration file for improved security.
phpmyadmin_1 | &lsquo;Supervisord is running as root and it is searching '
phpmyadmin_1 | 2019-04-07 22:17:35,638 CRIT Supervisor is running as root. Privileges were not dropped because no user is specified in the config file. If you intend to run as root, you can set user=root in the config file to avoid this message.
phpmyadmin_1 | 2019-04-07 22:17:35,638 INFO Included extra file &ldquo;/etc/supervisor.d/nginx.ini&rdquo; during parsing
phpmyadmin_1 | 2019-04-07 22:17:35,638 INFO Included extra file &ldquo;/etc/supervisor.d/php.ini&rdquo; during parsing
phpmyadmin_1 | 2019-04-07 22:17:35,646 INFO RPC interface &lsquo;supervisor&rsquo; initialized
phpmyadmin_1 | 2019-04-07 22:17:35,646 CRIT Server &lsquo;unix_http_server&rsquo; running without any HTTP authentication checking
phpmyadmin_1 | 2019-04-07 22:17:35,646 INFO supervisord started with pid 1
wordpress_1 | [07-Apr-2019 22:17:35 UTC] PHP Warning: mysqli::__construct(): (HY000/2002): Connection refused in - on line 22
wordpress_1 |
wordpress_1 | MySQL Connection Error: (2002) Connection refused
database_1 | 2019-04-07 22:17:35 0 [Note] mysqld (mysqld 10.4.3-MariaDB-1:10.4.3+maria~bionic) starting as process 1 &mldr;
database_1 | 2019-04-07 22:17:35 0 [Note] InnoDB: Using Linux native AIO
database_1 | 2019-04-07 22:17:35 0 [Note] InnoDB: Mutexes and rw_locks use GCC atomic builtins
database_1 | 2019-04-07 22:17:35 0 [Note] InnoDB: Uses event mutexes
database_1 | 2019-04-07 22:17:35 0 [Note] InnoDB: Compressed tables use zlib 1.2.11
database_1 | 2019-04-07 22:17:35 0 [Note] InnoDB: Number of pools: 1
database_1 | 2019-04-07 22:17:35 0 [Note] InnoDB: Using SSE2 crc32 instructions
database_1 | 2019-04-07 22:17:35 0 [Note] mysqld: O_TMPFILE is not supported on /tmp (disabling future attempts)
database_1 | 2019-04-07 22:17:35 0 [Note] InnoDB: Initializing buffer pool, total size = 256M, instances = 1, chunk size = 128M
database_1 | 2019-04-07 22:17:35 0 [Note] InnoDB: Completed initialization of buffer pool
database_1 | 2019-04-07 22:17:35 0 [Note] InnoDB: If the mysqld execution user is authorized, page cleaner thread priority can be changed. See the man page of setpriority().
database_1 | 2019-04-07 22:17:35 0 [Note] InnoDB: 128 out of 128 rollback segments are active.
database_1 | 2019-04-07 22:17:35 0 [Note] InnoDB: Creating shared tablespace for temporary tables
database_1 | 2019-04-07 22:17:35 0 [Note] InnoDB: Setting file &lsquo;./ibtmp1&rsquo; size to 12 MB. Physically writing the file full; Please wait &mldr;
database_1 | 2019-04-07 22:17:35 0 [Note] InnoDB: File &lsquo;./ibtmp1&rsquo; size is now 12 MB.
database_1 | 2019-04-07 22:17:35 0 [Note] InnoDB: 10.4.3 started; log sequence number 139845; transaction id 21
database_1 | 2019-04-07 22:17:35 0 [Note] InnoDB: Loading buffer pool(s) from /var/lib/mysql/ib_buffer_pool
database_1 | 2019-04-07 22:17:35 0 [Note] Plugin &lsquo;FEEDBACK&rsquo; is disabled.
database_1 | 2019-04-07 22:17:35 0 [Note] Server socket created on IP: &lsquo;::&rsquo;.
database_1 | 2019-04-07 22:17:35 0 [Warning] &lsquo;proxies_priv&rsquo; entry &lsquo;@% root@81494c3919ba&rsquo; ignored in &ndash;skip-name-resolve mode.
database_1 | 2019-04-07 22:17:35 0 [Note] InnoDB: Buffer pool(s) load completed at 190407 22:17:35
database_1 | 2019-04-07 22:17:36 0 [Note] Reading of all Master_info entries succeded
database_1 | 2019-04-07 22:17:36 0 [Note] Added new Master_info &rsquo;&rsquo; to hash table
database_1 | 2019-04-07 22:17:36 0 [Note] mysqld: ready for connections.
database_1 | Version: &lsquo;10.4.3-MariaDB-1:10.4.3+maria~bionic&rsquo; socket: &lsquo;/var/run/mysqld/mysqld.sock&rsquo; port: 3306 mariadb.org binary distribution
phpmyadmin_1 | 2019-04-07 22:17:36,648 INFO spawned: &lsquo;php-fpm&rsquo; with pid 21
phpmyadmin_1 | 2019-04-07 22:17:36,649 INFO spawned: &rsquo;nginx&rsquo; with pid 22
phpmyadmin_1 | [07-Apr-2019 22:17:36] NOTICE: fpm is running, pid 21
phpmyadmin_1 | [07-Apr-2019 22:17:36] NOTICE: ready to handle connections
phpmyadmin_1 | 2019-04-07 22:17:37,671 INFO success: php-fpm entered RUNNING state, process has stayed up for > than 1 seconds (startsecs)
phpmyadmin_1 | 2019-04-07 22:17:37,671 INFO success: nginx entered RUNNING state, process has stayed up for > than 1 seconds (startsecs)
wordpress_1 | AH00558: apache2: Could not reliably determine the server&rsquo;s fully qualified domain name, using 172.19.0.4. Set the &lsquo;ServerName&rsquo; directive globally to suppress this message
wordpress_1 | AH00558: apache2: Could not reliably determine the server&rsquo;s fully qualified domain name, using 172.19.0.4. Set the &lsquo;ServerName&rsquo; directive globally to suppress this message
wordpress_1 | [Sun Apr 07 22:17:38.927887 2019] [mpm_prefork:notice] [pid 1] AH00163: Apache/2.4.25 (Debian) PHP/7.1.28 configured &ndash; resuming normal operations
wordpress_1 | [Sun Apr 07 22:17:38.927939 2019] [core:notice] [pid 1] AH00094: Command line: &lsquo;apache2 -D FOREGROUND&rsquo;
[&mldr;]
<em>Insert Apache access logs of the WordPress and / or phpMyAdmin stance being access</em>
[&mldr;]
^CGracefully stopping&mldr; (press Ctrl+C again to force)
Stopping compose101_wordpress_1 &mldr; done
Stopping compose101_phpmyadmin_1 &mldr; done
Stopping compose101_database_1 &mldr; done</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mysql data-lang=mysql><span style=display:flex><span>
</span></span><span style=display:flex><span>After running the command, you should see log output <span style=color:#ff79c6>starting</span> <span style=color:#ff79c6>to</span> fill your terminal. <span style=color:#ff79c6>To</span> stop the started containers press <span style=color:#ff79c6>`</span>CTRL<span style=color:#ff79c6>+</span>C<span style=color:#ff79c6>`</span>.
</span></span><span style=display:flex><span>Again <span style=color:#ff79c6>as</span> <span style=color:#ff79c6>with</span> a single container, <span style=color:#ff79c6>to</span> detach the container <span style=color:#ff79c6>into</span> background <span style=color:#ff79c6>when</span> running <span style=color:#ff79c6>`</span>docker<span style=color:#ff79c6>-</span>compuse up<span style=color:#ff79c6>`</span>, <span style=color:#ff79c6>add</span> the the <span style=color:#ff79c6>`--</span>detach<span style=color:#ff79c6>`</span> (<span style=color:#ff79c6>or</span> <span style=color:#ff79c6>`-</span>d<span style=color:#ff79c6>`</span>) flag.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6272a4>## Basic `docker-compose` commands
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>
</span></span><span style=display:flex><span>There are some <span style=color:#ff79c6>`</span>docker<span style=color:#ff79c6>-</span>compose<span style=color:#ff79c6>`</span> commands you should know <span style=color:#ff79c6>when</span> working <span style=color:#ff79c6>with</span> the <span style=color:#ff79c6>`</span>docker<span style=color:#ff79c6>-</span>compose<span style=color:#ff79c6>`</span> command.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6272a4>### Stopping all containers run by the current `docker-compose` file
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>
</span></span><span style=display:flex><span>Instead of the <span style=color:#ff79c6>`</span>up<span style=color:#ff79c6>`</span>, you just put <span style=color:#ff79c6>`</span>stop<span style=color:#ff79c6>`</span> there. Stops the containers <span style=color:#ff79c6>from</span> the current <span style=color:#ff79c6>`</span>docker<span style=color:#ff79c6>-</span>compose<span style=color:#ff79c6>`</span> file:
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>```</span>console
</span></span><span style=display:flex><span>docker<span style=color:#ff79c6>-</span>compose stop <span style=color:#ff79c6>-</span>t TIMEOUT
</span></span></code></pre></div><blockquote><p><strong>WDWD</strong></p><ul><li><code>stop</code> - Stop subcommand.</li><li><code>-t TIMEOUT</code> - Optional. Timeout to wait for the containers to exit, before the containers get killed.</li></ul></blockquote><h3 id=deleting-all-containers-from-the-current-docker-compose-file>Deleting all containers from the current <code>docker-compose</code> file</h3><p>Replacing the <code>up</code> with <code>rm</code>, deletes all containers that are started by the current <code>docker-compose</code> file, but now are stopped or exited:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span><span style=color:#44475a>docker-compose -f DOCKER_COMPOSE_YML rm --force
</span></span></span></code></pre></div><blockquote><p><strong>WDWD</strong></p><ul><li><code>rm</code> - Subcommand to remove / delete all container started by the selected <code>docker-compose</code> file.</li><li><code>--force</code> - Optional. Forces the removal of the containers.</li></ul></blockquote><h3 id=restarting-all-container-started-by-the-current-docker-compose-file>Restarting all container started by the current <code>docker-compose</code> file</h3><p>Restarts all containers that are started or have exited by the current <code>docker-compose</code> file.
This just stops and starts the containers again. It does not delete and create the containers again.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span><span style=color:#44475a>docker-compose -f DOCKER_COMPOSE_YML restart
</span></span></span></code></pre></div><blockquote><p><strong>WDWD</strong></p><ul><li><code>restart</code> - Subcommand to stop and then start all containers of the selected <code>docker-compose</code> file.</li></ul></blockquote><h3 id=lets-play-some-more-with-docker-compose>Let&rsquo;s play some more with <code>docker-compose</code>!</h3><blockquote><p><strong>TASK</strong>: <a href=https://github.com/galexrt/workshop-container-docker-kubernetes/tree/master/compose202><code>compose202</code></a></p><p>The task directory contains some other <code>docker-compose.yml</code> files for you to play around with. Look at the <code>docker-compose.yml</code>s, realize what they do and run &rsquo;em.</p><p><strong>TIP</strong></p><p>Keep the <code>-f DOCKERFILE</code> option in mind, when dealing with multiple <code>docker-compose.yml</code> as in this case in specific.</p></blockquote><p>Let me know if you run into any issues, during &ldquo;play time&rdquo; with <code>docker-compose</code>.</p><hr><h2 id=summary-of-the-day>Summary of the Day</h2><p>If you are reading this, you have made it to the end of day #1. Well done, sir or madam, have a cookie!</p><figure itemprop=associatedMedia itemscope itemtype=http://schema.org/ImageObject><a href=here-is-a-cookie.png itemprop=contentUrl><img itemprop=thumbnail src=here-is-a-cookie.png width=300px></a><figcaption><h4>Here is a Cookie (from Memegen)</h4></figcaption></figure><p>I hope everyone had a good time during the training&rsquo;s first day and has taken new knowledge with them already.
If you have any feedback about the training itself or the materials, please let me know in person or email me at <a href=mailto:galexrt@googlemail.com>me AT galexrt DOT moe</a>.</p><p>Have Fun!</p></article><footer class=post-footer><ul class=post-tags><li><a href=https://edenmal.moe/tags/Workshop><span class=tag>Workshop</span></a></li><li><a href=https://edenmal.moe/tags/Docker><span class=tag>Docker</span></a></li><li><a href=https://edenmal.moe/tags/Kubernetes><span class=tag>Kubernetes</span></a></li><li><a href=https://edenmal.moe/tags/Container><span class=tag>Container</span></a></li></ul><p class=post-copyright>© This page/post is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License, please give source if you wish to quote or reproduce.This post was published <strong>681</strong> days ago, content in the post may be inaccurate, even wrong now, please take risk yourself.</p></footer><script src=https://utteranc.es/client.js repo=galexrt/edenmal.moe issue-term=title label=blogpost theme=icy-dark crossorigin=anonymous async></script></section><footer class=site-footer><p>© 2017-2024 Alexander Trost</p><p>Powered by <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a> with customized theme <a href=https://github.com/laozhu/hugo-nuo target=_blank rel=noopener>Nuo</a>.</p></footer><link rel=stylesheet href=https://edenmal.moe/styles/icofont.min.min.css><script async src=https://edenmal.moe/cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.min.120e30ad299b8d6548dd1fbb6ab1d45fb508bf080219df63e5ab9750b1241207.js integrity="sha256-Eg4wrSmbjWVI3R+7arHUX7UIvwgCGd9j5auXULEkEgc="></script><script type=text/x-mathjax-config>
  MathJax.Ajax.config.path["MathJax"] = "/cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5";
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [['$','$'], ['\\(','\\)']],
      displayMath: [['$$','$$'], ['\\[','\\]']],
      processEscapes: true,
      processEnvironments: true,
      skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
      TeX: { equationNumbers: { autoNumber: "AMS" },
      extensions: ["AMSmath.js", "AMSsymbols.js"] }
    },
  });
</script><script type=text/x-mathjax-config>
  // Fix <code> tags after MathJax finishes running. This is a
  // hack to overcome a shortcoming of Markdown. Discussion at
  // https://github.com/mojombo/jekyll/issues/199
  MathJax.Hub.Queue(() => {
    MathJax.Hub.getAllJax().map(v => v.SourceElement().parentNode.className += ' has-jax');
  });
</script><script src=https://edenmal.moe/scripts/index.min.0375b6e63e18876ff8d4ad95bf8ef081176b6b994398d5bd22f5140f45565d37.js integrity="sha256-A3W25j4Yh2/41K2Vv47wgRdra5lDmNW9IvUUD0VWXTc="></script><script>"serviceWorker"in navigator&&navigator.serviceWorker.register("/service-worker.js").then(function(){console.log("[ServiceWorker] Registered")})</script></body></html>